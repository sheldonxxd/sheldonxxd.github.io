[{"title":"åˆ©ç”¨ pandoc æŠŠ markdown æ–‡ç¨¿è½¬æ¢ä¸ºç‹¬ç«‹ html æ–‡ä»¶","url":"/2021/05/06/pandoc_md2html/","content":"\n### å‘½ä»¤è¡Œå°è¯•\n\npandoc å®‰è£…åä¸€èˆ¬ä¼šè¢«åŠ å…¥ç¯å¢ƒå˜é‡ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨ python ä¸­ä½¿ç”¨ `os.system` å‘½ä»¤è°ƒç”¨ã€‚pandoc çš„ç‰ˆæœ¬æ˜¯ 2.12ï¼Œèƒ½å¤ŸåŸºæœ¬å®ç°æˆ‘æƒ³è¦çš„æ•ˆæœçš„å‘½ä»¤å¦‚ä¸‹ï¼š\n\n```bash\npandoc -s D:\\log\\main\\source\\_posts\\20210506.md --from markdown+emoji --self-contained -c github-pandoc.css -o test.html\n```\n\npandoc å¯ä»¥å¸¦å¾ˆå¤šå‚æ•°ï¼Œå¯¹ä¸Šé¢è¿™æ¡å‘½ä»¤æ³¨è§£ï¼š\n\n- `-s`ï¼šsourceï¼Œä»£è¡¨éœ€è¦è½¬æ¢çš„æºæ–‡æ¡£\n- `--from markdown+emoji`ï¼šå¯¹ emoji ä»£ç è¿›è¡Œè½¬æ¢\n- `--self-contained`ï¼šç”Ÿæˆç‹¬ç«‹æ–‡ä»¶ï¼Œæ¯”å¦‚ä¼šæŠŠå›¾ç‰‡åµŒå…¥åˆ° html ä¸­\n- `-c`ï¼šç”¨æˆ·è‡ªå®šä¹‰æ ·å¼ï¼Œæˆ‘ä»ç½‘ä¸Šä¸‹è½½äº†ä¸€ä¸ª github-pandoc çš„æ ·å¼æ–‡ä»¶\n- `-o`ï¼šoutputï¼Œè¾“å‡ºæ–‡æ¡£è·¯å¾„\n\néœ€è¦æ³¨æ„ï¼Œæ­¤æ¡å‘½ä»¤å¦‚æœè¦åµŒå…¥å›¾ç‰‡ï¼Œè€Œæºæ–‡æ¡£ä¸­ä½¿ç”¨çš„æ˜¯ç›¸å¯¹è·¯å¾„å¼•ç”¨å›¾ç‰‡ï¼Œåˆ™éœ€è¦ä¿è¯ pandoc å‘½ä»¤è¿è¡Œçš„æ ¹ç›®å½•ä¸æºæ–‡æ¡£ç›¸åŒï¼Œå¦åˆ™ä¼šå‡ºç° ã€ŒFile Not Foundã€é”™è¯¯ã€‚\n\n### ä¿®æ”¹ embed çš„æ§½å‡½æ•°\n\nä¸ºäº†ä¿æŒç‰ˆæœ¬ç¨³å®šï¼Œä¿®æ”¹åœ¨å‰¯æœ¬ `main4_2.py` ä¸Šå®Œæˆã€‚\n\nembed å¯¹åº”çš„æ§½å‡½æ•°ä¸º htmlEmbeddingï¼Œä»£ç ä¿®æ”¹å¦‚ä¸‹ï¼š\n\n```python\ndef htmlEmbedding(ui):\n    ''' \n    2021-05-06 12:03:51\n    è°ƒç”¨ pandoc å®Œæˆç‹¬ç«‹ html æ–‡ä»¶çš„å¯¼å‡º\n    ''' \n    global wks\n    global qdir\n    base_fname = ui.fname.text() \n    md_filepath = os.path.join(wks, base_fname+'.md')\n    html_filename = base_fname+'.html'\n    html_filepath = os.path.expanduser('~/Desktop/{}'.format(html_filename))\n    css_filepath = qdir + '/github-pandoc.css'  # æ ·å¼æ–‡ä»¶ä¸æ­¤è„šæœ¬æ”¾åœ¨åŒçº§ç›®å½•\n    command = 'cd \"{}\" && pandoc -s {} --from markdown+emoji  --self-contained -c \"{}\" -o \"{}\"'.format(\n        wks, md_filepath, css_filepath, html_filepath)\n    os.system(command)\n    ui.searchResults.setText('å›¾ç‰‡åµŒå…¥æˆåŠŸï¼\\nHTMLæ–‡ä»¶å·²ä¿å­˜è‡³æ¡Œé¢ï¼')\n```\n\n### æµ‹è¯•ç»“æœ\n\n![image-20210506121556166](https://sheldon-notes.oss-cn-shanghai.aliyuncs.com/img/image-20210506121556166.png)\n\nå®Œç¾ï¼Œè¿™æ ·å°±å¤§å¹…åº¦å‡å°‘äº† LogTool å¯¹ BeautifulSoupã€base64ã€urllib ç­‰æ¨¡å—çš„ä¾èµ–ã€‚\n\n### å‚è€ƒèµ„æ–™\n\n[Posiible to use pandoc with HTML containing base64 inline images? - Stack Overflow](https://stackoverflow.com/questions/20059542/posiible-to-use-pandoc-with-html-containing-base64-inline-images)\n\n[GitHub-like CSS for pandoc standalone HTML files (perfect for HTML5 output). Based on Marked.app's GitHub CSS. Added normalize.css (v2.1.3) in the prior to GitHub css.](https://gist.github.com/Dashed/6714393)","tags":["pandoc","html","LogTool"],"categories":["python"]},{"title":"æ–‡çŒ®ç²¾è¯»å·¥ä½œæµ","url":"/2021/04/25/deepReadingPipeline/","content":"\nå¾ˆå¤šæ—¶å€™è¦é’ˆå¯¹ä¸€ä¸ªä¸»é¢˜è¿›è¡Œæ–‡çŒ®é˜…è¯»ï¼Œä¼šå…³æ³¨ä¸åŒæ–‡ç« çš„ä¸åŒå±€éƒ¨ç»†èŠ‚å†…å®¹ï¼Œå¹¶ä¸”åšç¬”è®°ã€‚åšå®Œç¬”è®°åï¼Œå¯ä»¥æŠŠç›¸å…³çš„å‚è€ƒæ–‡çŒ®é‡æ–°æ±‡æ€»ä¸€ä¸‹ï¼Œå’Œé˜…è¯»ç¬”è®°ä¸€èµ·æ”¾åˆ° mendeley çš„æ–°å»ºå­ç›®å½•å†…ã€‚è¿™ä¸ªè¿‡ç¨‹æ¶‰åŠåˆ°ä¸€äº›ä¿¡æ¯çš„æå–å’Œæ–‡ä»¶æ ¼å¼çš„è½¬åŒ–ï¼Œå› æ­¤æ•´åˆäº†ä¸€äº›ä»£ç ï¼Œæ–¹ä¾¿è‡ªå·±ã€‚\n\n\nå…·ä½“æ–¹æ³•æ˜¯è¿™æ ·çš„ï¼š\n\n1. ä½¿ç”¨`newPost.bat`è„šæœ¬åœ¨`_posts`ç›®å½•ä¸‹ç”Ÿæˆä¸€ä¸ªå¸¦æœ‰ front matter æ¨¡æ¿çš„ markdown æ–‡ä»¶\n2. æ‰“å¼€ mendeley æŸ¥æ‰¾å’Œé˜…è¯»åˆšå…´è¶£ä¸»é¢˜çš„æ–‡çŒ®ï¼Œå¹¶åœ¨ markdown ä¸­åšç¬”è®°\n3. ä¿®æ”¹å’Œè¡¥å…… front matter ä¸­çš„ä¿¡æ¯ï¼Œ`title`ã€`excerpt`ã€`tags`ç­‰ä¿¡æ¯æ˜¯å¿…éœ€çš„\n4. ä»typoraä¸­ç›´æ¥å¤åˆ¶ markdown çš„æ–‡ä»¶è·¯å¾„ï¼Œä½œä¸ºä¿®æ”¹ä¸Šé¢`collectCitations.py` ä¸­ md çš„å€¼ï¼ˆå­—ç¬¦ä¸²ï¼‰ï¼Œç„¶åè¿è¡Œè„šæœ¬\n5. ç”Ÿæˆçš„ refs.bib æ–‡ä»¶ä¿å­˜åœ¨ markdown ç¬”è®°æ–‡ä»¶çš„é™„å½•æ–‡ä»¶å¤¹ä¸­ï¼Œå¯ä»¥ä» mendeley ä¸­æ–°å»ºä¸€ä¸ªç›®å½•ï¼Œç„¶å import è¿™ä¸ª bib æ–‡ä»¶\n6. å°† markdown ç¬”è®°ç”¨ typora å¯¼å‡ºä¸º htmlï¼Œç„¶åç”¨ `htmlEmbedding.py` è„šæœ¬å¯¼å‡ºä¸º standalone çš„ç½‘é¡µï¼Œä½œä¸ºé™„ä»¶æ·»åŠ åˆ° mendeley ç›¸åº”ç¬”è®°æ¡ç›®çš„ files ä¸­\n\næœ€åmendeleyä¸­æ•ˆæœå¦‚ä¸‹æ‰€ç¤ºï¼š\n\n![image-20210425131836781](https://sheldon-notes.oss-cn-shanghai.aliyuncs.com/img/image-20210425131836781.png)\n\n### collectCitations.py\n\næ–°å¢äº†â€œæ ¹æ® markdown çš„ frontmatter ä¿¡æ¯è‡ªåŠ¨æ·»åŠ  entry åˆ° bib æ–‡ä»¶çš„æ–¹æ³•â€ï¼Œæ–°ç‰ˆæœ¬çš„ä»£ç å¦‚ä¸‹ï¼š\n\n```python\nimport bibtexparser\nfrom bibtexparser.bwriter import BibTexWriter\nfrom bibtexparser.bibdatabase import BibDatabase\nimport os\nimport re\nimport yaml \nimport datetime\n\nclass Bib:\n    def __init__(self, fps):\n        '''\n        fps: dict, text.md filepath & library.bib filepath\n        {'text':fp1, 'library':fp2}\n        '''\n        self.fp = fps['text']\n        self.wks, self.fname = os.path.split(self.fp)\n        base, _ = os.path.splitext(self.fp)\n        self.assets = base +'/'  # markdown æ–‡ä»¶çš„é™„ä»¶ç›®å½•\n        self.bibpath = fps['library']\n        self.data = []  # æ¯ä¸€ä¸ªentryéƒ½æ˜¯dictï¼Œä¸€èµ·è£…åˆ°listé‡Œè¾¹\n    \n    def load(self):\n        '''\n        load the library.bib\n        '''\n        fp = self.bibpath\n        with open(fp, encoding='utf-8') as bibtex_file:\n            bib_database = bibtexparser.load(bibtex_file)\n        self.library = bib_database.entries_dict\n        print('{} entries loaded!'.format(len(self.library)))\n    \n    def collect(self):\n        '''\n        collect citation key from text.md\n        '''\n        fp = self.fp\n        with open(fp, 'r', encoding='utf-8') as f: \n            data = f.read()\n        pattern = \"\\[@[^]]+]\"\n        # ä½¿ç”¨æ–¹æ‹¬å·åˆ—ä¸¾ä¸èƒ½åŒ¹é…çš„å­—ç¬¦]ï¼Œç¡®ä¿åªæ‰¾åˆ°ä¸€ä¸ª[@???]\n        a = re.findall(pattern, data)\n        test = ''.join(a)\n        pattern = '@([\\w\\-:.#$%&-+?<>~/]+);?'\n        # citationkeyä¸­å¯èƒ½åŒ…å«ä¸€äº›ç¬¦å·ç±»å­—ç¬¦ï¼Œä»¥ä¸Šéƒ½æ˜¯pandocå…è®¸çš„\n        # https://pandoc.org/MANUAL.html#extension-citations\n        # æ³¨æ„å¯¹ä¸­æ‹¬å·å†…çš„`-`ç¬¦å·è¿›è¡Œè½¬ä¹‰\n        b = re.findall(pattern, test)\n        self.keys = list(set(b))\n        print('{} citations fetched!'.format(len(self.keys)))\n        \n        # æ ¹æ®æ”¶é›†åˆ°çš„keyï¼Œåˆ°libraryé‡Œè¾¹æŠŠå…·ä½“çš„ä¿¡æ¯ ditc æ‹¿åˆ°\n        data = []\n        for key in self.keys:\n            data.append(self.library[key])\n        self.data = data  # æ–¹ä¾¿åé¢å† append\n        \n    def save(self):\n        '''\n        save the new subcollection bib file to assets folder\n        https://bibtexparser.readthedocs.io/en/master/tutorial.html\n        '''\n        if not os.path.exists(self.assets):\n           os.mkdir(self.assets)\n        db = BibDatabase()\n        db.entries = self.data\n        writer = BibTexWriter()\n        fp2 = os.path.join(self.assets, 'refs.bib')\n        with open(fp2, 'w', encoding='utf-8') as bibfile:\n            # æ³¨æ„ç¼–ç æ˜¯ utf-8ï¼Œé»˜è®¤çš„ gbk ä¼šå‡ºé”™\n            bibfile.write(writer.write(db))\n        print('[Save to] {}'.format(fp2))\n\nclass AddEntry(Bib):\n    '''\n    æŠŠ markdown æœ¬èº«ç”Ÿæˆä¸€æ¡ entry æ”¾åˆ° æ±‡æ€»çš„ bib æ–‡ä»¶ä¸­ã€‚\n    '''\n    def __init__(self, fps):\n        super(AddEntry, self).__init__(fps)\n    \n    def fetchYAML(self):\n        # å…ˆè¯»å– markdown æ–‡ä»¶\n        fp = self.fp \n        with open(fp, 'r', encoding='utf-8') as f: \n            data = f.readlines()\n        # è·å–æ–‡ä»¶å¤´çš„ front matter ä¿¡æ¯\n        idx = 0\n        i = 0\n        cout = []\n        while idx<2:\n            line = data[i]\n            if line.startswith('---'):\n                idx += 1\n                cout.append(i)\n            i += 1\n        start, end = cout\n        info = data[start+1: end]\n        info = ''.join(info)\n        info_dict = yaml.load(info, Loader=yaml.FullLoader)\n        # 'date': datetime.datetime(2021, 4, 25, 10, 53, 32)\n        self.info = info_dict\n\n    def makeEntry(self):\n        '''\n        ä½¿ç”¨bibtexparser\n        å°†front matterè½¬æ¢ä¸ºbibä¸­çš„ä¸€ä¸ªentry\n        ç„¶å append åˆ° self.dataä¸­\n        ä¸»è¦æ˜¯æœ‰ï¼š\n        1. citation key\n        2. abstract (excerpt)\n        3. author (default is Xie, Xiaodong) \n        4. journal (default is sheldon-notes)\n        5. title\n        6. year\n        7. volumn (month)\n        8. number (day)\n        ---\n        file å¯ä»¥è‡ªå·±æ‰‹åŠ¨æ·»åŠ å¯¼å‡ºçš„htmlæ–‡ä»¶\n        '''\n        info = self.info  # ä¸€ä¸ªå­—å…¸\n        entry = {}\n        entry['year'] = str(info['date'].year)  \n        # entryä¸­çš„å†…å®¹å¿…é¡»éƒ½æ˜¯å­—ç¬¦ä¸²\n        entry['volumn'] = str(info['date'].month)\n        entry['number'] = str(info['date'].day)\n        # https://blog.csdn.net/cmzsteven/article/details/64906245\n        entry['title'] = info['title']\n        entry['abstract'] = info['excerpt']\n        entry['journal'] = 'sheldon-notes'\n        entry['author'] = 'Xie, Xiaodong'\n        entry['ENTRYTYPE'] = 'article'\n        entry['keywords'] = ','.join(info['tags'])\n        entry['ID'] = 'xxd_{}-{}-{}'.format(entry['year'], \n                                         entry['volumn'], \n                                         entry['number']\n                                         )\n        self.data.append(entry)\n\n\nif __name__=='__main__':\n    # æŒ‡å®š markdown æ–‡ä»¶è·¯å¾„\n    md = r'D:\\log\\main\\source\\_posts\\cell_PAINT_imaging.md'\n    fps = {\n        'text': md,\n        'library': r\"D:\\papers\\library.bib\"\n    }\n    # åˆå§‹åŒ–å¯¹è±¡\n    xxd = AddEntry(fps)\n    # åŠ è½½ library.bib æ€»åº“\n    xxd.load()\n    # æ”¶é›† markdown ä¸­å¼•ç”¨äº†çš„æ¡ç›®\n    xxd.collect()\n    # æ”¶é›† markdown ä¸­çš„ front matterä¿¡æ¯\n    xxd.fetchYAML()\n    # æ ¹æ® front matter åˆ¶ä½œä¸€æ¡æ–°çš„ entry\n    xxd.makeEntry()\n    # ä¿å­˜å­é›† refs.bib åˆ° markdown é™„ä»¶ç›®å½•\n    xxd.save()\n```\n\n\n### newPost.bat\n\nç”¨äºåœ¨`_posts`ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ªå¸¦ front matter çš„markdown æ–‡ä»¶çš„å°è„šæœ¬ã€‚\n\n```bash\n:: 2021-01-12 10:31:58\n:: ç”Ÿæˆå…·æœ‰FrontMatterçš„markdownæ–‡ä»¶\n:: å…·æœ‰titleã€excerptã€dateã€tagsã€categoriesç­‰\n\necho off\nset d=%date:~0,4%-%date:~5,2%-%date:~8,2% %time:~0,8%\nREM æ”¶é›†å®Œæ—¶é—´å‚æ•°åï¼Œå£°æ˜é‡‡ç”¨UTF-8ç¼–ç \nchcp 65001\nset /p t=Please input the filename (no space):\n\necho --->>%t%.md\necho title: %t%>>%t%.md\necho excerpt: This is a summary of this draft>>%t%.md\necho date: %d%>>%t%.md\necho tags: >>%t%.md\necho categories: >>%t%.md\necho - è‰ç¨¿ >>%t%.md\necho --->>%t%.md\necho ä»è¿™é‡Œå¼€å§‹å†™>>%t%.md\n```\n\n\n### htmlEmbedding.py\n\næŠŠ typora å¯¼å‡ºçš„ html ä¸­çš„å›¾ç‰‡è½¬ä¸º base64 ç¼–ç å­—èŠ‚åµŒå…¥ç½‘é¡µä¸­ï¼Œä½¿ä¹‹èƒ½å¤Ÿç¦»çº¿è®¿é—®ã€‚\n\n```python\nimport os,sys, shutil\nfrom bs4 import BeautifulSoup\nimport base64 \nfrom urllib.request import unquote, urlopen\nimport PySimpleGUI as sg\n\nclass app:\n    '''é€šç”¨ç‰ˆç®€æ˜“å·¥å…·ç”¨æˆ·ç•Œé¢\n    1. ä½¿ç”¨å­—å…¸ä¼ å…¥å·¥å…·å‡½æ•°é›†\n    2. æŒ‰é’®å¹³é“ºï¼Œæ¯ä¸ªæŒ‰é’®å¯¹åº”ä¸€ä¸ªå‡½æ•°åŠŸèƒ½\n    '''\n    def __init__(self,app_name,func_dict):\n        self.funcs = func_dict\n        self.layout = self.design()\n        self.window = sg.Window(app_name, \n                                self.layout,\n                                location=(400,400),\n                                grab_anywhere=True,\n                                disable_minimize=True,\n                                keep_on_top=True)\n        self.run()\n    \n    def design(self):\n        layout = [[sg.Button(x) for x in self.funcs.keys()],\n                [sg.Text(\"æ¬¢è¿ä½¿ç”¨\",size=(20,1),key=\"_INFO_\")]]\n        return layout\n    \n    def run(self):\n        while True:\n            event,values = self.window.Read()\n            for key in self.funcs.keys():\n                if event==key:\n                    fp = sg.popup_get_file('æ‰“å¼€éœ€è¦è½¬åŒ–çš„HTMLæ–‡ä»¶')\n                    if fp is not None:\n                        info = self.funcs[key](fp)\n                        self.window.Element(\"_INFO_\").Update(key+\":\"+info)\n            if event is None:\n                break\n        self.window.Close()\n\n# å…ˆä½¿ç”¨typoraå¯¼å‡ºhtmlï¼Œå†ä½¿ç”¨æ­¤ä»£ç æå®šå›¾ç‰‡é“¾æ¥ç¼–ç æˆbase64\n\ndef img_base64(html_filepath):\n    wks,html_filename = os.path.split(html_filepath)\n    with open(os.path.join(wks,html_filename),\"r\",encoding='utf-8') as f:\n        content = f.read()\n    # soup = BeautifulSoup(content,features=\"lxml\")\n    soup = BeautifulSoup(content,features=\"html.parser\")\n    # 2020-06-12 21:03:12\n    # ä»£ç åœ¨æ–°æœºå™¨ä¸­è¿è¡Œå‡ºé”™ï¼Œlxmlä¸è¡Œï¼Œåªå¥½ç”¨html.parser\n    # å‚è€ƒ https://www.cnblogs.com/awakenedy/p/9753326.html\n    imgs = soup.find_all(\"img\")\n    for img in imgs:\n        imgpath = img['src']  \n        # 2020-12-09 17:20:19 å½“é™„ä»¶å›¾åƒå­˜åœ¨äºä¸­æ–‡æ–‡ä»¶å¤¹æ—¶ï¼Œä½¿ç”¨markdown-to-standalone-htmlè½¬åŒ–htmlä¼šä¹±ç ï¼Œéœ€è¦å¤„ç†ä¸€ä¸‹\n        # å‚è€ƒï¼ˆhttps://blog.csdn.net/mouday/article/details/80278938ï¼‰\n        imgpath = unquote(imgpath, encoding='utf-8')\n        pref = imgpath.split(\".\")[-1]\n        \n        if not imgpath.startswith(\"http\"):\n            with open(os.path.join(wks,imgpath),'rb') as f:\n                base64_data = base64.b64encode(f.read())\n        else:\n            try:\n                response = urlopen(imgpath)\n                # ä½¿ç”¨requestsæ¨¡å—ä¼šæŠ¥é”™ã€‚\n                base64_data = base64.b64encode(response.read())\n                # 2021-03-29 14:15:16  å¦‚æœå›¾ç‰‡å·²ç»ä¸Šä¼ åˆ°é˜¿é‡Œäº‘ï¼Œåˆ™æ˜¯é“¾æ¥å½¢å¼\n            except:\n                print('Internet Connection Error')\n                continue\n\n        img['src'] = \"data:image/{};base64,\".format(pref)+str(base64_data,'utf-8')\n        # æ³¨æ„base64æ˜¯bytesï¼Œä½¿ç”¨strè½¬åŒ–æ—¶è¦å¸¦encodingå‚æ•°\n        # å¯¹imgçš„ä¿®æ”¹éƒ½æ˜¯inplaceçš„ï¼Œä»å±äºsoupå¯¹è±¡\n    ex_filename = os.path.join(wks,html_filename)\n    with open(ex_filename,\"w\", encoding='utf-8') as f:\n        ### è¦†ç›–ä¿å­˜htmlæ–‡ä»¶\n        ## 2021-03-29 16:26:15 \n        # æ³¨æ„hexo serverä¹Ÿä¼šæ¸²æŸ“htmlæ–‡ä»¶ï¼Œä½†æ˜¯ä¼šæŠ¥é”™ï¼Œæ‰€ä»¥å¯¼å‡ºhtmlæ–‡ä»¶åè½¬ç§»åˆ°æ¡Œé¢\n        f.write(str(soup))\n    shutil.move(ex_filename, os.path.expanduser('~/Desktop/ex-{}'.format(html_filename)))\n    return \"è½¬åŒ–äº†%då¼ å›¾åƒ\"%(len(imgs))\n\nif __name__ == \"__main__\":\n    app_name = \"img_base64\"\n    func_dict = {\"base64\":img_base64}\n    worker = app(app_name,func_dict)\n    worker.run()\n    # os.system(\"pause\")\n```\n\n","tags":["bib"],"categories":["python"]},{"title":"ä¸ºäº†ç½‘é¡µæ­£å¸¸æ˜¾ç¤ºè„šæ³¨","url":"/2021/04/17/tryButterflyTheme/","content":"\næŠŠè‡ªå·±çš„ä¸»é¢˜ä» stun æ›´æ¢ä¸º butterfl[^b]ï¼Œæ˜¾ç„¶æ˜¯å› ä¸ºåè€…æ›´å¥½çœ‹ä¸€ç‚¹ï¼ˆæˆ‘è¿™ä¸ªé¢œæ§ğŸ˜‚ï¼‰ã€‚å½“ç„¶åˆè¡·æ˜¯æƒ³æ˜¾ç¤ºè„šæ³¨ï¼Œå› ä¸ºæˆ‘å¶å°”ï¼ˆä¹Ÿå¯èƒ½æ˜¯æå°‘æ•°æƒ…å†µï¼‰ä¼šå¸Œæœ›è‡ªå·±æ’å…¥çš„å‚è€ƒæ–‡çŒ®èƒ½å¤Ÿå®Œæ•´æ˜¾ç¤ºåœ¨ç½‘é¡µä¸Šï¼ˆéœ€æ±‚åŒè¿™ä½è€å“¥[^1]ï¼‰ã€‚\n\nä½†æ˜¯ butterfly åŸç”Ÿè®¾ç½®å¹¶ä¸æ”¯æŒï¼Œæˆ‘æŸ¥åˆ°èµ„æ–™è¯´ï¼Œå¾—å®‰è£… hexo-renderer-markdown-it-plus æ’ä»¶[^2]ï¼š\n\n```bash\nnpm un hexo-renderer-marked --save\nnpm i hexo-renderer-markdown-it-plus --save\n```\n\nç„¶åå…·ä½“ä½¿ç”¨ï¼Œç”¨æ–¹æ‹¬å·ï¼Œæ”¾ keyï¼š\n\n```\nThis is something[^key]\n```\n\næ³¨æ„ key å‰é¢å¾—æœ‰ä¸€ä¸ª `^` ç¬¦å·ï¼Œkeyçš„å‘½åå°±æ˜¯è‹±æ–‡å­—æ¯åŠ æ•°å­—å³å¯ï¼Œå¯ä»¥ç­‰åŒäº citation key ã€‚ä¸ç”¨è€ƒè™‘æ’åºé—®é¢˜ï¼Œå‚è€ƒæ–‡çŒ®ç›®å½•ä¼šæ ¹æ®åœ¨æ–‡ä¸­å‡ºç°çš„é¡ºåºè‡ªåŠ¨æ’åºçš„ã€‚\n\nåæ¥åˆå‘ç° butterfly ä¸­å¼€å¯ search çš„æ’ä»¶æœ‰ç‚¹éº»çƒ¦ï¼Œæœæ–­æ¢å›æ¥ stunï¼Œå‘ç° footnote ä¹Ÿèƒ½æ­£ç¡®æ˜¾ç¤ºäº†ï¼Œéå¸¸æ£’ï¼\n\nç„¶åæˆ‘è¿˜å–æ¶ˆäº† post æœ«å°¾çš„ `--- END ---`\n\n```yaml\n# The widget of post.\npost_widget:\n  # Whether to show tags at the bottom of post.\n  tags: true\n  # Whether to show \"------ END ------\" at the bottom of post.\n  end_text:\n    enable: false\n    # Whether to show a horizon line before \"------ END ------\".\n    horizon_line: false\n```\n\n\n\n[^1]: https://zhanghuimeng.github.io/post/add-footnote-plugin-for-hexo-blog/\n[^2]: https://github.com/CHENXCHEN/hexo-renderer-markdown-it-plus\n[^b]: https://github.com/jerryc127/hexo-theme-butterfly\n\n","categories":["blog"]},{"title":"markdownå¯¼å‡ºä¸ºå¸¦å¼•æ–‡ç›®å½•çš„word","url":"/2021/04/17/markdown-word/","content":"\næ–‡çŒ®é˜…è¯»ç¬”è®°æ±‡æ€»ä¹‹åï¼Œæˆ‘è¿˜æƒ³å¯¼å‡ºä¸º word æ–‡æ¡£ï¼Œè€Œä¸”æŠŠå‚è€ƒå¼•æ–‡ç›®å½•æ’å…¥è¿›å»ï¼Œä¸ºæ­¤å†™äº†ä¸€æ®µ python ä»£ç ï¼ŒåŸºäº subprocess æ¨¡å—è°ƒç”¨ pandoc å·¥å…·æ¥å®ç°ï¼š\n\n```python\nimport os, subprocess \n\nclass Word:\n    '''\n    ==æœ¬ç¨‹åºä»…æ”¯æŒwindowsç³»ç»Ÿ==\n    å€ŸåŠ© pandoc å·¥å…·ï¼ˆç‰ˆæœ¬ä¸º2.11ï¼‰ï¼Œ\n    å°† markdown è½¬åŒ–ä¸º wordï¼Œ\n    å¹¶ä¸”å¸¦æœ‰æŒ‡å®šæ ¼å¼çš„å¼•æ–‡ç›®å½•ï¼Œ\n    å¯¼å‡ºæ–‡ä»¶é»˜è®¤ä¿å­˜åˆ° markdown åŒç›®å½•ä¸‹\n    '''\n    def __init__(self, paths):\n        '''\n        paths: å„ç§æ–‡ä»¶è·¯å¾„ç»„æˆçš„å­—å…¸\n        paths['ref'] = å‚è€ƒæ–‡çŒ® bib æ–‡ä»¶è·¯å¾„\n        paths['style'] = å¼•æ–‡æ ¼å¼æ ·å¼ csl æ–‡ä»¶è·¯å¾„\n        paths['template'] = word æ¨¡æ¿æ–‡ä»¶è·¯å¾„\n        paths['text'] = markdown æ–‡ä»¶è·¯å¾„\n        '''\n        self.paths = paths \n        base, _ = os.path.splitext(paths['text'])\n        self.paths['output'] = base + '.docx'\n    \n    def run(self):\n        '''\n        åŸºäº subprocess è°ƒç”¨ pandoc\n        '''\n        wks, fname = os.path.split(self.paths['text'])\n        # ç”±äº markdown å¯¹äºæ’å›¾ä½¿ç”¨çš„ç›¸å¯¹è·¯å¾„ï¼Œ\n        # æ‰€ä»¥éœ€è¦è¿›å…¥åˆ° text æ‰€åœ¨çš„ç›®å½•æ‰§è¡Œæ“ä½œ\n        \n        # pandoc æ›´æ–°åˆ° 2.11 ç‰ˆæœ¬åï¼Œæ— éœ€å¤–éƒ¨ pandoc-citeproc\n        # æ”¯æŒå¯¹ emoji ä»£ç è¿›è¡Œè½¬æ¢\n        command = 'cd \"{mdir}\" && \"pandoc\"\\\n            --citeproc\\\n            --from markdown+emoji\\\n            --bibliography=\"{ref}\"\\\n            --csl=\"{style}\"\\\n            --reference-doc=\"{template}\"\\\n            \"{text}\" -o \"{output}\"'.format(\n            ref = self.paths['ref'],\n            style = self.paths['style'],\n            template = self.paths['template'], \n            text = fname, \n            output = self.paths['output'],\n            mdir = wks, \n        )\n        # More about `--citeproc`\n        # https://pandoc.org/MANUAL.html#citations\n        command_test = 'pandoc --version'\n        ret = subprocess.run(command, \n                             shell=True, \n                             stdout=subprocess.PIPE, \n                             stderr=subprocess.PIPE, \n                             encoding=\"utf-8\", \n                             timeout=30,\n                             )\n        if ret.returncode == 0:\n            print(\"success:\",ret)\n        else:\n            print(\"error:\",ret)\n\nif __name__=='__main__':\n    # ä¸€èˆ¬åªéœ€è¦ä¿®æ”¹éœ€è¦å¯¼å‡ºä¸º word çš„ markdown æ–‡ä»¶è·¯å¾„å³å¯\n    markdown_filepath = r\"D:\\log\\main\\source\\_posts\\read-20210417.md\"\n    paths = {\n        'text': markdown_filepath,\n        'ref': r\"D:\\papers\\library.bib\",\n        'style': r\"D:\\papers\\.styles\\acs-nano.csl\",\n        'template': r\"D:\\papers\\.word-template\\template.docx\",\n    }\n    xxd = Word(paths)\n    xxd.run()\n```\n\næ³¨æ„å¦‚æœæ–‡æ¡£å†…å®¹å¤ªå¤šï¼Œpandoc æ‰§è¡Œæ—¶é—´è¾ƒé•¿ï¼Œå¯èƒ½è§¦å‘ timeout =30 çš„è®¾å®šã€‚","tags":["subprocess","pandoc","word"],"categories":["python"]},{"title":"æ”¶é›† markdown ä¸­çš„å‚è€ƒæ–‡çŒ®å¹¶æ±‡æ€»åˆ° bib","url":"/2021/04/17/markdown-bib/","content":"\næœ‰æ—¶å€™å¯ä»¥ä½¿ç”¨ markdown å¯¹ä¸€ä¸ªä¸»é¢˜æ˜ç¡®çš„èŒƒå›´çš„æ–‡çŒ®åšç²—ç•¥çš„è®°å½•ï¼Œå…¶å®æœ¬èº«å°±æ˜¯èµ·åˆ°äº†ä¸€ä¸ªæ±‡æ€»æ•´ç†çš„ä½œç”¨ï¼Œç„¶åå…¶ä¸­å·²ç»ä½¿ç”¨äº†å¾ˆå¤š citation keyï¼Œå…¶å®å®Œå…¨å¯ä»¥æ ¹æ® key åè¿‡å»ä»æ€»çš„ library.bib åº“ä¸­æŠŠè¿™äº›æ–‡çŒ®è®°å½•æ”¶é›†å‡ºæ¥ï¼Œå½¢æˆä¸€ä¸ªæ–°çš„ refs.bibï¼Œæ‰€ä»¥æˆ‘åˆå†™äº†ä¸€æ®µä»£ç ã€‚ \n\nè¿™ä¸ªå·¥å…·ï¼Œæˆ‘å¸Œæœ›æ˜¯èƒ½å¤Ÿæ”¶é›† markdown æ–‡ä»¶ä¸­çš„ citationsï¼Œç„¶åç”Ÿæˆä¸€ä¸ª subcollection çš„ bib æ–‡ä»¶ï¼Œå­˜æ”¾åœ¨ markdown æ–‡ä»¶çš„é™„å½•ä¸­ã€‚\n\nå¤§è‡´ä¸Šï¼Œbib æ–‡ä»¶çš„è¯»å–å’Œä¿å­˜äº¤ç”±ä¸€ä¸ªç¬¬ä¸‰æ–¹çš„åº“ [bibtexparser](https://bibtexparser.readthedocs.io/en/master/tutorial.html) æ¥æå®šï¼Œcitation key çš„æå–æˆ‘è‡ªå·±ç”¨ [re æ­£åˆ™](https://www.runoob.com/regexp/regexp-rule.html)æ¨¡å—å†™äº†ä¸€ä¸‹ï¼Œåº”è¯¥ä¹Ÿé—®é¢˜ä¸å¤§ã€‚å…·ä½“ä»£ç å¦‚ä¸‹ï¼š\n\n```python\nimport bibtexparser\nfrom bibtexparser.bwriter import BibTexWriter\nfrom bibtexparser.bibdatabase import BibDatabase\nimport os\nimport re\n\nclass Bib:\n    def __init__(self, **fps):\n        '''\n        text.md filepath & library.bib filepath\n        {'text':fp1, 'library':fp2}\n        '''\n        self.fp = fps['text']\n        self.wks, self.fname = os.path.split(self.fp)\n        base, _ = os.path.splitext(self.fp)\n        self.assets = base +'/'  # markdown æ–‡ä»¶çš„é™„ä»¶ç›®å½•\n        self.bibpath = fps['library']\n    \n    def load(self):\n        '''\n        load the library.bib\n        '''\n        fp = self.bibpath\n        with open(fp, encoding='utf-8') as bibtex_file:\n            bib_database = bibtexparser.load(bibtex_file)\n        self.library = bib_database.entries_dict\n        print('{} entries loaded!'.format(len(self.library)))\n    \n    def collect(self):\n        '''\n        collect citation key from text.md\n        '''\n        fp = self.fp\n        with open(fp, 'r', encoding='utf-8') as f: \n            data = f.read()\n        pattern = \"\\[@[^]]+]\"\n        # ä½¿ç”¨æ–¹æ‹¬å·åˆ—ä¸¾ä¸èƒ½åŒ¹é…çš„å­—ç¬¦]ï¼Œç¡®ä¿åªæ‰¾åˆ°ä¸€ä¸ª[@???]\n        a = re.findall(pattern, data)\n        test = ''.join(a)\n        pattern = '@([\\w\\-:.#$%&-+?<>~/]+);?'\n        # citationkeyä¸­å¯èƒ½åŒ…å«ä¸€äº›ç¬¦å·ç±»å­—ç¬¦ï¼Œä»¥ä¸Šéƒ½æ˜¯pandocå…è®¸çš„\n        # https://pandoc.org/MANUAL.html#extension-citations\n        # æ³¨æ„å¯¹ä¸­æ‹¬å·å†…çš„`-`ç¬¦å·è¿›è¡Œè½¬ä¹‰\n        b = re.findall(pattern, test)\n        self.keys = list(set(b))\n        print('{} citations fetched!'.format(len(self.keys)))\n        \n    def save(self):\n        '''\n        save the new subcollection bib file to assets folder\n        https://bibtexparser.readthedocs.io/en/master/tutorial.html#call-the-writer\n        '''\n        if not os.path.exists(self.assets):\n            os.mkdir(self.assets)\n        data = []\n        for key in self.keys:\n            data.append(self.library[key])\n        db = BibDatabase()\n        db.entries = data\n        writer = BibTexWriter()\n        fp2 = os.path.join(self.assets, 'refs.bib')\n        with open(fp2, 'w', encoding='utf-8') as bibfile:\n            # æ³¨æ„ç¼–ç æ˜¯ utf-8ï¼Œé»˜è®¤çš„ gbk ä¼šå‡ºé”™\n            bibfile.write(writer.write(db))\n        print('[Save to] {}'.format(fp2))\n```\n\nä½¿ç”¨åˆ™éå¸¸ç®€å•ï¼ŒåŸºæœ¬ä¸Šåªéœ€è¦ä¿®æ”¹ markdown æ–‡ä»¶è·¯å¾„å³å¯ï¼š\n\n```python\nxxd = Bib(\n    text=r\"D:\\log\\main\\source\\_posts\\read-20210417.md\",\n    library=r\"D:\\papers\\library.bib\"\n)\nxxd.load()\nxxd.collect()\nxxd.save()\n```\n\næ„Ÿè§‰æˆ‘ç°åœ¨å†™ä»£ç éƒ½æˆå¥—è·¯äº†ï¼Œä¸€ä¸ªç±»ï¼Œä¸Šæ¥å°±æ˜¯å…ˆæŠŠ open å’Œ save è€ƒè™‘å¥½ï¼Œç„¶åä¸­é—´å¤„ç†è¿‡ç¨‹å†™æˆç±»çš„æ–¹æ³•ã€‚\n\nç„¶åæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…æ–‡æœ¬ä¹‹ç±»ï¼ŒçœŸçš„æ˜¯æœ‰ç‚¹éš¾ï¼Œä¸»è¦æ˜¯è®°ä¸ä½ã€‚ä½†æ˜¯åé¢æˆ‘å¦‚æœè‡ªå·±æƒ³å†™ä»€ä¹ˆæœç´¢å¼•æ“çš„è¯ï¼Œè‚¯å®šæ˜¯ç¦»ä¸å¼€è¿™ä¸ªçš„ã€‚","tags":["bib","re","æ­£åˆ™å¼"],"categories":["python"]},{"title":"å¤§å˜å±€ä¹‹æˆ‘è§","url":"/2021/04/17/ChinaWillWin/","content":"\nè¿™äº›å¹´å›½å†…å¤–å¤§äº‹å¤šäº†èµ·æ¥ï¼Œå…³é”®å¤„ï¼Œè¿˜æ˜¯ä¸­ç¾ç«äº‰ã€‚è™½ç„¶æˆ‘ä»¬å®˜æ–¹ä¸æ„¿æ„ç”¨ç«äº‰è¿™æ ·çš„å­—çœ¼ï¼Œæ›´çˆ±ç”¨åˆä½œå…±èµ¢çš„æªè¾ï¼Œä½†äº‹å®å°±æ˜¯è¿™æ ·ã€‚\n\næ—¢ç„¶æ˜¯ç«äº‰ï¼Œé‚£ç»ˆç©¶æ˜¯æ®‹é…·çš„ï¼Œæ‰€ä»¥è¿™æ ·ä¸€ä¸ªé˜¶æ®µå„ç§æ–‡æ˜äººéš¾ä»¥ç†è§£çš„äº‹æƒ…ä¸€ä¸€å‘ç”Ÿï¼Œåº•çº¿ä¸€å†è¢«çªç ´ï¼Œä¹Ÿéƒ½éå¸¸æ­£å¸¸ã€‚è¯´ç™½äº†è¿˜æ˜¯é‚£å¥è¯ï¼Œè§„çŸ©å»ºç«‹åœ¨å®åŠ›çš„åŸºç¡€ä¸Šã€‚\n\nä»å‰å‡ å¹´å„ç§å•†ä¸šä¸Šçš„åˆ¶è£ï¼Œç”šè‡³è½¯ç¦ä¸€ä¸ªå…¬å¸çš„é«˜å±‚æ¥æ‰“å‹ä¼ä¸šå‘å±•ï¼Œåˆ°ç°åœ¨BCIæŠµåˆ¶æ–°ç–†æ£‰èŠ±ã€‚çœŸæ­£è®©ä¸–äººè§è¯†åˆ°ä»€ä¹ˆå«åšâ€œæ¬²åŠ ä¹‹ç½ªï¼Œä½•æ‚£æ— è¾ã€‚â€\n\nå¯æ˜¯ï¼Œè¥¿æ–¹å·²ç»ä¹ æƒ¯äº†é‚£ä¸€å¥—å‚²æ…¢ä¸åè§ï¼Œè¡¨é¢äººé“ä¸»ä¹‰ï¼Œå®é™…é‡‘é’±è‡³ä¸Šã€‚ç²¾è‹±ä»¬çš„ä¼ªå–„è¢«ç°å®ä¸æ–­æ‰“è„¸ï¼Œå‰æœ‰ç¾å›½æŠ—ç–«ä¸åŠ›è¿˜å°é”ç–«è‹—ï¼Œåæœ‰æ—¥æœ¬æ ¸æ±¡åºŸæ°´ç›´æ’å¤ªå¹³æ´‹ã€‚æ˜æ˜æœ‰å¾ˆå¤šæ›´å¥½çš„æ–¹æ¡ˆï¼Œä½†æœ€åçš„å†³ç­–å°±æ˜¯è¿™ä¹ˆèµ¤è£¸è£¸ã€‚ä»–ä»¬å·²ç»èµ°ä¸å‡ºé‚£ä¸ªâ€œèˆ’é€‚åœˆâ€å»é€‚åº”ä¸€ä¸ªæ–°ä¸–ç•Œäº†ã€‚\n\næ‰€ä»¥é—®é¢˜æ˜¯ï¼š\n\n1. ä¸­å›½çš„ä¸Šä½æ˜¯å¦ä¼šä¼´éšæˆ˜ç«çº·é£ï¼Ÿ\n2. æœªæ¥ä¸­å›½æ˜¯å¦ä¼šé‡è¹ˆè¿™äº›è¦†è¾™ï¼Ÿ\n3. ä¸ªäººåœ¨è¿™æ ·çš„å¤§åŠ¿ä¸­è¯¥å¦‚ä½•ç«‹èº«ï¼Ÿ\n\nå…³äºç¬¬ä¸€ä¸ªé—®é¢˜ï¼Œä¸–ç•Œå¤§æˆ˜çº§åˆ«çš„æˆ‘ä¼°è®¡å¯èƒ½æ€§è¾ƒå°ã€‚å› ä¸ºæ ¸æ­¦èƒ½ç­ä¸–ï¼Œæèµ·æ¥è°éƒ½è®¨ä¸äº†å¥½ã€‚ä¸è¿‡å±€éƒ¨æˆ˜äº‰æˆ–è€…åœ°åŒºéªšä¹±åº”è¯¥ä¼šæœ‰ä¸€äº›ã€‚æ‰€ä»¥æ²¡å•¥äº‹ä¸è¦å»äººå¤šçš„åœ°æ–¹ï¼Œä¹Ÿä¸è¦åˆ°å¤„ä¹±è·‘ã€‚\n\nè‡³äºç¬¬äºŒä¸ªé—®é¢˜ï¼Œè¿™æ˜¯æ²¡æœ‰ç­”æ¡ˆçš„ï¼Œè¿™å–å†³äºä¸­å›½å…±äº§å…šæ˜¯å¦èƒ½åšæŒä½è‡ªæ´è‡ªå¾‹ï¼Œä¸å¿˜åˆå¿ƒï¼Œå§‹ç»ˆäººæ°‘è‡³ä¸Šï¼Œäº‹äº‹ä¸ºæ°‘ã€‚å¤§ä½“ä¸Šï¼Œæˆ‘æ„Ÿè§‰åœ¨æˆ‘æœ‰ç”Ÿä¹‹å¹´ï¼Œå…±äº§å…šéƒ½ä¸ä¼šæœ‰å¤ªå¤§é—®é¢˜ã€‚ä½†æ˜¯æ›´é•¿è¿œçš„æƒ…å†µï¼Œå°±å–å†³äºå…šçš„æ•™è‚²å®£ä¼ å’Œå…¶ä»–å…šå»ºæ˜¯å¦è½åˆ°å®å¤„äº†ã€‚\n\nç¬¬ä¸‰ä¸ªé—®é¢˜ç¨å¾®å®åœ¨ä¸€ç‚¹ã€‚\n\né¦–å…ˆå˜æ¸…æ¦‚å¿µï¼Œä¸ªäººå°±ä¸“æŒ‡æˆ‘è¿™æ ·çš„æ™®é€šè‰æ ¹å§ï¼Œå‡ºèº«ä¸€èˆ¬ï¼Œå—è¿‡ç‚¹é«˜ç­‰æ•™è‚²ï¼Œæ²¡æœ‰å¤šå°‘å­˜æ¬¾ï¼Œä¹Ÿæ²¡å¤šå°‘äººè„‰ï¼Œå¹²ç€ä¸€ä»½ä¹Ÿæ²¡å¤šå°‘å·¥èµ„çš„å·¥ä½œï¼Œä»€ä¹ˆéƒ½æ˜¯æ™®æ™®é€šé€šçš„èƒŒæ™¯æ¿ä¸€æ ·çš„äººã€‚\n\nè€Œç«‹èº«ï¼Œå°±æ˜¯æ™®é€šäººæ€ä¹ˆæ™®é€šçš„å®‰ç¨³çš„åº¦è¿‡ä¸€ç”Ÿã€‚åƒå–æ‹‰æ’’ï¼Œç”Ÿè€ç—…æ­»ï¼Œä¹°æˆ¿ä¹°è½¦ï¼Œæ•™è‚²åŒ»ç–—ï¼Œæ— è¿‡äºæ­¤ã€‚\n\næ‰€ä»¥å…³äºè¿™ä¸ªé—®é¢˜çš„ç­”æ¡ˆï¼Œå…¶å®æ°æ°åˆæ˜¯ä¸ä»»ä½•å¤§åŠ¿æ— å…³çš„ã€‚å› ä¸ºæ™®é€šäººï¼ŒåŸºæœ¬æ²¡æ³•æŠŠæ¡è¿™ç§åŠ¿ï¼ˆæ²¡å¾—é€‰ï¼‰ã€‚æ—¢ç„¶å¦‚æ­¤ï¼Œä¸€ç›´å¦‚æ­¤ï¼Œé‚£å°±æ˜¯äº‹ä¸šä¸Šåšå¥½åŠ›æ‰€èƒ½åŠçš„äº‹æƒ…ï¼Œå¹³æ—¥é‡Œæ‹¥æœ‰å¥åº·çš„ç”Ÿæ´»æ–¹å¼ï¼Œæ¯ä¸€å¤©éƒ½å°½é‡å……å®ä¸€ç‚¹ï¼Œäººç”Ÿçš„å¹¸ç¦æ„Ÿä¸æˆå°±æ„Ÿå¹¶ä¸ä¼šæ¯”åšå¤§äº‹çš„å¼„æ½®å„¿å·®ã€‚\n","tags":["happiness"],"categories":["life"]},{"title":"æ ¡å›­é£Ÿè®°","url":"/2021/04/16/food_track/","content":"\né£Ÿå ‚èœè¢«ç§°ä½œä¸­å›½çš„ç¬¬ä¹å¤§èœç³»ï¼Œè¿™é‡Œè®°å½•äº†åæ¥å¤©è‡ªå·±åœ¨å­¦æ ¡é£Ÿå ‚çš„é¥®é£Ÿï¼Œæ²¡æœ‰å›¾ç‰‡ï¼Œæƒå½“æ˜¯çœ‹çœ‹è‡ªå·±ä¸ºå•¥ä¼šé•¿èƒ–ã€‚\n\n\n**4æœˆ6æ—¥ï¼ˆæ˜ŸæœŸäºŒï¼‰**\n\næ—©ï¼ŒäºŒé¤ï¼Œè±†è…è„‘ï¼ˆç”œï¼‰ï¼Œæ¢…å¹²èœçƒ§é¥¼\nåˆï¼Œä¸ƒé¤ï¼Œè¥¿å…°èŠ±ï¼Œå®«ä¿é¸¡ä¸ï¼Œé’èœ\næ™šï¼Œå››é¤ï¼Œæ¸¯å¼çƒ§è…Šï¼ˆåŒæ‹¼ï¼‰\n\n**4æœˆ7æ—¥ï¼ˆæ˜ŸæœŸä¸‰ï¼‰**\n\næ—©ï¼ŒäºŒé¤ï¼Œç‰ç±³æ±ï¼Œå±±ä¸œç…é¥¼ï¼ˆåœŸè±†ä¸ï¼Œæµ·å¸¦ä¸ï¼‰\nåˆï¼Œå…­é¤ï¼Œå†œå®¶èœï¼ˆè±‡è±†ï¼Œè…Šè‚‰ç¬‹ï¼Œé’èœæ²¹è±†è…ï¼‰\næ™šï¼Œä¸ƒé¤ï¼Œå¹³è‡ï¼Œç²‰æ¡ï¼Œè’œè‹”\n\n**4æœˆ8æ—¥ï¼ˆæ˜ŸæœŸå››ï¼‰**\n\næ—©ï¼ŒäºŒé¤ï¼Œè‚‰å¤¹é¦ï¼Œæ°´ç…®è›‹ï¼Œè±†æµ†\nåˆï¼Œä¸ƒé¤ï¼ŒèŒ„å­ï¼Œèåœï¼Œé»„ç“œ\næ™šï¼Œä¸ƒé¤ï¼Œè’œè‹”ï¼ŒåœŸè±†ç‰›è‚‰ç‰‡ï¼ŒåŒ…èœ\n\n**4æœˆ9æ—¥ï¼ˆæ˜ŸæœŸäº”ï¼‰**\n\næ—©ï¼Œä¸€é¤ï¼Œå…«å®ç²¥ï¼Œå¤©å¥è‚‰é¥¼\nåˆï¼ŒäºŒé¤ï¼Œé‡‘é’ˆè‡è‚¥ç‰›ç²‰ä¸ï¼ˆç‰›ç™¾ç¢—ï¼‰\næ™šï¼Œå››é¤ï¼Œå‰çƒ§é¥­\n\n**4æœˆ10æ—¥ï¼ˆæ˜ŸæœŸå…­ï¼‰**\n\næ—©ï¼Œå®¶é‡Œï¼Œè”æå‘³æœå¥¶ï¼Œè‰è“ï¼Œåå¸\nåˆï¼Œä¸ƒé¤ï¼Œè’œè‹”ï¼Œé¸¡è…¿ï¼ŒåœŸè±†çƒ§æ’éª¨ï¼Œé¦™è‡\næ™šï¼Œç‰å…°è‹‘ï¼Œæœ¨æ¡¶é¥­ï¼ŒèŒ„å­é¸¡è‚‰åŒæ‹¼\n\n**4æœˆ11æ—¥ï¼ˆæ˜ŸæœŸå¤©ï¼‰**\n\næ—©ï¼Œå®¶é‡Œï¼Œé’æ¤’é¸¡è›‹æ‚ç²®é¥¼\nåˆï¼Œå®¶é‡Œï¼Œå±±è¯ç‚–æ’éª¨\næ™šï¼Œå®¶é‡Œï¼Œç…è±†è…ï¼Œé’èœæ‹Œé¥­ï¼Œèƒ¡èåœä¸ç‚’é¸¡è›‹\n\n**4æœˆ12æ—¥ï¼ˆæ˜ŸæœŸä¸€ï¼‰**\n\næ—©ï¼Œå®¶é‡Œï¼Œé“¶è€³æ±¤ï¼Œè‡ªåˆ¶åå¸\nåˆï¼Œä¸ƒé¤ï¼Œæ°´ç…®è‚‰ç‰‡ï¼Œå†¬ç“œï¼Œè¥¿å…°èŠ±\næ™šï¼Œäº”é¤ï¼ŒçŸ³é”…è‚‰ç³œèŒ„å­\n\n**4æœˆ13æ—¥ï¼ˆæ˜ŸæœŸäºŒï¼‰**\n\næ—©ï¼Œå®¶é‡Œï¼Œé¢åŒ…ï¼Œç‰›å¥¶ï¼Œé¸¡è›‹\nåˆï¼Œä¸ƒé¤ï¼Œçº¢çƒ§é±¼å—ï¼Œæ°´ç…®è‚‰ç‰‡ï¼Œè¥¿å…°èŠ±\næ™šï¼Œå››é¤ï¼Œæ¸¯å¼çƒ§è…Šï¼ˆåŒæ‹¼ï¼‰\n\n**4æœˆ14æ—¥ï¼ˆæ˜ŸæœŸä¸‰ï¼‰**\n\næ—©ï¼ŒäºŒé¤ï¼Œè±†èŠ±ï¼Œå±±ä¸œç…é¥¼ï¼ˆåœŸè±†ä¸ï¼Œæµ·å¸¦ä¸ï¼‰\nåˆï¼Œä¸ƒé¤ï¼Œç¬‹ç‰‡ï¼Œæ°´ç…®è‚‰ç‰‡ï¼ŒåœŸè±†æ’éª¨\næ™šï¼Œä¸ƒé¤ï¼Œç‚¸å°è™¾ï¼Œçº¢çƒ§é±¼å—ï¼Œæé²è‡è‚‰ç‰‡\n\n**4æœˆ15æ—¥ï¼ˆæ˜ŸæœŸå››ï¼‰**\n\næ—©ï¼Œå®¶é‡Œï¼Œé¢åŒ…ï¼Œé¸­ç¿…æ ¹ï¼ŒADé’™å¥¶\nåˆï¼Œä¸ƒé¤ï¼Œé¸¡è…¿ï¼Œè¥¿çº¢æŸ¿ç‚’è›‹ï¼Œç¬‹ç‰‡\næ™šï¼Œäº”é¤ï¼ŒçŸ³é”…é¸¡æŸ³\n\n**4æœˆ16æ—¥ï¼ˆæ˜ŸæœŸäº”ï¼‰**\n\næ—©ï¼Œå®¶é‡Œï¼Œé¢åŒ…ï¼ŒADé’™å¥¶\nåˆï¼Œä¸ƒé¤ï¼Œç‚¸é¸¡ï¼ŒèŒ„å­ï¼Œè±‡è±†ï¼Œç™½èœ\næ™šï¼Œä¸‰é¤ï¼Œéº»è¾£é¦™é”…","tags":["food","é£Ÿå ‚"],"categories":["life"]},{"title":"Kå‡å€¼èšç±»å’Œä¸‰ç‚¹ç»“æ„è¿‡æ»¤","url":"/2021/04/15/KMeans_clustering_filter/","content":"\nä» picasso ä¸­ pick å‡ºæ¥çš„ 6HB ä¸‰ç‚¹ç»“æ„ï¼Œä¼šæœ‰ä¸€äº›å› ä¸ºæŠ˜çº¸å˜å½¢è€Œä¸æ˜¯å…¸å‹çš„â€œä¸‰ç‚¹ä¸€çº¿â€ï¼Œä¸ºäº†é¿å…è¿™äº›ç»“æ„å¯¹åé¢åšå›¾åƒå¹³å‡çš„å¹²æ‰°ï¼Œæˆ‘å†™äº†ä¸€ä¸ªè¿‡æ»¤å™¨ã€‚ç”±äºæ¯ä¸ªç»“æ„å›ºå®šç”±ä¸‰ä¸ªå­ç°‡ç»„æˆï¼Œæ‰€ä»¥æˆ‘é€‰æ‹©äº†`Kå‡å€¼èšç±»`æ¥å¤„ç†ï¼ˆè§`applyKMeanFilter`é€’å½’å‡½æ•°ï¼‰ï¼Œå¹¶ä¸”å¾—åˆ°æ¯ä¸ªå­ç°‡çš„ä¸­å¿ƒåæ ‡ï¼Œç„¶ååŸºäºä¸‰ä¸ªç‚¹åæ ‡æ¥åˆ¤æ–­å½¢çŠ¶ï¼ˆ`cluster_filter`å‡½æ•°ï¼‰ã€‚è€Œå…¨éƒ¨æ•°æ®çš„è¯»å–ã€åˆ†ç»„ã€éå†ã€è¿‡æ»¤ã€æ”¶é›†å’Œä¿å­˜ï¼Œåˆ™äº¤ç”±`SpotFilter`è¿™ä¸ªç±»æ¥æå®šã€‚è¿™éƒ¨åˆ†ä»£ç çŸ¥è¯†ç‚¹æµ“åº¦å¤ªé«˜ï¼Œæ²¡æœ‰æ—¶é—´ä¸€ä¸€ç½—åˆ—ï¼Œå¹¸å¥½å¹³æ—¶æ³¨é‡Šä¹Ÿè¿˜ç®—æ¸…æ¥šï¼Œæ‰€ä»¥ç›´æ¥è´´ä»£ç ğŸ‘‡ï¼š\n\n```python\nimport numpy as np\nimport pandas as pd\nfrom sklearn.cluster import KMeans \nimport h5py \nimport os, shutil\nimport itertools  # æ–¹ä¾¿åšæ’åˆ—ç»„åˆ\nimport matplotlib.pyplot as plt\n\n\ndef applyKMeanFilter(region, cluster_number=3, **params):\n    '''\n    é€’å½’å¯¹å•ä¸ªregionï¼ˆdataframeï¼‰è¿›è¡ŒåŸä½å¤„ç†ï¼Œ\n    è¿”å›ç¬¦åˆæ¡ä»¶çš„cluster_labels(a list), å¦‚[(0, 2, 3)]\n    ä»¥åŠæå–è¿‡åçš„region_new\n    **params:\n    params['bias']: ä¸­å¿ƒåç½®è·ç¦»ï¼Œä¸è¶…è¿‡20 nm  \n    params['interval']: ç«¯è·ï¼Œå›ºå®šä¸º240 nm  \n    params['tolerance']: ç«¯è·å®¹å¿åº¦ï¼Œé»˜è®¤30nm  \n    '''\n    if cluster_number>10 or len(region)<cluster_number:\n        # æœ€å¤š10ä¸ªcluster\n        return False\n    ### è®¡ç®—ä¸€ä¸ªpick regioné‡Œè¾¹çš„èšç±»ä¸­å¿ƒåæ ‡\n    region = region.copy()\n    # é¿å…settingWithCopyWarning\n    X = region.filter(items=['x','y'])\n    X = np.array(X)\n    kmeans = KMeans(n_clusters=cluster_number, random_state=0).fit(X)\n    # æ³¨æ„å¦‚æœæ ·æœ¬æ•°é‡å°äºn_clustersä¹Ÿä¼šæŠ¥é”™\n    \n    region['Cluster'] = kmeans.labels_\n    gp = region.groupby(by=['Cluster'])\n    cluster_centers = {}\n    for key,df in gp:\n        cluster_centers[key] = np.array([df.x.mean(), df.y.mean()]) \n        # å­—å…¸çš„å€¼åšæˆarrayï¼Œæ–¹ä¾¿åé¢è®¡ç®— \n    \n    labels = cluster_filter(cluster_centers, **params) \n    # è‡ªå®šä¹‰è¿‡æ»¤è§„åˆ™\n    \n    if len(labels)==0 and labels:\n        labels, region = applyKMeanFilter(region, \n                                  cluster_number=cluster_number+1, \n                                  **params) \n        # æ³¨æ„è¿™é‡Œè¦æœ‰è¿”å›å€¼ï¼Œä¸ç„¶æ²¡ä¸œè¥¿    \n    return labels, region\n\n\ndef cluster_filter(centers, \n                   bias=30, \n                   interval=240, \n                   tolerance=30, \n                   pixelsize = 160, \n                   show=False, \n                   **params\n                  ):\n    '''\n    centers: dictï¼Œèšç±»ä¸­å¿ƒåæ ‡ï¼Œå¸¦cluster_label, {label:[x, y]}\n    bias: ä¸‰ç‚¹patternä¸­å¿ƒçš„æœ€å¤§åç½®è·ç¦» \n    interval: ä¸‰ç‚¹patternä¸¤ç«¯æœ€å°è·ç¦»\n    tolerance: ç«¯è·ç¦»çš„å®¹å¿å˜åŒ–èŒƒå›´\n    show: å¯ä»¥å¯¹å„ä¸ªç»„åˆè¿›è¡Œä½œå›¾\n    '''\n    ehi = np.array([bias, interval, tolerance])/pixelsize\n    bias, interval, tolerance = ehi\n    tris = []\n    for keys in itertools.combinations(centers, 3):\n        triangle = [centers[key] for key in keys]  \n        # æŠŠå…ƒç»„å˜æˆlistï¼Œæ–¹ä¾¿åé¢pop\n        cc = np.mean(triangle, axis=0)  \n        # è®¡ç®—ä¸‰è§’å½¢ä¸­å¿ƒ\n        \n        if show:\n            allPoints = np.array(list(centers.values()))\n            plt.scatter(allPoints[:,0], allPoints[:,1])\n            ttt = np.array(triangle)\n            plt.plot(ttt[:,0], ttt[:,1],'r-.')\n            plt.text(cc[0], cc[1], '* center')\n            plt.show()\n            \n        cid = 100 # é¢„å®šä¹‰ä¸€ä¸ªé”™è¯¯çš„ç´¢å¼•ï¼Œcid=0ï¼Œ1ï¼Œ2\n        for idx, p in enumerate(triangle):\n            d = np.linalg.norm(p - cc)\n            if d<bias:\n                # è‹¥åç½®è·ç¦»è¶³å¤Ÿå°ï¼Œè®¤ä¸ºæ­¤ç‚¹ä¸ºçº¿æ®µä¸­ç‚¹\n                cid = idx\n        if cid>2:\n            # å¦‚æœæ²¡æœ‰ä¸€ä¸ªé¡¶ç‚¹çš„åç½®è·ç¦»åœ¨å®¹å¿èŒƒå›´å†…ï¼Œåˆ™è¿›å…¥ä¸‹ä¸€ä¸ªå¾ªç¯\n            continue\n        else:\n            # è®¡ç®—ä¸¤ä¸ªç«¯ç‚¹è·ç¦»\n            tt = triangle.copy()  \n            # ç”±äºtriangleè¦å›æ”¶ï¼Œpopä¼šç ´ååŸlistï¼Œæ‰€ä»¥è¿™é‡Œå¤åˆ¶ä¸‹\n            b = tt.pop(cid)  \n            # popè¿”å›ç»ˆç‚¹ï¼Œå‰©ä¸‹ä¸¤ä¸ªæ˜¯ç«¯ç‚¹\n            dt = np.linalg.norm(tt[0] - tt[1])\n            if abs(dt-interval)<tolerance:\n                tris.append(keys)  \n                # å›æ”¶ç¬¦åˆè§„åˆ™çš„ç»„åˆï¼Œä¹Ÿå°±æ˜¯centersçš„labelå³å¯\n    return tris\n\n\nclass SpotFilter:\n    def __init__(self, fp):\n        '''\n        fp: picasso hdf5 files with `_picked.hdf5` suffix \n        and the `group` column existed!\n        '''\n        self.filepath = fp\n        self.data = pd.read_hdf(fp, key='locs')\n        self.gp = self.data.groupby('group')\n        print('{} structure loaded!'.format(len(self.gp)))\n    \n    def run(self, **params):\n        newdata = []\n        for key, region in self.gp:\n            labels, region_ = applyKMeanFilter(region)\n            if labels:\n                # å¦‚æœlabelsè¿”å›å€¼ä¸ºFalseï¼Œè¯´æ˜n_clustersåˆ°10äº†éƒ½æ²¡æ‰¾åˆ°\n                region_new = region_[region_['Cluster'].isin(labels[0])]\n                newdata.append(region_new)\n        self.newdata = pd.concat(newdata, ignore_index=True)\n        gp = self.newdata.groupby('group')\n        print('{} structures left!'.format(len(gp)))\n\n    def sampling(self, frac=0.5):\n        '''\n        å¯ä»¥ä¿å­˜éƒ¨åˆ†ç»“æ„ï¼Œfracæ˜¯samplingçš„æŠ½æ ·æ¯”ä¾‹\n        '''\n        gids = []\n        for key, _ in self.gp:\n            gids.append(key)\n        gids = pd.Series(gids, name='groupID')\n        gids2 = gids.sample(frac=frac)\n        print('{} structures fetched!'.format(len(gids2)))\n        data = []\n        for gid in gids2:\n            data.append(self.gp.get_group(gid))\n        self.newdata = pd.concat(data, ignore_index=True)\n    \n    def save(self, suffix='_filtered'):\n        '''\n        suffix æ˜¯hdf5æ–‡ä»¶åç¼€\n        '''\n        df = self.newdata\n        base, _ = os.path.splitext(self.filepath)\n        fp = base + suffix + '.hdf5'\n        fp_yaml = base + suffix + '.yaml'\n        OBJ = [df[x].values for x in df.columns]\n        DTYPE = [(x, df[x].dtype) for x in df.columns]\n        g = np.rec.array(OBJ, dtype=DTYPE)\n        with h5py.File(fp,'w') as f:\n            f.create_dataset('locs', data=g)\n        # æ‹·è´yamlæ–‡ä»¶è®°å½•\n        shutil.copy(base+'.yaml', fp_yaml)\n        print('[Saved to] {}'.format(fp))\n```\n\nè¿è¡Œèµ·æ¥ä¹Ÿéå¸¸ç®€å•ï¼Œåªè¦æŠŠç¬¦åˆè¦æ±‚çš„æ•°æ®æ–‡ä»¶çš„è·¯å¾„è¾“å…¥è¿›`Spot_Filter`ç±»ä¸­ï¼Œåˆå§‹åŒ–ä¸€ä¸ªå¯¹è±¡ï¼Œç„¶åè°ƒç”¨æ–¹æ³•å³å¯ï¼š\n\n![image-20210415114955338](https://sheldon-notes.oss-cn-shanghai.aliyuncs.com/img/image-20210415114955338.png)\n\næ³¨æ„ï¼Œå¦‚æœåªæ˜¯æƒ³å¯¹åŸæ¥çš„æ•°æ®åšéšæœºæŠ½æ ·è€Œä¸åšç»“æ„ç­›é€‰ï¼Œå¯ä»¥æŠŠ `a.run()` æ›¿æ¢ä¸º `a.sampling(frac=0.5)` ã€‚\n\n","tags":["KMeans","itertools","sklearn","èšç±»","è¿‡æ»¤","æŠ½æ ·"],"categories":["python"]},{"title":"æ–‡çŒ®é˜…è¯»æ—¥å¿—æ±‡æ€»å°å·¥å…·","url":"/2021/04/14/summarize_tool_for_reading_notes/","content":"\né˜…è¯»æ–‡çŒ®äº§ç”Ÿçš„é›¶ç¢çš„è®°å½•ï¼Œä¹Ÿéœ€è¦æ—¶ä¸æ—¶æ±‡æ€»ç„¶å review ä¸€ä¸‹ã€‚å› æ­¤æˆ‘è‡ªå®šä¹‰äº†è§„åˆ™ï¼Œä½†å‡¡é˜…è¯»æ–‡çŒ®çš„è®°å½•å—ï¼Œå…¶ä¸‰çº§æ ‡é¢˜å¸¦ `:apple:` æ ‡è®°ï¼Œæ‰€ä»¥æˆ‘æ”¹å†™äº†ä¹‹å‰æ±‡æ€»å®éªŒæ—¥å¿—çš„ä»£ç ï¼Œéå¸¸å°çš„ä¿®æ”¹ï¼Œå¢åŠ äº†ä»£ç çš„å¤ç”¨æ€§ï¼Œæ–¹ä¾¿ä»¥åè¿˜æœ‰ä»€ä¹ˆå…¶ä»–çš„ç±»å‹çš„è®°å½•éœ€è¦æ±‡æ€»æ”¶é›†ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n\n```python\nimport os, glob, time \n\ndef markdown_parser(fp, emoji_tag=':apple:', **params):\n    with open(fp, 'r', encoding='utf-8') as f:\n        a = f.readlines()\n        \n    # æ‰¾åˆ°æ‰€æœ‰çš„ä¸‰çº§æ ‡é¢˜\n    tids = []\n    for idx, line in enumerate(a):\n        if line.startswith('### '):\n            tids.append(idx)\n            \n    # å¯¹ä¸‰çº§æ ‡é¢˜è¿›è¡Œéå†ï¼Œå¸¦emoji_tagçš„æ”¶é›†è¯¥éƒ¨åˆ†å†…å®¹\n    data = []\n    for idx, tid in enumerate(tids):\n        if a[tid].startswith('### {}'.format(emoji_tag)):\n            if idx+1 < len(tids):\n                data.extend(a[tids[idx]:tids[idx+1]])\n                # å¦‚æœæœ€åä¸€ä¸ªæ ‡é¢˜æ˜¯appleï¼Œ+1ä¼šæŠ¥é”™\n            elif idx == len(tids)-1: \n                data.extend(a[tids[idx]:])\n    \n    # å¦‚æœå½“å¤©æ—¥å¿—æ²¡æœ‰é˜…è¯»éƒ¨åˆ†å†…å®¹ï¼Œè¿”å›False\n    if len(data)>0:\n        return data\n    else:\n        return False \n \ndef summarize(wks, prefix='read', title_prefix='é˜…è¯»è®°å½•æ±‡æ€»', **params):\n    # å‡†å¤‡æ±‡æ€»æ–‡ä»¶ç›¸å…³ä¿¡æ¯\n    tt = time.time()\n    tl = time.localtime(tt)\n    dd = time.strftime('%Y%m%d',tl)\n    summary_filename = \"{}-{}.md\".format(prefix, dd)\n    timeStamp = time.strftime('%Y-%m-%d %H:%M:%S',tl)\n    frontMatter = \"---\\ntitle: {}-{}\\nexcerpt: \\ndate: {}\\ntags: \\ncategories: \\n- å·¥ä½œ\\n---\\n\".format(title_prefix, dd, timeStamp)\n    all_info = [frontMatter]\n    \n    # è¯»å–æ–‡ä»¶åˆ—è¡¨å¹¶æŒ‰ç…§åˆ›å»ºæ—¶é—´æ’åºï¼Œæœ€æ–°çš„idä¸º-1\n    fileList = glob.glob(wks+'/*.md')\n    logs = sorted(fileList, key=os.path.getctime)\n    \n    # æ”¶é›†å¸¦æœ‰expå‰ç¼€çš„æ–‡ä»¶id\n    sids = []\n    for idx, fp in enumerate(logs): \n        _, fname = os.path.split(fp)\n        if fname.startswith(prefix):\n            sids.append(idx)\n\n    # æŒ‰ç…§å·²æœ‰è®°å½•æ”¶é›†æ–°è¿‘åˆ›å»ºçš„æ—¥å¿—æ–‡ä»¶\n    parts = logs[sids[-1]+1:]\n    \n    # éå†æ–‡æ¡£å®Œæˆå¸¦`apple`æ ‡ç­¾éƒ¨åˆ†æ®µè½çš„æ”¶é›†\n    for fp in parts:\n        _, fname = os.path.split(fp)\n        fdate, _ = fname.split(\".\")\n        memos = markdown_parser(fp, **params)\n        if memos:\n            all_info.append(\"\\n\\n## {}\\n\\n\".format(fdate))\n            # é˜²æ­¢å‰é¢çš„å†…å®¹æ²¡æœ‰æ¢è¡Œï¼ŒäºŒçº§æ ‡é¢˜å¤±æ•ˆ\n            all_info.extend(memos)\n    \n    # å†™å…¥æ‰€æœ‰æ”¶é›†çš„ä¿¡æ¯åˆ°æ–‡æ¡£\n    fpp = os.path.join(wks, summary_filename)\n    with open(fpp, 'w', encoding='utf-8') as f: \n        for part in all_info:\n            f.write(part)\n    print('{}æˆåŠŸ!'.format(title_prefix))\n\n\nif __name__==\"__main__\":\n    ## the path to where you store logs\n    wks = r'd:\\log\\main\\source\\_posts'  \n\n    ## summarize the `:apple:` reading parts\n    summarize(wks, prefix='read', title_prefix='é˜…è¯»è®°å½•æ±‡æ€»', emoji_tag=':apple:')\n\n    ## summarize the `:memo:` log parts\n    # summarize(wks, prefix='exp', title_prefix='å®éªŒè®°å½•æ±‡æ€»', emoji_tag=':memo:')\n```\n\n","tags":["yaml","markdown"],"categories":["python"]},{"title":"jupyterlabå°é²œ","url":"/2021/04/13/try_jupyter_3/","content":"\nå‘ç° jupyter lab å·²ç»å‘å¸ƒäº† 3.0 çš„ç‰ˆæœ¬ï¼Œ[å…·æœ‰ä¸å°‘æ–°ç‰¹æ€§](https://finance.sina.com.cn/tech/2021-01-07/doc-iiznezxt1033961.shtml)ï¼Œé‚å†³å®šå®‰è£…ä¸€ä¸ªè¯•è¯•ï¼š\n\n```bash\nconda install -c conda-forge jupyterlab=3\n```\n\nç»“æœå´æ˜¯æŠ¥é”™ï¼š\n\n```\nSolving environment: failed with initial frozen solve. Retrying with flexible solve.\n```\n\nåˆšå¼€å§‹æˆ‘è¿˜ä»¥ä¸ºæ˜¯è‡ªå·±çš„é•œåƒæºè®¾ç½®æœ‰é—®é¢˜ï¼Œåæ¥åˆ°ç½‘ä¸ŠæŸ¥äº†ä¸€åœˆï¼Œæœ€åå†³å®šæ›´æ–°ä¸€ä¸‹ï¼š\n\n```bash\nconda update --all\n```\n\næŠŠæ‰€æœ‰çš„åŒ…å°½å¯èƒ½åœ°æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬ï¼Œç»ˆäºè§£å†³äº†é—®é¢˜ï¼Œ**è€Œä¸” jupyter lab ä¹Ÿè‡ªåŠ¨æ›´æ–°åˆ°äº† 3.0 ç‰ˆæœ¬**ã€‚ç„¶åæ˜¯å®‰è£…ä¸­æ–‡è¯­è¨€åŒ…ï¼Œç”±äº PyPI å’Œ TUNA çš„é•œåƒéƒ½è¿˜æ²¡æœ‰ï¼Œ[è¿˜å¾—è‡ªå·±ä¸‹è½½è½®å­](https://blog.csdn.net/yy_diego/article/details/114281868)ï¼š\n\n```bash\nwget https://jfds-1252952517.cos.ap-chengdu.myqcloud.com/jupyterhub/jupyterlab_language_pack_zh_CN-0.0.1.dev0-py2.py3-none-any.whl\npip install xxx.whl\n```\n\nç„¶åå°±æ˜¯[å®‰è£…å„ç§æ’ä»¶](https://www.cnblogs.com/feffery/p/13364668.html)ï¼Œæˆ‘å…ˆåˆ° jupyterlab çš„æ’ä»¶ç®¡ç†å™¨é‡Œè¾¹æ‰¾äº†æ‰¾ï¼Œä½†æ˜¯å‘ç°ç›´æ¥ç‚¹å‡»æŒ‰é’®å®‰è£…ä¼šæŠ¥é”™ï¼Œæ€»ä¹‹å°±æ˜¯ jupyter labextension è¿˜æ˜¯æœ‰äº›é—®é¢˜ï¼Œæ‰€ä»¥æˆ‘åªèƒ½é€‰æ‹© pip çš„æ–¹å¼å®‰è£…æ’ä»¶ï¼Œé¦–å…ˆæˆ‘å°±å®‰è£…äº†ä¸€ä¸ª [code snippet çš„æ’ä»¶](https://github.com/jupytercalpoly/jupyterlab-code-snippets)ï¼Œå¯ä»¥ä¿å­˜è‡ªå·±é«˜åº¦å¤ç”¨çš„ä¸€äº›ä»£ç å—ã€‚\n\n```bash\npip install jupyterlab-code-snippets\n```\n\n> snippets çš„ä»£ç å—ä¼šä»¥ json æ–‡ä»¶ä¿å­˜åˆ° å¯åŠ¨ç›®å½•çš„ snippets å­ç›®å½•ä¸‹ã€‚\n\nç¬¬äºŒä¸ªæ’ä»¶å°±æ˜¯ä»£ç è¡¥å…¨äº†ï¼Œåˆ°ç½‘ä¸Šæ‰¾äº†ä¸€ä¸‹ï¼Œå†³å®šä½¿ç”¨å¾ˆå¤šäººæ¨èçš„ [kite](https://github.com/kiteco/jupyterlab-kite#installing-the-kite-extension-for-jupyterlab)ã€‚ç„¶åæ‰§è¡Œä»£ç ï¼š\n\n```bash\npip install \"jupyterlab-kite>=2.0.2\"\n```\n\n> å®‰è£…æŠ¥é”™ï¼Œæ˜¾ç¤ºæ–‡ä»¶åæˆ–æ‹“å±•åå¤ªé•¿ï¼Œå¯ä»¥å‚è€ƒ[å¦‚ä½•åœ¨Windows 10ä¸­æ›´æ”¹é»˜è®¤256ä¸ªå­—ç¬¦è·¯å¾„é™åˆ¶(MAX_PATH)](https://knowledge.autodesk.com/zh-hans/search-result/caas/sfdcarticles/sfdcarticles/CHS/The-Windows-10-default-path-length-limitation-MAX-PATH-is-256-characters.html)ä¿®æ”¹æ³¨å†Œè¡¨è§£å†³ã€‚\n>\n> HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\FileSystem>LongPathsEnabled=1\n>\n> ä½¿ç”¨è¯¥æ’ä»¶éœ€è¦ä¿æŒ kite å¼•æ“å¤„äºå¼€å¯çŠ¶æ€ï¼Œç¬¬ä¸€æ¬¡ä½¿ç”¨æ—¶ä¼šåˆå§‹åŒ–ï¼Œindexing æ—¶é—´æ¯”è¾ƒé•¿ã€‚\n\nç¬¬ä¸‰ä¸ªæ’ä»¶æ˜¯ [matplotlib äº¤äº’æ’ä»¶](https://github.com/matplotlib/ipympl#readme)ï¼Œå› ä¸ºæˆ‘ç»å¸¸ä½œå›¾ï¼Œå¯ä»¥ä½¿ç”¨ jupyter-matplotlib æ’ä»¶ï¼š\n\n```\npip install ipympl\n```\n\nåœ¨ä½¿ç”¨è¿™ä¸ªæ’ä»¶çš„æ—¶å€™ï¼Œéœ€è¦è¾“å…¥é­”æ³•å‘½ä»¤ï¼š\n\n```ipynb\n%matplotlib widget\n```\n\næ³¨æ„ï¼Œå¦‚æœè¦å¯¼å‡º notebook ä¸ºåµŒå…¥ç½‘é¡µï¼Œè¿™ç§äº¤äº’å¼çš„å›¾è¡¨ä¸ä¼šæ˜¾ç¤ºï¼Œå†æ¬¡æ‰“å¼€ notebook ä¹Ÿä¸ä¼šæ˜¾ç¤ºï¼Œæ‰€ä»¥å¹³æ—¶æœ€å¥½è¿˜æ˜¯ä½¿ç”¨ `%matplotlib inline`ã€‚\n\nç¬¬å››ä¸ªæ’ä»¶æ˜¯æ˜¾ç¤ºæ‰§è¡Œæ—¶é—´çš„æ’ä»¶ [jupyterlab-execute-time](https://github.com/deshaw/jupyterlab-execute-time)ï¼Œæ–¹ä¾¿æˆ‘çŸ¥é“æ¯ä¸€ä¸ª cell å…·ä½“çš„è¿è¡Œæ—¶é—´æˆ³ï¼Œæœ‰åŠ©äºå›æº¯è®°å½•ï¼š\n\n```\npip install jupyterlab_execute_time\n```\n\nå¼€å¯è¿™ä¸ªåŠŸèƒ½ï¼Œéœ€è¦åˆ°  Settings->Advanced Settings Editor->Notebook é‡Œè¾¹æ·»åŠ ç”¨æˆ·è®¾ç½®`{\"recordTiming\": true}`ï¼Œå› ä¸ºé»˜è®¤çš„è¿™ä¸ª falseã€‚\n\n> æ›´å¤šå…³äº jupyterlab çš„æ’ä»¶è¯·å‚è€ƒ[è¿™ä¸ª github é¡¹ç›®](https://github.com/mauhai/awesome-jupyterlab)ã€‚\n\næœ€åï¼Œåˆ›å»ºä¸€ä¸ªæ‰“å¼€ jupyterlab å¹¶ä¸”æŒ‡å®šå·¥ä½œç›®å½•çš„å¿«æ·æ–¹å¼ï¼š\n\n![image-20210413214741109](https://sheldon-notes.oss-cn-shanghai.aliyuncs.com/img/image-20210413214741109.png)\n\n```\n[...] C:\\Users\\$USERNAME$\\anaconda3\\Scripts\\jupyter-lab-script.py \"D:\\fire\\02-jupyterSpace\"\n```\n\nä¿®æ”¹å¿«æ·æ–¹å¼çš„ç›®æ ‡å†…å®¹å¦‚ä¸Šæ‰€ç¤ºå³å¯ã€‚\n\n","tags":["jupyterlab"],"categories":["python"]},{"title":"å•æŒ‡æ•°åˆ†å¸ƒæ•°æ®çš„ä½œå›¾","url":"/2021/04/12/singleExpDist_plot/","content":"ä»åšå£«åˆ°ç°åœ¨ï¼ŒoriginLab ç”¨çš„è¶Šæ¥è¶Šå°‘ï¼Œ python ç”¨å¾—è¶Šæ¥è¶Šå¤šï¼Œä¸ä»…ä»…æ˜¯æ•°æ®åˆ†æï¼Œä½œå›¾ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œè¿™ç¯‡æ–‡ç« ç®€å•è®°å½•äº†ç»˜åˆ¶å•æŒ‡æ•°ç›´æ–¹åˆ†å¸ƒå›¾è¡¨çš„ææ³•ã€‚\n\n### ä½œå›¾æ•ˆæœ\n\nå…ˆæ”¾æ•ˆæœå›¾ï¼š\n\n![image-20210412141534347](https://sheldon-notes.oss-cn-shanghai.aliyuncs.com/img/image-20210412141534347.png)\n\nå·¦ä¾§æ˜¯ä¸€ä¸ªå•æŒ‡æ•°ä¸‹é™çš„ç›´æ–¹åˆ†å¸ƒï¼ˆå…³äº Ï„~on~ ï¼‰ï¼Œå³ä¾§æ˜¯ä¸€ä¸ªç´¯ç§¯åˆ†å¸ƒï¼ˆå…³äº Ï„~off~ ï¼‰ï¼Œæ•°æ®ç‚¹æˆ‘å°±ç”¨åœ†åœˆ marker æ¥è¡¨ç¤ºã€‚ç„¶åæ›²çº¿æ˜¯å•æŒ‡æ•°æ‹Ÿåˆï¼ˆ$y=a*(1-np.exp(-x/b))+c$ï¼‰çš„æ›²çº¿ï¼Œè€Œè™šçº¿æ˜¯æ ¹æ®æ‹Ÿåˆå‡½æ•°çš„å‚æ•°ï¼Œè®¡ç®—å‡ºæ¥çš„ Ï„ æ—¶é—´ã€‚\n\n### è¯»å–æ•°æ®\n\n```python\nimport os, glob\nimport pandas as pd\n\nwks = '/path/to/your/data'  \n# å­˜æ”¾æ•°æ®çš„ç›®å½•\nfiles = glob.glob(os.path.join(wks, '*dark.hdf5'))  \n# æ‰¹é‡è¯»å–å¸¦ç‰¹å®šåç¼€çš„æ–‡ä»¶\ndata = pd.read_hdf(files[2], key='locs').filter(items=['len','dark'])\n# ä½¿ç”¨ pandas æ¨¡å—è¯»å–æ•°æ®æ–‡ä»¶ï¼Œå¹¶ä¸”è¿‡æ»¤å‡ºæ¥å…¶ä¸­ä¸¤åˆ—ï¼Œåˆ—ååˆ†åˆ«ä¸º len å’Œ dark\n```\n\nè¿™ä¸€æ®µä»£ç å¯åœˆå¯ç‚¹ï¼š\n\n1. ä½¿ç”¨`os.path.join`ç»„åˆè·¯å¾„ï¼Œç„¶åä½¿ç”¨`*`é€šé…ç¬¦ï¼Œå€ŸåŠ© `glob` å‡½æ•°æ‰¹é‡è¯»å–å¸¦æœ‰ç‰¹å®šåç¼€çš„æ–‡ä»¶ï¼Œè¿”å›ç¬¦åˆç‰¹å¾çš„æ–‡ä»¶è·¯å¾„åˆ—è¡¨ï¼Œè¿™ç§å¤„ç†æ–‡ä»¶è·¯å¾„çš„æ–¹å¼æ¯”è¾ƒè½»æ¾ã€‚ä¸è¿‡ `glob` è¯»æ–‡ä»¶çš„åˆ—è¡¨é¡ºåºå¹¶ä¸æ˜¯æŒ‰ç…§å‘½åæ¥çš„ï¼Œè¿™ä¸ªè¦æ³¨æ„ä¸‹ã€‚\n2. hdf5 æ–‡ä»¶æ˜¯å¸¸è§çš„æ•°æ®æ–‡ä»¶ï¼Œpython ä¸­æœ‰ `h5py`æ¨¡å—æ¥å®Œæˆå¯¹æ­¤ç±»æ–‡ä»¶çš„è¯»å–å’Œå†™å…¥ï¼Œæˆ‘è¿™é‡Œä¸ºäº†æ–¹ä¾¿ï¼Œç›´æ¥ä½¿ç”¨ pandas æ¨¡å—ä¸­æä¾›çš„æ–¹æ³•æ¥è¯»å–æ•°æ®ï¼Œé€‚ç”¨äºæ•°æ®æ–‡ä»¶å†…å®¹ä¸ºè¡¨æ ¼æˆ–è€…çŸ©é˜µç±»å‹çš„æƒ…å†µã€‚\n3. åŸå§‹è¡¨æ ¼æ¯”è¾ƒå¤§ï¼Œå¾ˆå¤šåˆ—çš„ä¿¡æ¯å…¶å®è¿™é‡Œå¹¶æ²¡æœ‰è¢«ç”¨åˆ°ï¼Œæ‰€ä»¥æˆ‘ä½¿ç”¨ `pd.DataFrame` å¯¹è±¡æ‰€æ‹¥æœ‰çš„ `filter`æ–¹æ³•å®ç°å¯¹æ•°æ®åˆ—çš„è¿‡æ»¤ã€‚\n\n### ç›´æ–¹åˆ†å¸ƒä½œå›¾ä»£ç \n\n```python\n%matplotlib inline\n%config InlineBackend.figure_format = 'svg'\nimport matplotlib.pyplot as plt\n\n\nplt.figure(figsize=(2,1.3))\n# å®šä¹‰ figure çš„å¤§å°ï¼Œ\n# æ³¨æ„ figsize å‚æ•°æ¥æ”¶å…ƒç»„ (width, height)\n# å®½å’Œé«˜çš„å•ä½æ˜¯ inch\n\nres = plt.hist(data['len'], bins=10, color='lightgray',edgecolor='gray')\n# å¯¹æŸä¸€åˆ—æ•°æ®åšç›´æ–¹åˆ†å¸ƒå›¾\n# ç›´æ–¹çš„æ•°é‡ï¼ˆbinsï¼‰å®šä¸º 10 \n# ç›´æ–¹çš„é¢œè‰²ï¼ˆcolorï¼‰ä¸º æµ…ç°è‰²\n# ç›´æ–¹è¾¹ç¼˜çš„é¢œè‰²ï¼ˆedgecolorï¼‰ä¸º æ™®é€šç°è‰²\n# plt.hist ä¼šè¿”å›ç›´æ–¹åˆ†å¸ƒç»Ÿè®¡çš„æ•°æ®\n\nparams, err = refFit(res)\n# ä½¿ç”¨è‡ªå®šä¹‰å‡½æ•°æ¥å¯¹ç›´æ–¹åˆ†å¸ƒç»Ÿè®¡æ•°æ®è¿›è¡Œæ‹Ÿåˆ\n\nX, y = extractFromHist(res)\n# è‡ªå®šä¹‰å‡½æ•°æå–ç›´æ–¹åˆ†å¸ƒç»Ÿè®¡æ•°æ®\na, b, c = params\nX2 = np.linspace(0.07, 1,100)\ny2 = func(X2, a, b, c)\n# å¸¦å…¥å‚æ•°åˆ°æ‹Ÿåˆå‡½æ•°ï¼Œå¾—åˆ°å…·ä½“çš„æ‹Ÿåˆæ•°å€¼\nplt.plot(X2, y2)\n# ç»˜åˆ¶æ‹Ÿåˆæ›²çº¿\n\nplt.xlim(0.07,0.9)\nplt.xticks([0.2*x+0.1 for x in range(5)])\n# å®šä¹‰æ¨ªåæ ‡èŒƒå›´å’Œåæ ‡è½´æ ‡ç­¾\n\nymin, ymax = 0, 250\nplt.ylim(ymin, ymax)\nplt.yticks(([120*x for x in range(3)]))\n# å®šä¹‰çºµåæ ‡èŒƒå›´å’Œæ ‡ç­¾\n# plt.show()\nplt.plot([b,b],[ymin, ymax], 'r', linestyle='dashed')\n# ç”¨è™šçº¿ç»˜åˆ¶ Tau æ‰€åœ¨ä½ç½®\nplt.savefig(os.path.join(wks,'plot_result.svg'))\n# ä¿å­˜ä½œå›¾ç»“æœä¸º svg çŸ¢é‡å›¾æ–‡ä»¶\nprint(b, err)\n# æ‰“å°å…³é”®çš„å‚æ•°\n```\n\nè¿è¡Œç»“æœå¦‚ä¸‹ï¼š\n\n![image-20210412143949078](https://sheldon-notes.oss-cn-shanghai.aliyuncs.com/img/image-20210412143949078.png)\n\nç»˜åˆ¶ figure è¿˜æ˜¯æœ‰å¾ˆå¤šå…·ä½“å‚æ•°éœ€è¦æ ¹æ®å…·ä½“æƒ…å†µæ¥è°ƒæ•´çš„ã€‚ä¸€èˆ¬æˆ‘éƒ½æ˜¯å…ˆä½¿ç”¨é»˜è®¤æœ€ç®€å•çš„ `plt.plot` å‘½ä»¤ä½œå›¾çœ‹çœ‹æƒ…å†µï¼Œç„¶åè°ƒæ•´ï¼š\n\n1. figure æ•´ä½“çš„å¤§å°\n2. å›¾çš„ä¸€äº›é¢œè‰²å’Œæ ·å¼\n3. æ¨ªçºµåæ ‡è½´\n\nå·®ä¸å¤šäº†æˆ‘å°±ä¼šå¯¼å‡ºä¸ºçŸ¢é‡å›¾æ–‡ä»¶ï¼Œåé¢å¯ä»¥ä½¿ç”¨ Adobe Illustrator è½¯ä»¶åšæ›´ä¸ºç»†è‡´çš„è°ƒæ•´ã€‚æ¯”å¦‚å­—ä½“å­—å·ä¹‹ç±»çš„ã€‚\n\n### ç´¯ç§¯åˆ†å¸ƒä½œå›¾ä»£ç \n\n```python\nres = plt.hist(data['dark'], bins=300, cumulative=True, color='lightgray',edgecolor='gray',density=True)\nplt.show()\n\nparams, err = refFit(res)\nX, y = extractFromHist(res)\na, b, c = params\nX2 = np.linspace(X[0], X[-1],100)\ny2 = func(X2, a, b, c)\nsmsm = sampling(X, y, frac=0.2)\nX3 = smsm.x \ny3 = smsm.y\nplt.figure(figsize=(2,1.3))\nplt.plot(X3, y3, 'o', mfc='lightgray', mec='black', mew=0.25, markersize=8)\nplt.plot(X2, y2)\nplt.xlim(0, 320)\nplt.xticks([80*x for x in range(5)])\n\nymin, ymax = -0.1, 1.1\nplt.ylim(ymin, ymax)\nplt.yticks(0, 1)\nplt.plot([b,b],[ymin, ymax], 'r', linestyle='dashed')\n\n# plt.show()\nplt.savefig(os.path.join(wks,'plt_result-2.svg'))\nprint(b, err)\n```\n\nä½œå›¾æ•ˆæœå¦‚ä¸‹ï¼š\n\n![image-20210412144636727](https://sheldon-notes.oss-cn-shanghai.aliyuncs.com/img/image-20210412144636727.png)\n\nè¿™é‡Œå°±ä¸ä½œèµ˜è¿°ï¼Œåªæä¸€ä¸‹`plt.plot`ä¸­çš„å‡ ä¸ªå‚æ•°ï¼š\n\n1. mfcï¼šmarker face colorï¼Œå¯ä»¥ç†è§£ä¸º marker çš„å¡«å……é¢œè‰²\n2. 'o'ï¼šå®šä¹‰åœ†åœˆä½œä¸º marker\n3. mecï¼š marker çš„ edge colorï¼Œè¾¹ç¼˜é¢œè‰²\n4. mewï¼šmarker çš„è½®å»“çº¿æ¡ç²—ç»†\n5. markersizeï¼šmarkerçš„å¤§å° \n\nå…¶å®è¿™äº›ä¸œè¥¿ï¼Œå¦‚æœä½¿ç”¨ jupyter notebookï¼Œéƒ½å¯ä»¥ç›´æ¥ä½¿ç”¨ `?plt.plot`æ¥æŸ¥çœ‹ã€‚\n\n### è‡ªå®šä¹‰å‡½æ•°\n\n```python\nimport numpy as np\nfrom scipy.optimize import curve_fit\n\ndef func(x, a, b ,c):\n    '''\n    æ–‡çŒ®ä¸­æä¾›çš„on_time, dark_timeçš„cdfæ›²çº¿æ‹Ÿåˆå‡½æ•°\n    '''\n    return a*(1-np.exp(-x/b))+c\n\ndef refFit(test):\n    '''\n    åˆ©ç”¨curve_fitè¿›è¡Œæ›²çº¿æ‹Ÿåˆè®¡ç®—å‚æ•°\n    è¿”å›æ‹Ÿåˆå‡½æ•°çš„å‚æ•°ï¼Œä»¥åŠÂ±è¯¯å·®å€¼\n    '''\n    X, y = extractFromHist(test)\n    p0 = (1000, 10, 20)  \n    # åˆå§‹åŒ–å‚æ•°è¿˜æŒºé‡è¦çš„\n    params, cv = curve_fit(func, X, y, p0)\n    perr = np.sqrt(np.diag(cv))\n    return params, perr[1]\n\ndef sampling(X, y, frac=0.3):\n    '''\n    åŸºäºdataframeçš„æ–¹æ³•å¯¹æ•°æ®è¿›è¡Œéšæœºé‡‡æ ·\n    '''\n    data = pd.DataFrame()\n    data['x'] = X \n    data['y'] = y \n    return data.sample(frac=frac)\n\ndef extractFromHist(test):\n    '''\n    test: plt.histæ”¶é›†çš„ç›´æ–¹åˆ†å¸ƒæ•°æ®\n    '''\n    test_count = test[0]\n    test_bin = test[1]\n    interval = test_bin[1]-test_bin[0]\n    test_value = [x-interval/2 for x in test_bin[1:]]\n    X = test_value\n    y = test_count\n    return X, y\n```\n\n","tags":["histogram","matplotlib"],"categories":["python","plot"]},{"title":"è‡ªåŠ¨åŒ–DNA-PAINTæ•°æ®åˆ†ææµç¨‹","url":"/2021/04/08/auto_paint_data_analysis_pipeline/","content":"\nå¤šç»„æ•°æ®çš„å°è¯•æ€§åˆ†æè¿‡ç¨‹ä¸­ï¼Œå¸¸å¸¸éœ€è¦è°ƒæ•´ä¸€äº›å‚æ•°ï¼Œä¹‹å‰è¿‡äºä¾èµ– GUIï¼Œå¾€å¾€åªèƒ½ä¸€æ¬¡åˆ†æä¸€ä¸ªæ•°æ®ï¼Œæ•ˆç‡è¾ƒä½ã€‚ä¸ºäº†å‡å°‘å·¥ä½œé‡ï¼Œæˆ‘å†³å®šä½¿ç”¨ python è„šæœ¬ï¼Œé€šè¿‡è°ƒç”¨ picasso æä¾›çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œå®ç°å¤šä¸ªåˆ†ææ­¥éª¤çš„è‡ªåŠ¨åŒ–æ•´åˆã€‚\n\nç¬¬ä¸€æ­¥å…ˆå¯¼å…¥éœ€è¦çš„åŒ…ï¼ˆæ²¡é”™æˆ‘å°±æ˜¯ã€è°ƒåŒ…ä¾ ã€‘:laughing:ï¼‰ï¼š\n\n```python\nimport os, glob\n```\n\n### å¦‚ä½•è°ƒç”¨å‘½ä»¤è¡Œå·¥å…·\n\nå¾ˆå¤šè½¯ä»¶éƒ½ä¼šæä¾›å‘½ä»¤è¡Œå·¥å…·ã€‚ä¸€èˆ¬è€Œè¨€ï¼Œå°±æ˜¯å¯ä»¥åœ¨ ã€cmd çª—å£ã€‘ä¸­ï¼Œé è¾“å…¥å‘½ä»¤æ–‡æœ¬è¿è¡Œçš„æ„æ€ã€‚è€Œä½¿ç”¨ python çš„ `os` æˆ–è€… `subprocess` ç­‰æ¨¡å—ï¼Œåˆ™å¯ä»¥å®ç°è‡ªåŠ¨åŒ–çš„è°ƒç”¨ã€‚åœ¨è¿™ä¸ªé¡¹ç›®ä¸­ï¼Œæˆ‘æ‰“ç®—ä½¿ç”¨æœ€ç®€å•çš„ `os.system` æ¥å®ç°å‘½ä»¤è¡Œå·¥å…·çš„è°ƒç”¨ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š\n\n```python\nbase_command = \"conda activate picasso && python -m picasso\"\n# æ³¨æ„æŠŠ anaconda æ·»åŠ åˆ°ç”¨æˆ·å’Œç³»ç»Ÿçš„ç¯å¢ƒå˜é‡ä¸­\n\ndef undrift(fp, **params):\n    '''\n    å¯¹locä¹‹åçš„æ•°æ®åšRCCè‡ªåŠ¨æ¼‚ç§»æ ¡æ­£\n    '''\n    os.system(base_command+' undrift \"{}\"'.format(fp))\n    # åœ°å€è¿˜æ˜¯åŠ ä¸Šå¼•å·ï¼Œå¦åˆ™é‡Œè¾¹çš„ç©ºæ ¼ä¼šé€ æˆé”™è¯¯\n\ndef cluster(fp, radius=0.25, min_density=10, **params):\n    '''\n    ä½¿ç”¨dbscanå¯¹`_undrift.hdf5`æ•°æ®è¿›è¡Œèšç±»å¾—åˆ°å•ç‚¹\n    '''\n    os.system(base_command+' dbscan \"{}\" {} {}'.format(fp, radius, min_density))\n\ndef link(fp, distance=0.5, tolerance=1, **params):\n    '''\n    å¯¹èšç±»åçš„æ•°æ®è¿›è¡Œlink\n    '''\n    os.system(base_command+' link -d {} -t {} \"{}\"'.format(distance, tolerance, fp))\n\ndef dark(fp, **params):\n    '''\n    å¯¹linkä¹‹åçš„æ•°æ®æ±‚dark\n    '''\n    os.system(base_command+' dark \"{}\"'.format(fp))\n```\n\nè¿™é‡Œè¾¹æœ‰å‡ ä¸ªéœ€è¦æ³¨æ„çš„ç‚¹ï¼š\n\n1. å‘½ä»¤æ–‡æœ¬è¦éµå®ˆå‘½ä»¤è¡Œå·¥å…·çš„è°ƒç”¨è§„èŒƒ\n2. æ³¨æ„æŠŠ anaconda æ·»åŠ åˆ°ç”¨æˆ·å’Œç³»ç»Ÿçš„ç¯å¢ƒå˜é‡ä¸­\n3. æŠŠæ–‡ä»¶åœ°å€ä¼ å‚è¿›å…¥æ–‡æœ¬ï¼Œæ³¨æ„åŠ åŒå¼•å·ï¼Œå¦åˆ™è·¯å¾„çš„ç©ºæ ¼ä¼šé€ æˆé”™è¯¯\n\n### å¦‚ä½•æ•´åˆå¤šä¸ªè¿‡ç¨‹\n\næ³¨æ„æ¯ä¸ªå‘½ä»¤è¡Œå·¥å…·å¯¹æŸä¸ªæ–‡ä»¶å¤„ç†åï¼Œéƒ½ä¼šç”Ÿæˆæ–°çš„æ–‡ä»¶ï¼Œè€Œä¸”ä¿®æ”¹åç¼€ã€‚ç„¶åä¸‹ä¸€ä¸ªæ­¥éª¤åˆä¼šå¯¹è¿™ä¸ªæ–°ç”Ÿæˆçš„æ–‡ä»¶è¿›è¡Œå¤„ç†ã€‚ä¸ºäº†æ–¹ä¾¿è¿™ç§ IO å’Œè°ƒå‚ï¼Œæˆ‘é‡‡ç”¨äº†å­—å…¸çš„æ–¹å¼æ¥å­˜æ”¾å‡½æ•°ï¼Œå­—å…¸çš„é”®åå°±æ˜¯æ–‡ä»¶çš„åç¼€ç‰¹å¾ï¼Œé”®å€¼å°±æ˜¯è¦å¤„ç†è¿™ç§æ–‡ä»¶éœ€è¦è°ƒç”¨çš„å‡½æ•°ï¼Œå…·ä½“å¦‚ä¸‹ï¼š\n\n```python\nif __name__ == \"__main__\":\n    wks = \"/path/to/your/data\"\n    \n    func_dict = {\n        'locs': undrift,\n        'undrift': cluster,\n        'dbscan': link,\n        'link': dark,\n    }\n\n    for key in func_dict.keys():\n        fps = glob.glob(os.path.join(wks,\"*{}.hdf5\".format(key)))\n        for fp in fps:\n            func_dict[key](fp, \n                           radius=0.3,\n                           min_density=20,\n                           distance=0.4,\n                           tolerance=3,\n                           )\n```\n\nè¿™é‡Œéœ€è¦æ³¨æ„å‡ ç‚¹ï¼š\n\n1. å‡½æ•°å­—å…¸ä¸­ï¼Œé”®å€¼å°±æ˜¯å‡½æ•°åï¼Œå·²ç»é¢„å…ˆå®šä¹‰å¥½äº†\n2. ä¸ºäº†æ–¹ä¾¿è°ƒå‚ï¼Œæ¯ä¸ªå‡½æ•°çš„å‚æ•°éƒ½åŒ…å« `**params`ï¼Œå› æ­¤åœ¨è°ƒç”¨æ—¶å¿…é¡»æ˜¯åœ¨å‡½æ•°å°æ‹¬å·å†…ä»¥`key=value`çš„å½¢å¼ä¼ å‚\n3. glob æ”¯æŒ unix style çš„æ–‡ä»¶è·¯å¾„é€šé…ï¼Œ æˆ‘ä¸€èˆ¬ç”¨ `*` é€šè¿‡åŒ¹é…ä»»æ„å­—ç¬¦ä¸²\n\n","tags":["os","glob"],"categories":["python"]},{"title":"æ ‡å‡†åŒ–DNA-PAINTæ•°æ®åˆ†æå¤„ç†æµç¨‹","url":"/2021/04/07/standard_PAINT_analysis_pipeline/","content":"\nåšå£«åé˜¶æ®µåš DNA-PAINT ç›¸å…³å·¥ä½œï¼Œåœ¨æ•°æ®åˆ†æè¿™å—ç»å†é¢‡ä¸°ï¼Œåˆšå¼€å§‹å„ç§ä¸ä¼šç”¨ picasso è¿™ä¸ªè½¯ä»¶ï¼Œå†™äº†å¾ˆå¤šå°ä»£ç ã€‚åˆ°åæ¥æƒ³ç€è¦å»ºç«‹æ ‡å‡†åŒ–æµç¨‹æ–¹ä¾¿â€œä¼ é“â€äºåæ¥è€…ï¼Œåˆä¸æ–­å‡å°‘ä»£ç å«é‡ï¼Œå‡ ç•ªè¿­ä»£ä¹‹åå¾—åˆ°è¿™ä»½ protocolï¼ŒåŸºæœ¬ç®—æ˜¯å®Œç»“ã€‚\n\n### å•åˆ†å­å®šä½\n\n:one: **å°† lif è½¬ä¸º tif**\n\nç”¨ ImageJ è½¯ä»¶æ‰“å¼€ Leica æˆåƒè§†é¢‘æ•°æ®ï¼Œä¿å­˜ä¸º tifï¼Œæ–¹ä¾¿åé¢ä½¿ç”¨ picasso è½¯ä»¶åˆ†æã€‚\n\n> æ³¨æ„æ¯ä¸ªè§†é¢‘æ–‡ä»¶åº”å½“ä¿å­˜åˆ°ä¸€ä¸ªæ–°çš„ç©ºç™½æ–‡ä»¶å¤¹å†…éƒ¨ï¼Œåç»­åˆ†æçš„æ‰€æœ‰ä¸­é—´æ–‡ä»¶éƒ½å­˜å‚¨äºè¯¥ç›®å½•ä¸‹ã€‚\n\n:two: **è®°å½•è§†é¢‘åŸºæœ¬ä¿¡æ¯**\n\nåœ¨ ImageJ ä¸­æ‰“å¼€äº†è§†é¢‘ä¹‹åï¼Œç‚¹å‡»å›¾åƒçª—å£ï¼ŒæŒ‰å¿«æ·é”® `Ctrl+I`ï¼Œæ‰“å¼€ Info çª—å£ï¼Œä¿å­˜ä¸º txtï¼Œæ–¹ä¾¿æå–å…¶ä¸­å…³é”®ä¿¡æ¯ã€‚å¯ä»¥ä½¿ç”¨`collectInfo.py`è„šæœ¬ï¼š\n\n```python\ndef collectInfo(fp):\n    import yaml\n    recs = {}\n    with open(fp, 'r', encoding='utf-8') as f:\n        lines = f.readlines()\n    a = 'Image|ATLCameraSettingDefinition|'\n    b = 'Image|ATLCameraSettingDefinition|WideFieldChannelConfigurator|WideFieldChannelInfo|'\n    for line in lines:\n        if line.startswith\\\n        ('{}CycleCount'.format(a)):\n            _, v = line.split('= ')\n            recs['Frame'] = float(v)\n        elif line.startswith\\\n        ('{}CycleTime'.format(a)):\n            _, v = line.split('= ')\n            recs['FrameInterval'] = float(v)\n        elif line.startswith\\\n        ('{}EMGainValue'.format(a)):\n            _, v = line.split('= ')\n            recs['EMGain'] = float(v)\n        elif line.startswith\\\n        ('{}BlackValue'.format(b)):\n            _, v = line.split('= ')\n            recs['Offset'] = float(v)*pow(2,16)\n        elif line.startswith\\\n        ('{}WFLaserChannelInfo|WFLaserChannelInfo_Wavelength'.format(b)):\n            _, v = line.split('= ')\n            recs['Laser'] = int(v) \n        elif line.startswith\\\n        ('{}WFLaserChannelInfo|WFLaserChannelInfo_CurrentValue'.format(b)):\n            _, v = line.split('= ')\n            recs['LaserPower'] = '{}%'.format(float(v))\n    base, ext = fp.split('.')\n    with open(base+'.yaml', 'w', encoding='utf-8') as f: \n        yaml.dump(recs, f)\n        \nif __name__ == \"__main__\":\n    fp = r\"E:\\TIRF\\DNA-PAINT-3-points-ssDNA-6HB\\Info for ssDNA.txt\"\n    collectInfo(fp)\n```\n\nfp ä¸ºæŒ‡å‘ Info çš„æ–‡ä»¶è·¯å¾„ã€‚æ‰§è¡Œè¯¥è„šæœ¬åï¼Œä¼šä»`Info of ?.txt`æ–‡æœ¬ä¸­æå–è§†é¢‘çš„ä¸€äº›å…³é”®ä¿¡æ¯ï¼Œä¿å­˜åˆ°`Info of ?.yaml`æ–‡ä»¶ä¸­ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n\n```yaml\nEMGain: 100.0\nFrame: 5000.0\nFrameInterval: 0.0402221993301064\nLaser: 638\nLaserPower: 100.0%\nOffset: 1010.0154116121166\n```\n\næ³¨æ„é‡Œè¾¹çš„ EMGainã€Offset å‚æ•°éƒ½æ˜¯åè¾¹ä½¿ç”¨ picasso è½¯ä»¶åš localize çš„æ—¶å€™éœ€è¦çš„ã€‚FrameInterval çš„å•ä½æ˜¯ sec ã€‚\n\n:three: **è¿è¡Œ picasso-localize æ¨¡å—å¹¶æ‰“å¼€è§†é¢‘æ–‡ä»¶**\n\nåœ¨ picasso å·¥å…·ç®±ç›®å½•ä¸­æœ‰å¯åŠ¨ç›¸åº”æ¨¡å—çš„ bat è„šæœ¬æ–‡ä»¶ï¼ŒåŒå‡»è¿è¡Œï¼Œå¼¹å‡ºçª—å£ï¼Œç„¶åæŠŠ ImageJ å¯¼å‡ºçš„ tif æ ¼å¼çš„è§†é¢‘æ–‡ä»¶æ‹–æ‹½åˆ° localize çš„çª—å£å†…å®Œæˆ open ã€‚\n\n:four: **è®¾å®š localize çª—å£æ˜¾ç¤ºçš„ contrast**\n\nä¸ºäº†æ–¹ä¾¿åé¢è®¾ç½®åˆé€‚çš„å‚æ•°ï¼Œå¯¹å•åˆ†å­è§å…‰å…‰æ–‘çš„é€‰ä¸­æƒ…å†µè¿›è¡Œé¢„è§ˆï¼Œéœ€è¦æ‰‹åŠ¨è®¾ç½®ä¸€ä¸‹ contrast ä»¥è¾¾åˆ°æœ€ä½³çš„æ•ˆæœã€‚æŒ‰å¿«æ·é”® `Ctrl+C` æ‰“å¼€ã€‚\n\n:five: **è®¾ç½® localize çš„åŸºæœ¬å‚æ•°**\n\nå¿«æ·é”®`Ctrl+P`æ‰“å¼€å•åˆ†å­å®šä½å‚æ•°é…ç½®é€‰é¡¹ï¼Œå‚æ•°è®¾ç½®å‚è€ƒä¸‹è¡¨ï¼š\n\n| å‚æ•°å            | å‚æ•°å€¼     | å¤‡æ³¨                   |\n| ----------------- | ---------- | ---------------------- |\n| box side length   | 7          | é»˜è®¤ï¼ˆå›ºå®šï¼‰           |\n| Min. Net Gradient | 5000       | é€šè¿‡ preview ç¡®å®š      |\n| EM Gain           | 100        | é€šè¿‡è§†é¢‘ Info ç¡®å®š     |\n| Baseline          | 1000       | é€šè¿‡è§†é¢‘ Info ç¡®å®š     |\n| Sensitivity       | 16.9       | ç›¸æœºå‚æ•°ï¼ˆå›ºå®šï¼‰       |\n| QE                | 0.9        | è§å…‰åŸºå›¢å‚æ•°ï¼ˆå›ºå®šï¼‰   |\n| Pixelsize         | 160        | 1 px = 160 nm ï¼ˆå›ºå®šï¼‰ |\n| Fit               | LQï¼ŒGpufit | GPUåŠ é€Ÿï¼ˆå›ºå®šï¼‰        |\n\n:six: **å•åˆ†å­å®šä½**\n\nè®¾ç½®å¥½å‚æ•°åï¼ŒæŒ‰å¿«æ·é”®`Ctrl+L`å¼€å§‹è¿è¡Œã€‚è¿è¡Œç»“æŸåï¼Œæ•°æ®è‡ªåŠ¨ä¿å­˜åˆ°è§†é¢‘æ–‡ä»¶æ‰€åœ¨ç›®å½•ä¸‹ï¼Œæ–‡ä»¶åç¼€`?_locs.hdf5`ã€‚\n\n### æ¼‚ç§»æ ¡æ­£\n\næ‰“å¼€ picasso-render æ¨¡å—ï¼ŒæŠŠåç¼€`?_locs.hdf5`çš„æ•°æ®æ–‡ä»¶æ‹–æ‹½å…¥ render çª—å£ï¼ŒæŒ‰`Ctrl+D` æ‰“å¼€æ˜¾ç¤ºè®¾ç½®çª—å£ï¼Œè°ƒèŠ‚`zoom`å’Œ`contrast`ç­‰å‚æ•°ã€‚ç„¶åæŒ‰`Ctrl+T` è®¾ç½®åœˆé€‰å·¥å…·åŠç›¸å…³å‚æ•°ã€‚å†æŒ‰`Ctrl+P`åœˆé€‰ marker çš„æ¼‚ç§»å›¾æ¡ˆã€‚é€‰ä¸­è‹¥å¹²ä¸ªä¹‹åæŒ‰`Ctrl+Shift+U`ï¼Œæ‰§è¡Œæ¼‚ç§»æ ¡æ­£ï¼Œæ ¡æ­£å`Ctrl+S`æ‰‹åŠ¨ä¿å­˜å®šä½æ•°æ®ï¼Œæ–‡ä»¶ååç¼€å‘½åä¸º`?_undrift.hdf5`ã€‚\n\n> ç›®å‰å®éªŒå®¤ä»ä½¿ç”¨è§å…‰å°çƒä½œä¸ºç•Œé¢æ¼‚ç§»çš„ fiducial markerï¼Œåœ¨æ•´ä¸ªè§†é¢‘ä¸­ä¿æŒå¸¸äº®ï¼Œæ¯ä¸€å¸§éƒ½æœ‰ç‚¹ç´¯ç§¯åˆ°ï¼Œæ‰€ä»¥åœ¨ render çª—å£ä¸­ marker çš„å›¾æ¡ˆæ˜¯æœ€äº®è€Œä¸” pattern ä¸€è‡´çš„ï¼ˆè®¾ç½®æ¯”è¾ƒå¤§çš„contrastï¼‰ã€‚\n\n### åœˆé€‰ç»“æ„\n\né‡æ–°ç”¨ render æ‰“å¼€åä¸º`?_undrift.hdf5`çš„æ–‡ä»¶ï¼Œç„¶åæŒ‰`Ctrl+D` æ‰“å¼€æ˜¾ç¤ºè®¾ç½®çª—å£ï¼Œè°ƒèŠ‚`zoom`å’Œ`contrast`ç­‰å‚æ•°ã€‚æŒ‰`Ctrl+T` è®¾ç½®åœˆé€‰å·¥å…·åŠç›¸å…³å‚æ•°ï¼ˆå¯¹äºä¸‰ç‚¹å…­èºæ—‹ï¼Œä¸€èˆ¬ diameter = 2.5 pxï¼‰ã€‚å†æŒ‰`Ctrl+P`æ‰‹åŠ¨åœˆé€‰ æ‰€PAINTç»“æ„ çš„å›¾æ¡ˆã€‚å¦‚æœèƒŒæ™¯å¾ˆä½ä¸”å¯†åº¦åˆé€‚ï¼Œå¯ä»¥æŒ‰`Ctrl+Shift+P`è‡ªåŠ¨é€‰ä¸­ç›¸ä¼¼çš„ç»“æ„ã€‚ä¸€èˆ¬ä¸€ä¸ªæ•°æ®èƒ½å¤Ÿåœˆé€‰å‡º 200 - 300 ä¸ªç»“æ„ä¸ºå®œã€‚åœˆé€‰ä¸´æ—¶åœæ­¢æˆ–å®Œæˆéƒ½å»ºè®®åŠæ—¶ä¿å­˜åœˆé€‰è®°å½•ï¼ˆFile > Save pick regionsï¼‰ï¼Œä¼šå°†è®°å½•ä¿å­˜åˆ°ä¸€ä¸ª yaml æ–‡ä»¶ã€‚è¿˜éœ€è¦ä¿å­˜åœˆé€‰çš„localizationï¼ˆå¿«æ·é”®`Ctrl+Shift+S`ï¼‰ï¼Œå¾—åˆ°ä¸€ä¸ªåä¸º`?_picked.hdf5`æ–‡ä»¶\n\n### å›¾åƒå¹³å‡\n\nä½¿ç”¨ picasso-average æ¨¡å—æ‰“å¼€åä¸º`?_picked.hdf5`çš„æ–‡ä»¶ï¼Œæ‹–æ‹½æ‰“å¼€å³å¯ã€‚ç„¶åç›´æ¥æŒ‰`Ctrl+A`æ‰§è¡Œå›¾åƒå¹³å‡ã€‚ç¨‹åºè¿è¡Œç»“æŸåï¼Œæ‰‹åŠ¨ä¿å­˜æ•°æ®ï¼Œå¾—åˆ°ä¸€ä¸ªåä¸º`?_avg.hdf5`æ–‡ä»¶ã€‚ä½¿ç”¨`getAverageImage.py`è„šæœ¬è·å–å¹³å‡åŒ–çš„ç»“æ„è¶…åˆ†è¾¨å›¾åƒï¼Œä»£ç å¦‚ä¸‹ï¼š\n\n```python\nimport os, glob \nimport h5py\nimport pandas as pd \nimport numpy as np\nfrom skimage import io \n\ndef readHDF5(filepath):\n    '''\n    å°†hdf5æ•°æ®æ–‡ä»¶è½¬ä¸ºpandas.dataframe\n    '''\n    dataset = h5py.File(filepath, 'r')\n    data = {}\n    for key in dataset.keys():\n        print('dataset>{}'.format(key))\n        data[key] = pd.DataFrame(dataset[key][()])\n        return data\n\ndef exportImage(filepath, locs, zoom=20):\n    ylim = (locs.y.min(), locs.y.max())\n    xlim = (locs.x.min(), locs.x.max())\n    row = round((ylim[1]-ylim[0])*zoom)\n    col = round((xlim[1]-xlim[0])*zoom)\n    img = np.zeros(shape=(row, col), dtype='int64')\n    for idx, rec in locs.iterrows():\n        if rec['y']>=ylim[0] and rec['y']<ylim[1] and rec['x']>=xlim[0] and rec['x']<xlim[1]:\n            # è¿‡æ»¤æ‰åœ¨rangeåœ¨çš„ç‚¹\n            img[int((rec['y']-ylim[0])*zoom),int((rec['x']-xlim[0])*zoom)] += 1\n            # æ³¨æ„åæ ‡è½¬æ¢\n    io.imsave(filepath, img.astype('int16'))  #æ³¨æ„ä½¿ç”¨16-bitæ ¼å¼ä¿å­˜\n    print('å¹³å‡åŒ–å›¾åƒå·²ä¿å­˜è‡³ {}'.format(filepath))\n\ndef main(filepath, zoom=20):\n    data = readHDF5(filepath)\n    locs = data['locs'].filter(items=['x','y','cluster'])\n    exportImage(filepath+\"_pixelSize-{}nm.tif\".format(160/zoom), locs, zoom=zoom)\n\nif __name__ == \"__main__\":\n    fp = r\"E:\\TIRF\\DNA-PAINT-3-points-ssDNA-6HB\\ssDNA_locs_render.hdf5_cluster_filtered_picked_picked_avg.hdf5\"\n    main(fp, zoom=40)\n```\n\næ³¨æ„ fp ä¸ºæŒ‡å‘`?_avg.hdf5`æ–‡ä»¶çš„è·¯å¾„ï¼Œmain å‡½æ•°ä¸­çš„ zoom å‚æ•°ä»£è¡¨ç”Ÿæˆå›¾åƒçš„æ”¾å¤§å€æ•°ï¼Œæ¯”å¦‚åŸå§‹å›¾åƒ 1 pixel = 160 nmï¼Œæ”¾å¤§ 40 å€ä¹‹åï¼Œ 1 pixel = 4 nmã€‚å¾—åˆ°ä¸€ä¸ª tif å›¾åƒåï¼Œä½¿ç”¨ ImageJ åšåç»­å¤„ç†ã€‚\n\n### åˆ†è¾¨ç‡æµ‹é‡\n\nå¾—åˆ°å¹³å‡åŒ–çš„ tif å›¾åƒä¹‹åï¼Œç”¨ ImageJ æ‰“å¼€ï¼Œå…ˆè®¾ç½® scaleï¼ˆAnalyze > Set Scaleï¼‰ï¼Œç„¶åé€‰æ‹©ç›´çº¿å·¥å…·ï¼Œåœ¨å›¾åƒä¸Šæ²¿ç€ç»“æ„ç”»çº¿ã€‚ä»¥å…­èºæ—‹ä¸‰ç‚¹ç»“æ„ä¸ºä¾‹ï¼Œåˆ™è¯¥çº¿æ®µéœ€è¦è´¯ç©¿ä¸‰ç‚¹ä¸­å¿ƒã€‚ç„¶åæŒ‰`Ctrl+K`æ‰§è¡Œ Plot åŠŸèƒ½ï¼Œå¾—åˆ°æ²¿è¯¥çº¿æ®µçš„å¼ºåº¦å˜åŒ–å€¼ï¼Œå¯ä»¥åœ¨ Plot çª—å£ä¸­ä¿å­˜ data åˆ° csv æ–‡ä»¶ï¼Œç„¶åç”¨ OriginLab æ‰“å¼€ï¼Œä½¿ç”¨ Peak Analyzer å®Œæˆç©ºé—´åˆ†è¾¨ç‡çš„æµ‹é‡ï¼ˆåŠå³°å®½ï¼‰ã€‚\n\n> æ–‡çŒ®ä¸­å¸¸ç”¨å®šä½ç²¾åº¦ï¼ˆLocalization Precisionï¼‰çš„æ¦‚å¿µï¼Œä¸ç©ºé—´åˆ†è¾¨ç‡ä¸æ˜¯ä¸€å›äº‹ã€‚ä¸€èˆ¬æˆ‘ä»¬è®¤ä¸ºç©ºé—´åˆ†è¾¨ç‡å°±æ˜¯é«˜æ–¯åˆ†å¸ƒçš„åŠå³°å®½ï¼ˆFWHMï¼‰ï¼Œè€Œå®šä½ç²¾åº¦ï¼ˆÏƒï¼‰ä¸ FWHM çš„æ•°å­¦è½¬æ¢å…³ç³»å¦‚ä¸‹ï¼š\n>\n> FWHM = 2 Ã— sqrt(2 Ã— ln2) Ã— Ïƒ â‰ˆ 2.355 Ã— Ïƒ \n\n### åŸºç¡€ Kinetics åˆ†æ \n\nè¯¥éƒ¨åˆ†å±äºè¿›é˜¶æ•°æ®åˆ†æï¼Œä¸€èˆ¬DNA-PAINTç”¨æˆ·æ— éœ€è¿›è¡Œæ­¤ç¯èŠ‚ã€‚\n\n:one: **èšç±»åˆ†ç°‡ï¼ˆClusterï¼‰**\n\nä¸€èˆ¬è¢« PAINT å‡ºæ¥çš„ç»“æ„åŒ…å«è‹¥å¹²ä¸ªç‚¹ç°‡ï¼Œå¯ä»¥è¢«è®¤ä¸ºæ˜¯ç‹¬ç«‹çš„ç»“åˆä½ç‚¹ï¼ˆåŒ…å«ä¸€æ¡æˆ–è€…ç´§å¯†æ’å¸ƒçš„è‹¥å¹²æ¡ docking sequenceï¼‰ã€‚PAINT çš„ç»“åˆåŠ¨åŠ›å­¦åˆ†æéœ€è¦åŸºäºå•ä¸ªçš„ç»“åˆä½ç‚¹å¼€å±•ã€‚æ‰‹åŠ¨åœˆé€‰ 200 - 300 ä¸ªç»“æ„ä¹‹åï¼Œå¯ä»¥ä½¿ç”¨ render ä¸­çš„èšç±»å·¥å…·æ¥å®ç°åˆ†ç°‡ã€‚ render ä¸­æä¾›äº†ä»¥ä¸‹å·¥å…·ï¼š\n\n1. K-Means ï¼ˆåŸºäºæŒ‡å®šæ•°ç›®çš„èšç±»ï¼Œéœ€æ‰‹åŠ¨ filterï¼‰\n2. DBSCAN ï¼ˆåŸºäºå¯†åº¦èšç±»ï¼Œéœ€è®¾å®šèŒƒå›´å’Œå¯†åº¦é˜ˆå€¼ï¼‰\n3. HDBSCAN ï¼ˆåŸºäºå¯†åº¦èšç±»ï¼Œé»˜è®¤å‚æ•°å³å¯ï¼Œä½†é€Ÿåº¦å¾ˆæ…¢ï¼Œéœ€é¢å¤–å®‰è£… `hdbscan` ï¼‰\n\n**æ¨èä½¿ç”¨ K-Means** å®Œæˆèšç±»ã€‚åœˆé€‰äº†ç»“æ„ä¹‹åï¼Œå¯ç‚¹å‡» Tools > Cluster in pick (k-means) æ‰“å¼€è¯¥å·¥å…·ã€‚ æŒ‡å®šèšç±»æ•°ç›®ä¸º 3 ï¼ˆä»¥ä¸‰ç‚¹ç»“æ„ä¸ºä¾‹ï¼‰ï¼Œgap = 1ï¼Œç„¶åå¼€å§‹éå†ç­›é€‰åœˆä¸­çš„ç»“æ„ã€‚\n\n> æ³¨æ„ç­›é€‰è¿‡ç¨‹ä¸­ï¼Œå¯ä»¥ä¿®æ”¹èšç±»æ•°ç›®ï¼Œä½¿å¾—æ‚ç‚¹å½’å…¥æ–°ç±»ï¼Œå†å»å‹¾é€‰æ‚ç‚¹ç±»ï¼Œå®ç°è¿‡æ»¤ã€‚å¦å¤–ä½¿ç”¨è¯¥æ–¹æ³•èšç±»ä¾èµ–äºè®¡ç®—æœºæ€§èƒ½ï¼Œå»ºè®®ä¸è¦åœˆé€‰è¶…è¿‡ 200 ä¸ªç»“æ„ï¼ˆCore i7 8thï¼Œ16 GB å†…å­˜ï¼‰ï¼Œå¦åˆ™åœ¨éå†è¿‡ç¨‹ä¸­ç¨‹åºä¼šå´©æºƒï¼ˆcalculating pick properties æœ‰ bugï¼Œå·²ä¿®å¤ï¼‰ã€‚\n\nèšç±»ç»“æŸåï¼Œä¼šç”Ÿæˆ`?_cluster.hdf5`å’Œ`?_pickprops.hdf5`æ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨ OriginLab å¯¼å…¥ `?_pickprops.hdf5`æ–‡ä»¶ï¼Œå¯¹ len_mean å’Œ dark_mean ä¸¤åˆ—æ•°æ®è¿›è¡ŒæŸ¥çœ‹ï¼Œå½“å…¶åˆ†å¸ƒæ¥è¿‘æ­£æ€åˆ†å¸ƒæ—¶ï¼Œç›´æ¥å–å‡å€¼ï¼Œå½“å…¶åˆ†å¸ƒæ¥è¿‘æŒ‡æ•°åˆ†å¸ƒæ—¶ï¼Œä½¿ç”¨å•æŒ‡æ•°æ‹Ÿåˆæ±‚å– Ï„ å€¼ã€‚\n\n> æ³¨æ„æ¯ä¸ª cluster ä¸­å¯èƒ½åŒ…å«äº†å¤šä¸ª blink äº‹ä»¶ï¼Œ æ¯ä¸ª blink äº‹ä»¶éƒ½æœ‰å¯¹åº”çš„ T~on~ å’Œ T~off~ï¼Œè€Œ len_mean åˆ™æ˜¯å¤šä¸ª blink äº‹ä»¶çš„ T~on~ çš„å‡å€¼ï¼Œ dark_mean ä»¥æ­¤ç±»æ¨ã€‚å½“å¯¹å•ä¸ª blink äº‹ä»¶çš„ T~on~ å’Œ T~off~ åšç›´æ–¹ç»Ÿè®¡ï¼Œåˆ™ä¸€èˆ¬ä¸ºæŒ‡æ•°åˆ†å¸ƒã€‚\n\n### cluster è½¬ pick \n\nå¾—åˆ°äº†ç»“æ„åˆ†ç°‡ä¿¡æ¯ä¹‹åï¼Œå¯ä»¥å°†æ¯ä¸ªç°‡çš„ä¸­å¿ƒåæ ‡æå–å‡ºæ¥ï¼Œè®¾ç½®åŠå¾„ï¼Œå®ç°å¯¹åˆ†ç°‡çš„åœˆé€‰ï¼Œå†ç»“åˆ render ä¸­çš„ Show Info åŠŸèƒ½å¿«é€ŸæŸ¥çœ‹ï¼ˆå¿«æ·é”®`Ctrl+I`ï¼‰NeNA å®šä½ç²¾åº¦ä»¥åŠ Kinetics ä¿¡æ¯ï¼Œéå¸¸æ–¹ä¾¿ã€‚è¿™é‡Œå¯ä»¥ä½¿ç”¨`getClusterCenter.py`è„šæœ¬å®Œæˆåæ ‡æå–å¹¶è‡ªåŠ¨ç”ŸæˆæŒ‡å®š radius çš„åœˆé€‰ yaml æ–‡ä»¶è®°å½•ã€‚ä»£ç å¦‚ä¸‹ï¼š\n\n```python\nimport pandas as pd \nimport yaml \n\ndef cluster2picks(fp, radius):\n    '''\n    fp: ä½¿ç”¨filterPicks.py è·å¾—çš„ localizations æ–‡ä»¶åœ°å€\n    '''\n    data = pd.read_hdf(fp, key='locs')\n    gp = data.groupby(by=['group','cluster'])\n    recs = {'Centers':[], 'Diameter':2*radius,'Shape':'Circle'}\n    for key, df in gp:\n        x = float(df['x'].mean())\n        y = float(df['y'].mean())\n        recs['Centers'].append([x, y])\n    with open(fp+'_2picks.yaml', 'w') as f:\n        yaml.dump(recs, f)\n\nif __name__ == \"__main__\":\n    fp = r\"E:\\TIRF\\a-20210407\\*\\*_cluster.hdf5\"\n    radius = 0.25\n    cluster2picks(fp, radius)\n```\n\nfp ä¸ºæŒ‡å‘`?_cluster.hdf5`æ–‡ä»¶ï¼ˆä½¿ç”¨ K-Means èšç±»ç”Ÿæˆï¼‰çš„è·¯å¾„ï¼Œradius ä¸ºåœˆé€‰åœ†æ¡†çš„åŠå¾„ï¼Œå•ä½ä¸ºåƒç´ ï¼ˆç›®å‰å®éªŒå®¤åˆ†è¾¨ç‡æ˜¯ 30-40 nmï¼Œç›¸å½“äº 0.25 pxï¼‰ã€‚è¯¥è„šæœ¬ä¼šæ‰§è¡Œç»“æŸååœ¨åŒç›®å½•ä¸‹ç”Ÿæˆ`?_2picks.yaml`è®°å½•ï¼Œå¯å°†`?_cluster.hdf5`æ–‡ä»¶æ‹–å…¥ render ä¸­æ‰“å¼€ï¼Œå»é™¤  group ä¿¡æ¯ï¼ˆPostprocess > remove group infoï¼‰ï¼Œç„¶åä» render ä¸­å¯¼å…¥è¯¥åœˆé€‰è®°å½•ï¼ˆFile > Load pick regionsï¼‰ï¼Œç„¶åæŸ¥çœ‹Infoã€‚\n\n### å• Blink äº‹ä»¶åˆ†æ\n\nåŸºç¡€ kinetics åˆ†æä¸­åªèƒ½è·å–æŸä¸€ä¸ªåˆ†ç°‡çš„å¹³å‡ T~on~ å’Œ T~off~ï¼Œè€Œæ–‡çŒ®ä¸­å®é™…æ˜¯å¯¹å•ä¸ªé—ªçƒäº‹ä»¶è¿›è¡Œç»Ÿè®¡åˆ†æã€‚å› æ­¤è¦ä»æ›´ä¸ºåŸå§‹çš„æ•°æ®è¿›è¡Œåˆ†æã€‚\n\nä½¿ç”¨ render æ‰“å¼€ `?_undrift.hdf5` æ–‡ä»¶ï¼Œå¯¼å…¥åˆ†ç°‡åœˆé€‰è®°å½•`?_2picks.yaml`ï¼Œç„¶å`Ctrl+Shift+S` ä¿å­˜æ–°çš„ picked_localizationï¼Œä¿®æ”¹åç¼€ä¸º`?_single.hdf5`ã€‚\n\næ‰“å¼€ conda å¹¶æ¿€æ´» picasso ç¯å¢ƒï¼š\n\n```bash\nconda activate picasso\n```\n\nç„¶åä½¿ç”¨ picasso æä¾›çš„å‘½ä»¤è¡Œå·¥å…·å¯¹`?_single.hdf5` è¿›è¡Œ link è®¡ç®—ï¼š\n\n```bash\npython -m picasso link -d 0.5 files\n```\n\nfiles ä¸ºæŒ‡å‘ä¸€ä¸ªæˆ–è€…å¤šä¸ª`?_single.hdf5` æ–‡ä»¶è·¯å¾„ï¼ˆ a unix style path patternï¼‰ï¼Œè¯¥å‘½ä»¤çš„å‚æ•°è¯´æ˜å¯ä»¥ `python -m picasso link -h` æŸ¥çœ‹ã€‚d ä»£è¡¨æœ€å¤§è·ç¦»ï¼ˆåƒç´ å•ä½ï¼‰ã€‚è¯¥æ­¥éª¤å®Œæˆåå¸¦åç¼€`?_link.hdf5`çš„æ–‡ä»¶ã€‚\n\nå†åœ¨è¯¥å‘½ä»¤è¡Œä¸­ç»§ç»­æ‰§è¡Œ dark è®¡ç®—ï¼š\n\n```bash\npython -m picasso dark files\n```\n\nfiles ä¸ºæŒ‡å‘ä¸€ä¸ªæˆ–è€…å¤šä¸ª`?_link.hdf5` æ–‡ä»¶è·¯å¾„ã€‚è¿è¡Œç»“æŸåç”Ÿæˆ`?_dark.hdf5`æ–‡ä»¶ã€‚æ­¤æ–‡ä»¶å¯ä»¥ä½¿ç”¨ picasso-filter å¿«é€ŸæŸ¥çœ‹å†…å®¹ï¼Œè¡¨æ ¼ä¸­åº”è¯¥åŒ…å«äº† len å’Œ dark ä¸¤åˆ—ã€‚æ¥ä¸‹æ¥å¯ä»¥ä½¿ç”¨ OriginLab å¯¼å…¥`?_dark.hdf5`æ–‡ä»¶ï¼Œå¯¹ len å’Œ dark ä¸¤åˆ—çš„ç›´æ–¹åˆ†å¸ƒæˆ–è€…ç´¯ç§¯ç›´æ–¹åˆ†å¸ƒåšå•æŒ‡æ•°æ‹Ÿåˆï¼Œæ±‚å¾— Ï„~on~ å’Œ Ï„~off~ ã€‚\n\n### è®¡ç®— K~on~ å’Œ K~off~\n\nå¾—åˆ°äº† PAINT ä¸­å•ä¸ª docking ä½ç‚¹çš„ä¸¤ä¸ªæ—¶é—´ï¼ˆ Ï„~on~ å’Œ Ï„~off~ï¼‰ä¹‹åï¼Œéœ€è¦æ¢ç®—æ‰èƒ½å¾—åˆ° K~on~ å’Œ K~off~ ä¸¤ä¸ªå‚æ•°ã€‚å¯ä»¥ä½¿ç”¨`getKineticsFromTime.py`è„šæœ¬ï¼š\n\n```python\ndef getKinetics(t_b, t_d, c_imager):\n    '''\n    t_b: ç»Ÿè®¡å¾—åˆ°çš„å¹³å‡bright timeï¼Œå•ä½ç§’\n    t_d: ç»Ÿè®¡å¾—åˆ°çš„å¹³å‡dark time\n    c_imager: imagerçš„æµ“åº¦ï¼Œå•ä½ä¸ºnM\n    '''\n    c_imager = c_imager*1e-9 # å®Œæˆæµ“åº¦å•ä½è½¬åŒ–\n    k_off = 1/(t_b)\n    k_on = 1/(c_imager*t_d)\n    message = '''# Kinetics\n    t_off: {} (s)\n    t_on: {} (s)\n    k_off: {} (1/s)\n    k_on: {} (/M/s)\n    '''.format(t_d, t_b, k_off, k_on)\n    print(message)\n\nif __name__==\"__main__\":\n    c_imager = 5  # å•ä½ä¸º nM\n    frame_interval = 0.32  # å•ä½ä¸ºç§’\n    t_b = 2.41*frame_interval\n    t_d = 370.44*frame_interval\n    getKinetics(t_b, t_d, c_imager)\n```\n\næ­¤è„šæœ¬éœ€è¦è¾“å…¥ PAINT å®éªŒä¸­ä½¿ç”¨çš„ Imager çš„æµ“åº¦ï¼Œæ‹æ‘„è§†é¢‘çš„æ¯å¸§æ—¶é—´é—´éš”ï¼ˆä¸åŒäºæ›å…‰æ—¶é—´ï¼‰ã€‚`t_b` å°±æ˜¯ bright timeï¼Œ`t_d` å°±æ˜¯ dark timeï¼Œé€šè¿‡å‰é¢çš„åˆ†æè·å¾—ã€‚\n\n### æå–å¼ºåº¦æ—¶é—´æ›²çº¿\n\næœ‰äº›æ—¶å€™éœ€è¦é€‰å–å…·æœ‰ä»£è¡¨æ€§çš„æŸä¸ª docking ä½ç‚¹çš„å¼ºåº¦æ—¶é—´æ›²çº¿ï¼Œäº†è§£å®é™…çš„ä¿¡å·é—ªçƒæƒ…å†µï¼Œå¯ä»¥ä½¿ç”¨`getSpotTrace.ipynb`è„šæœ¬ï¼ˆåœ¨ jupyter notebook ä¸­è¿è¡Œï¼‰ï¼š\n\n```python\n%matplotlib inline\n%config InlineBackend.figure_format = 'svg'\nimport matplotlib.pyplot as plt\nimport os, glob\n\nimport yaml \nimport pandas as pd \nimport numpy as np \nfrom skimage import io \n\n\ndef load_picks(filepath):\n    with open(filepath, 'r', encoding=\"utf-8\") as f:\n        data = yaml.load(f, Loader=yaml.BaseLoader)\n    picks = pd.DataFrame(data['Centers'], columns=['x','y'], dtype='float32')\n    return picks\n\n\ndef load_drift(filepath):\n    with open(filepath, 'r') as f:\n        lines = f.readlines()\n    N = int(len(lines)/2)\n    recs = []\n    for i in range(N):\n        if i>0:\n            recs.append(lines[2*i])\n    recs = list(map(lambda x: list(map(lambda x:float(x), x.replace(\"\\n\",\"\").split(\" \"))), recs))\n    recs = pd.DataFrame(recs, columns=['dx', 'dy'], dtype=\"float64\")\n    return recs\n\n\ndef load_movie(filepath):\n    return io.imread(filepath, plugin='pil')\n\n\nclass Spots:\n    def __init__(self, pick_region_yaml, drift_txt, origin_tif, picked_locs_hdf5):\n        self.picks = load_picks(pick_region_yaml)\n        self.drift = load_drift(drift_txt)\n        self.movie = load_movie(origin_tif)\n        self.locs = load_pick_locs(picked_locs_hdf5)\n        self._gp = self.locs.groupby('group')\n        self.load_info = 'Movie shape: {}\\nPicks number: {}\\n'\\\n        .format(self.movie.shape, len(self.picks))\n        print(self.load_info)\n    \n    def fetch(self, sid):\n        row = self.picks.iloc[sid]\n        x, y = row\n        xx = x - self.drift['dx']\n        yy = y - self.drift['dy']\n        xx = xx.astype('int64')\n        yy = yy.astype('int64')\n        on_frame = self._gp.get_group(sid)['frame'].values\n        intensity, crop = self.getRegionIntensity(xx, yy, on_frame)\n        status = self.mark_status(on_frame)\n        return intensity, status, crop\n    \n    def getRegionIntensity(self, xx, yy, on_frame):\n        intensity = []\n        crop = []\n        for idx, x in enumerate(xx):\n            y = yy[idx]\n            frame = self.movie[idx]\n            region = frame[y-3:y+4, x-3:x+4]\n            if idx in on_frame:\n                value = region.max()\n            else:\n                value = region.min()\n            intensity.append(value)\n            crop.append(region)\n        return intensity, crop\n    \n    def mark_status(self, on_frame):\n        N = len(self.movie)\n        on_ = 0.1*self.movie.ptp()\n        off_ = 0\n        status = []\n        for i in range(N):\n            if i in on_frame:\n                v = on_\n            else:\n                v = off_\n            status.append(v)\n        return status\n```\n\næŠŠä¸Šè¿°å†™å¥½çš„ç±»å’Œæ–¹æ³•æ”¾åˆ°ä¸€ä¸ª cell ä¸­æ‰§è¡Œç¼–è¯‘ï¼Œæ¥ä¸‹æ¥å¼€å§‹è°ƒç”¨ï¼š\n\n```python\nfp1 = r\"?_2picks.yaml\" \nfp2 = r\"?_drift.txt\"\nfp3 = r\"movie.tif\"\nfp4 = r\"?_single.hdf5\" \npicks = Spots(fp1, fp2, fp3, fp4)\n```\n\næ³¨æ„è¿™é‡Œçš„ fp ä¸€å…±æœ‰å››ä¸ªï¼Œåˆ†åˆ«æŒ‡å‘ä¸åŒçš„æ–‡ä»¶ï¼š\n\n1. `?_2picks.yaml` : èšç±»åˆ†ç°‡è½¬æ¢å¾—åˆ°çš„å•ç‚¹åœˆé€‰è®°å½•æ–‡ä»¶\n2. `?_drift.txt` : æ¼‚ç§»æ ¡æ­£äº§ç”Ÿçš„è®°å½•æ–‡ä»¶\n3. `movie.tif` : åŸå§‹è§†é¢‘æ–‡ä»¶\n4. `?_single.hdf5` : æ ¹æ®`?_2picks.yaml` ä¿å­˜çš„ picked_localization æ–‡ä»¶\n\nSpots å¯¹è±¡åˆå§‹åŒ–åï¼Œå¯ä»¥ single docking site çš„ ID è¿›è¡Œç´¢å¼•å’ŒæŸ¥çœ‹å¼ºåº¦æ—¶é—´æ›²çº¿ï¼š\n\n```python\nintensity, status, crop = picks.fetch(1)\nplt.figure(figsize=(12,3))\nplt.plot(intensity-min(intensity))\nplt.plot(status)\nplt.show()\n```\n\n### å…¶ä»–éœ€æ±‚çš„è¯´æ˜\n\npicasso è½¯ä»¶äº§ç”Ÿçš„ä¸­é—´æ•°æ®ä¸»è¦æ˜¯è¡¨æ ¼å½¢å¼ï¼Œä¸”å‡é‡‡å– hdf5 æ–‡ä»¶æ ¼å¼ä¿å­˜ï¼Œå¯ä»¥è‡ªè¡Œä½¿ç”¨ OriginLab å¯¼å…¥è¿›è¡Œåç»­æ•°æ®åˆ†æï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ python ç»“åˆ pandas æ¨¡å—è¿›è¡Œæ•°æ®å¤„ç†ã€‚è¿™é‡Œæä¾› python å¯¹ picasso çš„æ•°æ® I/O æ¥å£å‡½æ•°ï¼š\n\n```python\nimport numpy as np \nimport pandas as pd \nimport h5py\n\ndef load_hdf5(fp):\n    '''\n    fpï¼špicassoè½¯ä»¶åˆ†æäº§ç”Ÿçš„localizationæ•°æ®ï¼ˆhdf5æ ¼å¼ï¼‰\n    å¯ä»¥ä½¿ç”¨ pandas æ¨¡å—æ‰“å¼€å¹¶è¿›è¡Œåç»­æ•°æ®å¤„ç†\n    '''\n    return pd.read_hdf(fp, key='locs')\n\ndef dataFrame2HDF(fp, df):\n    '''\n    df: ä¸€ä¸ªç”¨pd.read_hdfè¯»å–localizationå¾—åˆ°çš„ä¸­é—´æ•°æ®å¸§\n    è¯¥æ•°æ®éœ€è¦è½¬æ¢ä¸º np.rec.array æ‰èƒ½ä¿å­˜ä¸º picasso render\n    èƒ½å¤Ÿæ‰“å¼€çš„ hdf5 æ–‡ä»¶ã€‚\n    fp: è¦ä¿å­˜çš„æ–‡ä»¶è·¯å¾„\n    '''\n    OBJ = [df[x].values for x in df.columns]\n    DTYPE = [(x, df[x].dtype) for x in df.columns]\n    g = np.rec.array(OBJ, dtype=DTYPE)\n    with h5py.File(fp,'w') as f:\n        f.create_dataset('locs', data=g)\n```\n\n","categories":["python"]},{"title":"æ±‡æ€»å®éªŒæ—¥å¿—çš„å°å·¥å…·","url":"/2021/04/02/summarize-lab-notes/","content":"\næˆ‘ä¹ æƒ¯æ¯å¤©ä¸€ä¸ª markdown æ–‡ä»¶è®°å½•ä¸€åˆ‡å†…å®¹ã€‚å†åŠ ä¸Šæ‡’å¾—ç”¨æ‰‹å†™å®éªŒè®°å½•ï¼Œæ‰€ä»¥å®éªŒè®°å½•ä¹Ÿå›Šæ‹¬åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­ã€‚ç„¶è€Œå®éªŒè®°å½•ç»ˆç©¶è¦æ‰“å°å‡ºæ¥å­˜æ¡£ï¼Œæ‰€ä»¥ä¼šå®šæœŸæ±‡æ€»ä¸€ä¸‹ã€‚ä¸ºäº†æ–¹ä¾¿æ±‡æ€»ï¼Œå‡¡æ˜¯å®éªŒæ—¥å¿—éƒ¨åˆ†çš„å†…å®¹ï¼Œæˆ‘ä¼šåœ¨ä¸‰çº§æ ‡é¢˜å¼€å¤´æ·»åŠ  :memo: (`:memo:`) ä½œä¸ºæ ‡è®°ï¼Œæ–¹ä¾¿è‡ªå·±æŸ¥æ‰¾ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\n\n![image-20210401203738957](https://sheldon-notes.oss-cn-shanghai.aliyuncs.com/img/image-20210401203738957.png)\n\nä½†æ˜¯ä¸€å‘¨æˆ–è€…åŠä¸ªæœˆä¸‹æ¥ï¼Œè¿™ä¸€æ®µä¸€æ®µçš„å†…å®¹ï¼Œä¸æ–­å¤åˆ¶ç²˜è´´åˆ°ä¸€ä¸ªæ–°çš„ markdown æ–‡ä»¶ä¸­ï¼Œå…¶å®ä¹Ÿæ¯”è¾ƒç¹çã€‚æ‰€ä»¥æˆ‘å¹²è„†å†™äº†ä¸€ä¸ª python ç¨‹åºæ¥å®ç°è‡ªåŠ¨åŒ–çš„å®éªŒæ—¥å¿—çš„æ±‡æ€»ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š\n\n```python\nimport os, glob, time \n\ndef markdown_parser(fp, emoji_tag=':memo:'):\n    with open(fp, 'r', encoding='utf-8') as f:\n        a = f.readlines()\n        \n    # æ‰¾åˆ°æ‰€æœ‰çš„ä¸‰çº§æ ‡é¢˜\n    tids = []\n    for idx, line in enumerate(a):\n        if line.startswith('### '):\n            tids.append(idx)\n            \n    # å¯¹ä¸‰çº§æ ‡é¢˜è¿›è¡Œéå†ï¼Œå¸¦emoji_tagçš„æ”¶é›†è¯¥éƒ¨åˆ†å†…å®¹\n    data = []\n    for idx, tid in enumerate(tids):\n        if a[tid].startswith('### :memo:'):\n            if idx+1 < len(tids):\n                data.extend(a[tids[idx]:tids[idx+1]])\n                # å¦‚æœæœ€åä¸€ä¸ªæ ‡é¢˜æ˜¯memoï¼Œ+1ä¼šæŠ¥é”™\n            elif idx == len(tids)-1: \n                data.extend(a[tids[idx]:])\n    \n    # å¦‚æœå½“å¤©æ—¥å¿—æ²¡æœ‰å®éªŒéƒ¨åˆ†å†…å®¹ï¼Œè¿”å›False\n    if len(data)>0:\n        return data\n    else:\n        return False \n \ndef summarize(wks):\n    # å‡†å¤‡æ±‡æ€»æ–‡ä»¶ç›¸å…³ä¿¡æ¯\n    summary_filename = \"exp-{}.md\".format(time.strftime('%Y%m%d',time.localtime(time.time())))\n    timeStamp = time.strftime('%Y-%m-%d %H:%M:%S',time.localtime(time.time()))\n    frontMatter = \"---\\ntitle: å®éªŒè®°å½•æ±‡æ€»-\\nexcerpt: \\ndate: {}\\ntags: \\ncategories: \\n- å·¥ä½œ\\n---\\n\".format(timeStamp)\n    all_info = [frontMatter]\n    \n    # è¯»å–æ–‡ä»¶åˆ—è¡¨å¹¶æŒ‰ç…§åˆ›å»ºæ—¶é—´æ’åºï¼Œæœ€æ–°çš„idä¸º-1\n    logs = sorted(glob.glob(wks+'/*.md'), key=os.path.getctime)\n    \n    # æ”¶é›†å¸¦æœ‰expå‰ç¼€çš„æ–‡ä»¶id\n    sids = []\n    for idx, fp in enumerate(logs): \n        _, fname = os.path.split(fp)\n        if fname.startswith('exp'):\n            sids.append(idx)\n\n    # æŒ‰ç…§å·²æœ‰è®°å½•æ”¶é›†æ–°è¿‘åˆ›å»ºçš„æ—¥å¿—æ–‡ä»¶\n    parts = logs[sids[-1]+1:]\n    \n    # éå†æ–‡æ¡£å®Œæˆå¸¦`memo`æ ‡ç­¾éƒ¨åˆ†æ®µè½çš„æ”¶é›†\n    for fp in parts:\n        _, fname = os.path.split(fp)\n        fdate, _ = fname.split(\".\")\n        memos = markdown_parser(fp)\n        if memos:\n            all_info.append(\"\\n\\n## {}\\n\\n\".format(fdate))\n            # é˜²æ­¢å‰é¢çš„å†…å®¹æ²¡æœ‰æ¢è¡Œï¼ŒäºŒçº§æ ‡é¢˜å¤±æ•ˆ\n            all_info.extend(memos)\n    \n    # å†™å…¥æ‰€æœ‰æ”¶é›†çš„ä¿¡æ¯åˆ°æ–‡æ¡£\n    with open(os.path.join(wks, summary_filename), 'w', encoding='utf-8') as f: \n        for part in all_info:\n            f.write(part)\n    print('å®éªŒæ—¥å¿—æ±‡æ€»æˆåŠŸ!')\n\n\nif __name__==\"__main__\":\n    wks = r'd:\\log\\main\\source\\_posts'  \n    # the path to where you store logs\n    summarize(wks)\n```\n\nè¿è¡Œè¿™æ®µä»£ç åï¼Œä¼šåœ¨æ—¥å¿—ç›®å½•ä¸‹ç”Ÿæˆä¸€ä¸ªæ±‡æ€»çš„ markdown æ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨ typora å¯¼å‡ºä¸º word æ–‡æ¡£ï¼Œç¨å¾®è°ƒæ•´å›¾ç‰‡å¤§å°è¿˜æœ‰å…¶ä»–æ ¼å¼ï¼Œæ’å…¥é¡µç ï¼Œç„¶åæ‰“å°å‡ºæ¥å­˜æ¡£å³å¯ã€‚\n\n","categories":["python"]},{"title":"å…³äºåšå®¢çš„æ€è€ƒ","url":"/2021/04/01/thinkAboutBlog/","content":"### åˆå¿ƒ\n\n2021å¹´4æœˆ1æ—¥\n\næˆ‘åœ¨ github pages ä¸Šå¼„äº†ä¸€ä¸ªè‡ªå·±çš„åšå®¢ç½‘ç«™ï¼Œä»2020å¹´12æœˆåº•åˆ°ç°åœ¨ï¼Œå·²ç»æœ‰23ç¯‡æ–‡ç« ã€‚ä¸­é—´äºŒæœˆä»½å’Œä¸‰æœˆä»½åŸºæœ¬ä¸Šæ²¡åŠ¨ç¬”ï¼ŒAnywayï¼Œå¹³å‡ç®—ä¸‹æ¥æ¯ä¸ªæœˆ8ç¯‡ï¼Œç›¸å½“äºæ¯å‘¨è‡³å°‘ä¸¤ç¯‡åšå®¢æ–‡ç« ã€‚æˆ‘è§‰å¾—è¿™ä¸ªäº‹æƒ…è¿˜æ˜¯è¦æŒä¹‹ä»¥æ’åœ°åšã€‚\n\nè¦åšæŒå°±ç¦»ä¸å¼€åˆç†çš„å†…å®¹è§„åˆ’ã€‚å†…å®¹ä¸ŠåŸºæœ¬è¿˜æ˜¯å®šæ ¼åœ¨ä¸€äº›æœ‰ç”¨çš„ä¸œè¥¿ä¸Šï¼Œç¨å¾®ç¡¬æ ¸ä¸€ç‚¹ï¼Œéƒ½æ˜¯æ•°æ®åˆ†æï¼Œå°å·¥å…·ä»£ç ä¹‹ç±»çš„å†…å®¹ã€‚è™½ç„¶æˆ‘ä¼šå°½é‡æ”¾ä¸€äº›å¯èƒ½åˆ«äººä¹Ÿèƒ½ç”¨å¾—ç€çš„ä»£ç ï¼Œä½†æ˜¯å…¶å®é€‚ç”¨èŒƒå›´è¿˜æ˜¯å¾ˆæœ‰é™ã€‚æ‰€ä»¥ä»å†…å®¹ä¸Šçœ‹ï¼Œè¿™ä¸ªåšå®¢çš„å‘½è¿å°±æ˜¯æ— äººé—®æ´¥ï¼Œåªæ˜¯æˆ‘è‡ªå¨±è‡ªä¹ã€‚ä½†å¦‚æœèƒ½è‡ªå¨±è‡ªä¹å¾ˆé•¿æ—¶é—´ï¼Œé‚£ä¹Ÿæ˜¯ä¸€ä»¶äº†ä¸èµ·çš„äº‹æƒ…ã€‚è€Œä¸”æ—¢ç„¶æ˜¯è‡ªå¨±è‡ªä¹çš„æ€§è´¨ï¼Œé‚£å¾ˆå¤šä¸œè¥¿å¯ä»¥ç¨å¾®éšæ„ä¸€äº›ã€‚è¿™å–å†³äºæˆ‘å¼„è¿™ä¸ªåšå®¢çš„åˆå¿ƒåˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿ\n\n![image-20210401092829792](https://sheldon-notes.oss-cn-shanghai.aliyuncs.com/img/image-20210401092829792.png)\n\näººæˆ–å¤šæˆ–å°‘æœ‰ä¸€äº›â€œæµä¼ åƒå¤â€çš„æ„¿æœ›ï¼Œè¿™ä¹Ÿå¯èƒ½æ˜¯è‡ªæˆ‘ä»·å€¼å®ç°çš„æœ€é«˜å±‚æ¬¡ã€‚æˆ‘ä»¬ç¹æ®–ï¼Œæ˜¯æƒ³æŠŠåŸºå› æµä¼ ä¸‹å»ï¼›æˆ‘ä»¬ç«‹ä¸šï¼Œæ˜¯æƒ³æŠŠç†æƒ³ä¼ æ‰¿ä¸‹å»ã€‚ç„¶è€Œåƒæˆ‘è¿™æ ·çš„æ™®é€šäººï¼Œæ•°ä»¥äº¿ä¸‡è®¡çš„æ™®é€šäººï¼Œç»ˆå…¶ä¸€ç”Ÿä¹Ÿä¸è¿‡æ˜¯å†å²æ´ªæµä¸­ä¸èµ·çœ¼çš„å°æ°´æ»´ã€‚å¯å³ä¾¿å¦‚æ­¤ï¼Œå°äººç‰©åŒæ ·æœ‰å°äººç‰©çš„è´¡çŒ®ï¼Œæœ‰å°äººç‰©çš„æ•…äº‹ï¼Œæœ‰å°äººç‰©çš„æ€è€ƒã€‚è€Œä¸”å°äººç‰©ä¹Ÿæœ‰æƒåˆ©å»è®°å½•å’Œä¼ é€’è¿™äº›ä¸œè¥¿ï¼Œå°±åƒæ¯ä¸ªäººçš„ç”Ÿè‚²æƒä¸èƒ½è¢«å‰¥å¤ºä¸€æ ·ã€‚æ‰€ä»¥æˆ‘çš„åˆå¿ƒï¼Œå¤§è‡´å°±æ˜¯åœ¨è¡Œä½¿æˆ‘ç”Ÿå‘½èµ‹äºˆçš„åŸºæœ¬æƒåˆ©å§ã€‚è¿™ä¸ªè¯è¯´å¾—å¾ˆç©ºè™šï¼Œ**å…¶å®æˆ‘ä¹Ÿä¸æ˜¯å¸Œæœ›é€šè¿‡è¿™ç§æ–¹å¼æˆä¸ºç½‘çº¢æˆ–è€…å¤§å’–ï¼Œåªä¸è¿‡æ˜¯ç”¨ä¸€ç§ easy accessible çš„æ–¹å¼å¸®åŠ©è‡ªå·±ç•™ä¸‹ä¸€äº›æœ‰ä»·å€¼çš„è®°å¿†ï¼Œå…å¾—è‡ªå·±è€äº†ä¹‹åéƒ½æ²¡æœ‰è·Ÿå­å­™åä»£å¹ç‰›é€¼çš„èµ„æœ¬ã€‚**\n\nåœ¨ä¿¡æ¯çˆ†ç‚¸çš„æ—¶ä»£ï¼Œåªè¨€ç‰‡è¯­çš„ä¿¡æ¯åªä¼šä»ç¢ç‰‡é€æ¸å˜æˆåƒåœ¾ï¼Œæœ€ç»ˆè¢«é—å¿˜ã€‚ä¹‹å‰æµè¡Œè¿‡ä¸€å¥è¯ï¼Œâ€œæ¯”æ­»äº¡æ›´å¯æ€•çš„æ˜¯è¢«é—å¿˜â€ã€‚å½“ç„¶äº†æˆ‘ä¹Ÿä¸æ•¢å¥¢æ±‚è‡ªå·±ç™¾å¹´ä¹‹åè¿˜èƒ½è¢«è°è®°ä½ã€‚è·Ÿè®©äººè®°ä½ç›¸æ¯”ï¼Œè®©äº’è”ç½‘è®°ä½ï¼Œæ˜¾ç„¶æ˜¯ä¸€ä»¶æ›´ç®€å•çš„äº‹æƒ…ã€‚å› ä¸ºä»æŠ€æœ¯ä¸Šè®²ï¼Œä¸è¿‡æ˜¯ä¸€å †äºŒè¿›åˆ¶ç¼–ç å­˜å‚¨åˆ°æŸä¸ªæœåŠ¡å™¨ä¸Šã€‚\n\nä¸ºäº†é™ä½é£é™©ï¼Œæˆ‘ä½¿ç”¨äº† hexo + github pages çš„æ–¹æ¡ˆï¼Œä¸€æ¥æ˜¯å› ä¸º github åœ¨å…¨ä¸–ç•ŒèŒƒå›´å†…å¤ªé€šç”¨äº†ï¼Œä¼°è®¡èƒ½å¤ŸæŒç»­æ¯”è¾ƒé•¿çš„æ—¶é—´ï¼›äºŒæ¥æˆ‘æ‰€æœ‰çš„å†…å®¹ï¼Œå…¶å®éƒ½å…ˆå­˜å‚¨åœ¨æœ¬åœ°ï¼Œç„¶åéƒ¨ç½²åˆ° github ä¸Šï¼Œå¦‚æœ github ä¸è¡Œï¼Œæˆ‘è¿˜å¯ä»¥ç”¨ gitee æˆ–è€… gitlabã€‚è€Œå›½å†…ä¹Ÿæœ‰å¾ˆå¤šæŠ€æœ¯åšå®¢ç½‘ç«™ï¼Œæ¯”å¦‚ CSDN æˆ–è€…ç®€ä¹¦ï¼Œè¿™äº›å…¬å¸æ€»ç»™äººä¸ç‰¢é çš„æ„Ÿè§‰ï¼Œæˆ–è®¸æ˜¯å¹¿å‘Šå¤ªå¤šäº†å§ã€‚","categories":["blog"]},{"title":"å®‰è£…å’Œé…ç½®gitlabç½‘ç«™","url":"/2021/04/01/use-gitlab/","content":"### gitlabçš„éƒ¨ç½²\n\ngitlabçš„éƒ¨ç½²å®‰è£…å…¶å®ä¹Ÿéå¸¸ç®€å•ï¼Œä¸»è¦å‚è€ƒä¸‹é¢é“¾æ¥ã€‚\n\nhttps://blog.csdn.net/qq_35844177/article/details/106876923\n\nå…³äº`ufw`é˜²ç«å¢™è®¾ç½®å¯ä»¥é¢å¤–å‚è€ƒï¼š\n\nhttps://zhuanlan.zhihu.com/p/139381645\n\nå¼„å¥½äº†ä¹‹åï¼Œéœ€è¦æŠŠæˆ‘ä»¥å‰æ¶è®¾çš„ç½‘ç«™çš„apache2æœåŠ¡å…³é—­ï¼ˆä¸ç„¶è¿›å…¥è®¾ç½®å¥½çš„åŸŸåå°±ä¸æ˜¯gitlabï¼‰ï¼š\n\n```\nsudo /etc/init.d/apache2 stop\n```\n\nhttps://www.cnblogs.com/supe/p/8010612.html\n\nç„¶åè¿˜å¯ä»¥[ç¦æ­¢apache2å¼€æœºè‡ªå¯åŠ¨](https://www.sunzhongwei.com/since-launch-of-ubuntu-2004-ban-apache-boot)\n\n```\nsudo systemctl disable apache2\n```\n\nå†è®¾ç½®gitlabå¼€æœºè‡ªå¯åŠ¨\n\n```\nsudo systemctl enable gitlab-runsvdir.service\n```\n\næ¥ä¸‹æ¥è®¿é—®ä¹‹å‰è®¾ç½®çš„åŸŸåï¼ˆhttp://10.161.135.46)å°±å¯ä»¥ç™»é™†gitlabäº†ï¼Œç¬¬ä¸€æ¬¡ç™»é™†è¦ä¿®æ”¹å¯†ç ï¼Œè€Œç®¡ç†å‘˜è´¦æˆ·åé»˜è®¤å°±æ˜¯rootã€‚\n\n![](https://sheldon-notes.oss-cn-shanghai.aliyuncs.com/img/%E6%B7%B1%E5%BA%A6%E6%88%AA%E5%9B%BE_%E9%80%89%E6%8B%A9%E5%8C%BA%E5%9F%9F_20201203185416.png)\n\nè€Œå…¶ä»–ç”¨æˆ·æ³¨å†Œä¹‹åï¼Œå¿…é¡»è¦ç®¡ç†å‘˜approveæ‰èƒ½ç™»é™†ï¼Œè¿™ä¸€ç‚¹éœ€è¦æ³¨æ„ä¸‹ï¼š\n\n![](https://sheldon-notes.oss-cn-shanghai.aliyuncs.com/img/%E6%B7%B1%E5%BA%A6%E6%88%AA%E5%9B%BE_%E9%80%89%E6%8B%A9%E5%8C%BA%E5%9F%9F_20201203191928.png)\n\næ–°ç”¨æˆ·ç™»å½•ä¼šè®©ä½ é€‰æ‹©è§’è‰²ï¼Œå…¶å®å¦‚æœæ˜¯ç ”ç©¶ç”Ÿæˆ–è€…åšå£«åï¼Œå°±æ˜¯Developerï¼Œè€å¸ˆå°±æ˜¯Leadï¼Œä¼°è®¡ä¹Ÿæ²¡å•¥ç”¨ã€‚\n\n![image-20201203192128308](https://sheldon-notes.oss-cn-shanghai.aliyuncs.com/img/image-20201203192128308.png)\n\nç„¶åæˆ‘æ–°å»ºäº†è‡ªå·±ç¬¬ä¸€ä¸ªä»“åº“ï¼Œä½†æ˜¯å®ƒæç¤ºæˆ‘éœ€è¦è®¾ç½®sshçš„å…¬é’¥ï¼Œæˆ‘è§‰å¾—éº»çƒ¦ï¼Œå¦‚æœéœ€è¦cloneåˆ°æœ¬åœ°æˆ–è€…åŒæ­¥ï¼Œå¯ä»¥ä½¿ç”¨httpã€‚\n\n![image-20201203193159877](https://sheldon-notes.oss-cn-shanghai.aliyuncs.com/img/image-20201203193159877.png)\n\næˆ‘è‡ªå·±ä»¥åè‚¯å®šæ˜¯è¦åšPIçš„ï¼Œæ‰€ä»¥è¿™ä¸ªä¸œè¥¿ç§¯ç´¯èµ·æ¥å¯¹æˆ‘è‡ªå·±åé¢ä¹Ÿæ˜¯æœ‰å¥½å¤„çš„ã€‚æˆ‘è¿˜æ˜¯è¦ç§¯ææ¨åŠ¨èµ·æ¥ï¼Œåˆ«å› ä¸ºä¸€äº›å›°éš¾å°±åœæ»äº†ï¼Œå› ä¸ºè¿™ä¸ªæœ¬è´¨ä¸Šç¡®å®æ˜¯ä¸€ä»¶å¥½äº‹ã€‚åªæ˜¯å‰æœŸæˆ‘å°±éœ€è¦è‡ªå·±èº«å…ˆå£«å’æ‰“ä¸ªæ ·ï¼Œå¤§å®¶æœ‰ä¸ªæ¨¡æ¿å°±æ¯”è¾ƒå¥½æ“ä½œã€‚\n\n### ä¿®å¤gitlab\n\nä¸‰ä¸ªæœˆä¹‹å‰åœ¨æœ¬åœ°ï¼ˆå°å¼æœºåŠ è·¯ç”±å™¨ï¼‰æ¶è®¾äº†gitlabç½‘ç«™ï¼ˆ`_gitlab_`å±€åŸŸç½‘è®¿é—®`192.168.0.80`ï¼‰ï¼Œä½†æ˜¯æ²¡èƒ½æ¨å¹¿èµ·æ¥ï¼Œåæ¥è‡ªå·±ä¹Ÿæœ‰å¾ˆå¤šäº‹æƒ…è¿™ä¸ªå°±è’åºŸäº†ã€‚æˆ‘çš„gitlabç”¨æˆ·åå’Œå¯†ç Edgeæµè§ˆå™¨å·²ç»è®°ä½æˆ‘æŠŠè‡ªå·±è®¾ç½®æˆäº†è¶…çº§ç®¡ç†å‘˜ï¼Œå‘ç°åˆ«äººæ–°å»ºçš„private projectæˆ‘ä¹Ÿèƒ½æŸ¥çœ‹ï¼š\n\n![image-20210326142323957](https://sheldon-notes.oss-cn-shanghai.aliyuncs.com/img/image-20210326142323957.png)\n\ngitlabçš„æ•…éšœæ— éå°±æ˜¯å› ä¸ºé•¿æ—¶é—´å·¥ä½œå‡ºç°çš„å­˜å‚¨ç¡¬ç›˜æŒ‚è½½é”™è¯¯ï¼Œå¯¼è‡´ç½‘ç«™èƒ½æ‰“å¼€ï¼Œä½†æ˜¯ä»“åº“æ˜¾ç¤º503é”™è¯¯ã€‚æˆ‘é‡å¯äº†ä¸€ä¸‹ç”µè„‘å°±å¥½äº†ã€‚\n\ngitlabåŠ ä¸Šç”µå­å®éªŒè®°å½•è¿™ä¸ªäº‹æƒ…ï¼Œæˆ‘æ‰“ç®—æ˜¯å…ˆæ‰“ä¸ªæ ·ï¼Œç„¶åè·Ÿæ¨Šè€å¸ˆæ¨èä¸€ä¸‹ï¼Œçœ‹çœ‹èƒ½ä¸èƒ½åœ¨å®éªŒå®¤é‡Œè¾¹æèµ·æ¥ã€‚ç”µè„‘å’Œç½‘ç«™éƒ½æ˜¯ç°æˆçš„ï¼Œåªéœ€è¦å¼„ä¸€ä¸ªå›ºå®šIPå³å¯ã€‚\n\ngitlabé»˜è®¤æ˜¯è‹±æ–‡ç•Œé¢ï¼Œä½†æ˜¯å¯ä»¥è‡ªå·±é€‰æ‹©ä¸­æ–‡ï¼š\n\nhttps://www.centoscn.vip/2816.html\n\n### GitLabæ‚å­¦\n\nGitLabæˆ‘æ˜¯ä¸‹å®šå†³å¿ƒè¦å¥½å¥½ä½¿ç”¨çš„ï¼Œå±€åŸŸç½‘å°±å±€åŸŸç½‘ï¼Œç¾å¾—å¾ˆï¼Œä¸»è¦æ˜¯ä½œä¸ºä¸€ä¸ªä¸Šä¼ å­˜æ¡£çš„ä½œç”¨ï¼Œæ‰€ä»¥ä¹Ÿä¸éœ€è¦å¾ˆå¥½åœ°è”ç½‘ã€‚\n\n**gitlabç™»å½•ç•Œé¢å®šåˆ¶**\n\nhttps://blog.csdn.net/weixin_43606948/article/details/85222755\n\nç®¡ç†å‘˜ç™»å½•admin area-ã€‹Preferencesã€‹Appearance\n\n**ä¿®æ”¹gitlabä»“åº“å­˜æ”¾ç›®å½•**\n\nä¿®æ”¹/etc/gitlab/gitlab.rb\n\nhttps://blog.csdn.net/weixin_43606948/article/details/84890409\n\n```\n#é…ç½®gitlabçš„æ•°æ®å­˜å‚¨ä½ç½®ä¸º/homeç›®å½•ä¸‹ï¼Œä¿è¯ç¡¬ç›˜å®‰å…¨\ngit_data_dirs({ \"default\" => { \"path\" => \"/home/gitlab/git-data\" } })\n```\n\né‡æ–°ç”Ÿæˆé…ç½®ä»¥åŠå¯åŠ¨gitlab\n\n```\nsudo gitlab-ctl reconfigure\n```\n\n**gitlabæœ¬åœ°å¤‡ä»½**\n\nhttps://blog.csdn.net/weixin_43606948/article/details/84890522\n\nä¿®æ”¹/etc/gitlab/gitlab.rb\n\n```\ngitlab_rails['backup_path'] = '/home/backups'\n```\n\nä¿®æ”¹é…ç½®åï¼Œè®°å¾—ï¼š\n\n```\ngitlab-ctl reconfigure\n```\n\nå¤‡ä»½çš„å‘½ä»¤ï¼š\n\n```\ngitlab-rake gitlab:backup:create\n```\n\nè‡ªåŠ¨å¤‡ä»½åˆ™é€šè¿‡ä»»åŠ¡è®¡åˆ’crontab å®ç°ï¼š\n\n```\n#è¾“å…¥å‘½ä»¤crontab -e\nsudo crontab -e  \n#è¾“å…¥ç›¸åº”çš„ä»»åŠ¡\n0 2 * * * /opt/gitlab/bin/gitlab-rake gitlab:backup:create\n```\n\nç¼–å†™å®Œ /etc/crontab æ–‡ä»¶ä¹‹åï¼Œéœ€è¦é‡æ–°å¯åŠ¨cronæœåŠ¡\n\n```\nsystemctl restart crond\n```\n\nå¯è®¾ç½®åªä¿ç•™æœ€è¿‘7å¤©çš„å¤‡ä»½ï¼Œç¼–è¾‘é…ç½®æ–‡ä»¶ /etc/gitlab/gitlab.rb\n\n```\n# æ•°å€¼å•ä½ï¼šç§’\ngitlab_rails['backup_keep_time'] = 604800\n```\n\n**gitlabæ•°æ®æ¢å¤**\n\nhttps://blog.csdn.net/weixin_43606948/article/details/84890629\n\nå‡å¦‚å¤‡ä»½æ–‡ä»¶åœ°å€å¦‚ä¸‹ï¼š\n\n`/home/backups/1499244722_2017_07_05_9.2.6_gitlab_backup.tar`\n\néœ€è¦å…ˆåœæ­¢ unicorn å’Œ sidekiq ï¼Œä¿è¯æ•°æ®åº“æ²¡æœ‰æ–°çš„è¿æ¥ï¼Œä¸ä¼šæœ‰å†™æ•°æ®æƒ…å†µï¼š\n\n```\n# åœæ­¢ç›¸å…³æ•°æ®è¿æ¥æœåŠ¡\ngitlab-ctl stop unicorn\ngitlab-ctl stop sidekiq\n# æŒ‡å®šæ¢å¤æ–‡ä»¶ï¼Œä¼šè‡ªåŠ¨å»å¤‡ä»½ç›®å½•æ‰¾ã€‚ç¡®ä¿å¤‡ä»½ç›®å½•ä¸­æœ‰è¿™ä¸ªæ–‡ä»¶ã€‚\n# æŒ‡å®šæ–‡ä»¶åçš„æ ¼å¼ç±»ä¼¼ï¼š1499242399_2017_07_05_9.2.6ï¼Œç¨‹åºä¼šè‡ªåŠ¨åœ¨æ–‡ä»¶ååè¡¥ä¸Šï¼šâ€œ_gitlab_backup.tarâ€\n# ä¸€å®šæŒ‰è¿™æ ·çš„æ ¼å¼æŒ‡å®šï¼Œå¦åˆ™ä¼šå‡ºç° The backup file does not exist! çš„é”™è¯¯\nå¯¹åŒ…åŠ æƒé™\nchmod -R 777 *\ngitlab-rake gitlab:backup:restore BACKUP=1499242399_2017_07_05_9.2.6\n# å¯åŠ¨Gitlab\ngitlab-ctl start\n```\n\n**gitlabæ‰¹é‡å¯¼å…¥ç”¨æˆ·**\n\nå…ˆç®¡ç†å‘˜ç™»å½•ç³»ç»Ÿç®¡ç†ç•Œé¢ï¼ŒProfile Settingé‡Œè¾¹è·å¾—Private token\n\nå›åˆ°shell æ§åˆ¶å°ï¼Œé€šè¿‡cd /home åˆ‡æ¢åˆ°home ç›®å½• ï¼ˆè¿™é‡Œçš„ç›®å½•å¯ä»¥è‡ªè¡Œå®šï¼‰\n\nåœ¨/home ä¸‹åˆ›å»º userinfo.txt æ–‡ä»¶,å†…å®¹æ ¼å¼å¦‚ä¸‹\n\n```\n12345678 test1@phpsong.com test1 å¼ ä¸‰\n12345678 test2@phpsong.com test2 æå››\nå¯†ç  é‚®ç®± ç”¨æˆ·å åˆ«å\n```\n\nåœ¨/home ä¸‹åˆ›å»ºgitlabAddUser.sh è„šæœ¬ï¼Œä¸»è¦åˆ©ç”¨`curl`å‘½ä»¤ç»“åˆgitlabçš„apiç«¯å£å®Œæˆï¼š\n\n```sh\n#!/bin/bash\n#gitlabç”¨æˆ·æ‰¹é‡å½•å…¥è„šæœ¬\nuserinfo=\"userinfo.txt\"\nwhile read line\ndo\n\tpassword=`echo $line | awk '{print $1}'`\n\tmail=`echo $line | awk '{print $2}'`\n\tusername=`echo $line | awk '{print $3}'`\n\tname=`echo $line | awk '{print $4}'`\n\tcurl -d \"password=$password&email=$mail&username=$username&name=$name&private_token=feGWSDFSEFWEFWEG\" \"http://190.168.0.80/api/v3/users\"\ndone <$userinfo\n```\n\n### åœ¨æœ¬åœ°æœåŠ¡å™¨ä¸ŠæGitLab Pages\n\nå¦‚æœèƒ½å¤ŸæŠŠä¸ªäººåšå®¢è·ŸGitLabç»“åˆèµ·æ¥ï¼Œé‚£å°±éå¸¸å®Œç¾äº†ã€‚ä¸è¿‡è¿™è‚¯å®šä¼šå¢åŠ æœåŠ¡å™¨çš„è´Ÿæ‹…ï¼Œæ‰€ä»¥æˆ‘åªæ˜¯æ”¶é›†ä¸€ä¸‹èµ„æ–™ï¼Œå¹¶ä¸ä¼šçœŸå»å°è¯•ã€‚\n\nhttps://my.oschina.net/doctorlzr1988/blog/3044964\n\n1. **å¼€å¯åŠŸèƒ½**\n\nç¼–è¾‘ /etc/gitlab/gitlab.rbæ–‡ä»¶ï¼Œä¿®æ”¹å¦‚ä¸‹ä¸¤è¡Œï¼š\n\n```\n##! Define to enable GitLab Pages\npages_external_url \"http://R7102/\"\ngitlab_pages['enable'] = true\n```\n\næ³¨æ„çš„è¿™é‡Œçš„pages_external_urlï¼Œé…ç½®çš„æ˜¯Pagesä½¿ç”¨çš„åŸŸåã€‚å¦‚æœä½ æ²¡æœ‰åŸŸåï¼Œå°±å…ˆéšä¾¿å†™ä¸ªä¸»æœºåä»€ä¹ˆçš„ã€‚ä¹‹åæˆ‘ä»¬å¯èƒ½é€šè¿‡é…ç½®Nginxæ¥è§£å†³ã€‚\n\næœ€å¥½é€šè¿‡ **gitlab-ctl restart** é‡å¯GitLabï¼Œä½¿å¾—GitLab PagesåŠŸèƒ½ç”Ÿæ•ˆã€‚\n\n2. **å®‰è£…é…ç½®GitLab Runner**ï¼Œ\n\nä¸ºäº†èƒ½å¤Ÿè‡ªåŠ¨å‘å¸ƒPagesï¼Œæˆ‘ä»¬éœ€è¦å®‰è£…GitLab Runnerï¼Œç„¶åé€šè¿‡GitLab CIåšåˆ°Pageså†…å®¹çš„è‡ªåŠ¨æ›´æ–°ã€‚\n\n[https://packages.gitlab.com/runner/gitlab-runner](https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fpackages.gitlab.com%2Frunner%2Fgitlab-runner)\n\nä¸‹è½½GitLab Runnerçš„å®‰è£…åŒ…ï¼Œå®‰è£…å¥½ä¹‹åï¼Œå°±å¯ä»¥é€šè¿‡å‘½ä»¤ä¸ºæˆ‘ä»¬çš„é¡¹ç›®æ·»åŠ runneräº†ï¼Œåœ¨å‘½ä»¤è¡Œä¸­è¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼ŒæŒ‰ç…§æç¤ºä¸€æ­¥ä¸€æ­¥å®Œæˆå³å¯ã€‚\n\n```\ngitlab-runner register\n```\n\nå…¶ä¸­éœ€è¦å¡«å†™URLå’ŒTokenï¼Œå¯ä»¥åœ¨GitLabé¡¹ç›®çš„æ¦‚è§ˆ->Runnersæ‰¾åˆ°ï¼Œç±»ä¼¼ä¸‹å›¾ï¼š\n\n![52f8c7f53da1ab5708b0c1262b15126a5c2.jpg](https://sheldon-notes.oss-cn-shanghai.aliyuncs.com/img/52f8c7f53da1ab5708b0c1262b15126a5c2.jpg)\n\n3. **é…ç½®PagesæœåŠ¡çš„CI**\n\nè¿™ä¸ªä¸œè¥¿å¯ä»¥å‚è€ƒ[hexoç«™ç‚¹çš„](https://hexo.io/zh-cn/docs/gitlab-pages)ï¼Œä¸»è¦æ˜¯åœ¨æ ¹ç›®å½•ä¸‹åˆ›å»º`.gitlab-ci.yml`æ–‡ä»¶ï¼š\n\n```yaml\nimage: node:10-alpine # use nodejs v10 LTS\ncache:\n  paths:\n    - node_modules/\n\nbefore_script:\n  - npm install hexo-cli -g\n  - npm install\n\npages:\n  script:\n    - hexo generate\n  artifacts:\n    paths:\n      - public\n  only:\n    - master\n```\n\n4. **å¦‚ä½•è®¿é—®Pagesé¡µé¢å‘¢ï¼Ÿ**\n\nå¦‚æœä½ æœ‰åœ¨ä¸Šé¢é…ç½®å¼€å¯Pagesæ—¶é…ç½®äº†åŸŸåäº†ï¼Œé‚£ä¹ˆç›´æ¥è®¿é—®ï¼š**http://ä½ çš„Gitè´¦å·.åŸŸå/å·¥ç¨‹å**ï¼Œä¾‹å¦‚ï¼š\n\n*http://xiaowang.mypages.com/project01*\n\nä½†æ˜¯å¦‚æœä½ ä¸æƒ³é‚£ä¹ˆéº»çƒ¦è¿˜å¾—é…ç½®åŸŸåçš„è¯ï¼Œè¿™é‡Œä¹Ÿæœ‰è§£å†³æ–¹æ³•ï¼Œç”±äºGitLab PagesæœåŠ¡æ˜¯éƒ¨ç½²åˆ°Nginxä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åŒé…ç½®Nginxæ¥é€šè¿‡IPåœ°å€è®¿é—®ã€‚\n\né¦–å…ˆè¦æ‰¾å•Šæ‰¾ï¼Œæ‰¾åˆ°Pagesçš„å‘å¸ƒä½ç½®ï¼Œå’ŒGitLabå†…ç½®Nginxçš„ä½ç½®ï¼Œåˆ†åˆ«å¦‚ä¸‹ï¼š\n\n1ã€Pageséƒ¨ç½²ç›®å½•ï¼š/var/opt/gitlab/gitlab-rails/shared/pages\n\n2ã€å†…ç½®Nginxç›®å½•ï¼š/var/opt/gitlab/nginx\n\nç„¶åç¼–è¾‘nginxç›®å½•ä¸‹çš„conf/gitlab-pages.confæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š\n\n```bash\nserver {\n  listen 6869; ## ç«¯å£æ ¹æ®éœ€è¦å¡«å†™\n  server_name 10.21.100.200; ## IPæ ¹æ®å®é™…æƒ…å†µå¡«å†™\n  server_tokens off; ## Don't show the nginx version number, a security best practice\n \n  ## Disable symlink traversal\n  disable_symlinks on;\n \n  access_log  /var/log/gitlab/nginx/gitlab_pages_access.log gitlab_access;\n  error_log   /var/log/gitlab/nginx/gitlab_pages_error.log;\n \n  # Pass everything to pages daemon\n  location / {\n    # æŒ‡å‘pagesçš„å‘å¸ƒç›®å½•\n    root /var/opt/gitlab/gitlab-rails/shared/pages;\n    index index.html;\n  }\n \n  # Define custom error pages\n  error_page 403 /403.html;\n  error_page 404 /404.html;\n}\n```\n\né…ç½®å¥½åé‡å¯Nginxï¼šgitlab-ctl restart nginx\n\nè®¿é—®é¡µé¢ï¼š`http://IP:ç«¯å£/gitlabè´¦å·/å·¥ç¨‹å/public/`ï¼Œä¾‹å¦‚ï¼š`http://10.21.100.200:6869/xiaowang/project01/public/#/`","categories":["gitlab"]},{"title":"standalone-HTML-image-embedding","url":"/2021/04/01/standalone-HTML-image-embedding/","content":"å–œæ¬¢ç”¨typoraå¯¼å‡ºå¸¦æœ‰ä¸»é¢˜çš„htmlæ–‡ä»¶åˆ†äº«ç»™åˆ«äººï¼Œä½†æ˜¯ä¸èƒ½åšåˆ°standaloneï¼Œæ­¤ä»£ç å¯ä»¥æŠŠå›¾ç‰‡é™„ä»¶ä»¥base64å½¢å¼åµŒå…¥ç½‘é¡µä¸­ã€‚\n\n```python\nimport os,sys, shutil\nfrom bs4 import BeautifulSoup\nimport base64 \nfrom urllib.request import unquote, urlopen\nimport PySimpleGUI as sg\n```\n\né¦–å…ˆå¯¼å…¥ä¸€äº›éœ€è¦ç”¨åˆ°çš„åŒ…ï¼Œæˆ‘æ˜¯æ‰“ç®—é€šè¿‡ typora å¯¼å‡ºå¸¦æœ‰ä¸»é¢˜é£æ ¼çš„ HTML ç½‘é¡µï¼Œç„¶åå†ç”¨ `BeautifulSoup` è¿™ä¸ªæ¨¡å—è¯»å–ç½‘é¡µï¼Œå¹¶ä¸”æ‰¾åˆ°å…¶ä¸­çš„æ’å›¾é™„ä»¶çš„æ ‡ç­¾ï¼Œå®Œæˆä» url åˆ° base64 å­—èŠ‚åµŒå…¥ã€‚æŠŠå›¾åƒæ–‡ä»¶ç”¨äºŒè¿›åˆ¶è¯»å–åå®Œæˆè½¬ç ã€‚ç”±äºæœ‰äº›æ’å›¾æ˜¯æŒ‡å‘ç›¸å¯¹è·¯å¾„ä¸‹çš„æœ¬åœ°æ–‡ä»¶ï¼Œæœ‰äº›æ˜¯åœ¨è¿œç¨‹æœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶ï¼Œæ‰€ä»¥å¯¹äºåè€…è¿˜éœ€è¦ download ä¸‹æ¥å†…å®¹ï¼Œå°±è¦ç”¨åˆ° `urllib`ä¸­çš„ä¸€äº› æ¨¡å—äº†ã€‚æœ€åä¸ºäº†æ–¹ä¾¿ä½¿ç”¨è¿™ä¸ªå°å·¥å…·ï¼Œè¿˜åŸºäº `pySimpleGUI` æ¨¡å—å¼„äº†ä¸€ä¸ªç®€å•çš„ç”¨æˆ·ç•Œé¢ã€‚è¿™ä¸ªç”¨æˆ·ç•Œé¢æœ‰æ¯”è¾ƒå¥½çš„æ¥å£è®¾ç½®ï¼Œä¹Ÿå¯ä»¥ç”¨äºå…¶ä»–ç±»ä¼¼çš„å°å·¥å…·ï¼ŒGUI éƒ¨åˆ†çš„ä»£ç å¦‚ä¸‹ï¼š\n\n```python\nclass app:\n    '''é€šç”¨ç‰ˆç®€æ˜“å·¥å…·ç”¨æˆ·ç•Œé¢\n    1. ä½¿ç”¨å­—å…¸ä¼ å…¥å·¥å…·å‡½æ•°é›†\n    2. æŒ‰é’®å¹³é“ºï¼Œæ¯ä¸ªæŒ‰é’®å¯¹åº”ä¸€ä¸ªå‡½æ•°åŠŸèƒ½\n    '''\n    def __init__(self,app_name,func_dict):\n        self.funcs = func_dict\n        self.layout = self.design()\n        self.window = sg.Window(app_name, \n                                self.layout,\n                                location=(400,400),\n                                grab_anywhere=True,\n                                disable_minimize=True,\n                                keep_on_top=True)\n        self.run()\n    \n    def design(self):\n        layout = [[sg.Button(x) for x in self.funcs.keys()],\n                [sg.Text(\"æ¬¢è¿ä½¿ç”¨\",size=(20,1),key=\"_INFO_\")]]\n        return layout\n    \n    def run(self):\n        while True:\n            event,values = self.window.Read()\n            for key in self.funcs.keys():\n                if event==key:\n                    fp = sg.popup_get_file('æ‰“å¼€éœ€è¦è½¬åŒ–çš„HTMLæ–‡ä»¶')\n                    if fp is not None:\n                        info = self.funcs[key](fp)\n                        self.window.Element(\"_INFO_\").Update(key+\":\"+info)\n            if event is None:\n                break\n        self.window.Close()\n```\n\nç„¶åæ˜¯æœ€ä¸ºæ ¸å¿ƒçš„ HTML å›¾ç‰‡è½¬ç åµŒå…¥çš„å‡½æ•°ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š\n\n``` python\n# å…ˆä½¿ç”¨typoraå¯¼å‡ºhtmlï¼Œå†ä½¿ç”¨æ­¤ä»£ç æå®šå›¾ç‰‡é“¾æ¥ç¼–ç æˆbase64\ndef img_base64(html_filepath):\n    wks,html_filename = os.path.split(html_filepath)\n    with open(os.path.join(wks,html_filename),\"r\",encoding='utf-8') as f:\n        content = f.read()\n    # soup = BeautifulSoup(content,features=\"lxml\")\n    soup = BeautifulSoup(content,features=\"html.parser\")\n    # 2020-06-12 21:03:12\n    # ä»£ç åœ¨æ–°æœºå™¨ä¸­è¿è¡Œå‡ºé”™ï¼Œlxmlä¸è¡Œï¼Œåªå¥½ç”¨html.parser\n    # å‚è€ƒ https://www.cnblogs.com/awakenedy/p/9753326.html\n    imgs = soup.find_all(\"img\")\n    for img in imgs:\n        imgpath = img['src']  \n        # 2020-12-09 17:20:19 å½“é™„ä»¶å›¾åƒå­˜åœ¨äºä¸­æ–‡æ–‡ä»¶å¤¹æ—¶ï¼Œè½¬åŒ–htmlä¼šä¹±ç ï¼Œéœ€è¦å¤„ç†ä¸€ä¸‹\n        # å‚è€ƒï¼ˆhttps://blog.csdn.net/mouday/article/details/80278938ï¼‰\n        imgpath = unquote(imgpath, encoding='utf-8')\n        pref = imgpath.split(\".\")[-1]\n        \n        if not imgpath.startswith(\"http\"):\n            with open(os.path.join(wks,imgpath),'rb') as f:\n                base64_data = base64.b64encode(f.read())\n        else:\n            response = urlopen(imgpath)\n            # ä½¿ç”¨requestsæ¨¡å—ä¼šæŠ¥é”™ã€‚\n            base64_data = base64.b64encode(response.read())\n            # 2021-03-29 14:15:16  å¦‚æœå›¾ç‰‡å·²ç»ä¸Šä¼ åˆ°é˜¿é‡Œäº‘ï¼Œåˆ™æ˜¯é“¾æ¥å½¢å¼\n\n        img['src'] = \"data:image/{};base64,\".format(pref)+str(base64_data,'utf-8')\n        # æ³¨æ„base64æ˜¯bytesï¼Œä½¿ç”¨strè½¬åŒ–æ—¶è¦å¸¦encodingå‚æ•°\n        # å¯¹imgçš„ä¿®æ”¹éƒ½æ˜¯inplaceçš„ï¼Œä»å±äºsoupå¯¹è±¡\n    ex_filename = os.path.join(wks,html_filename)\n    with open(ex_filename,\"w\", encoding='utf-8') as f:\n        ### è¦†ç›–ä¿å­˜htmlæ–‡ä»¶\n        ## 2021-03-29 16:26:15 \n        # æ³¨æ„hexo serverä¹Ÿä¼šæ¸²æŸ“htmlæ–‡ä»¶ï¼Œä½†æ˜¯ä¼šæŠ¥é”™ï¼Œæ‰€ä»¥å¯¼å‡ºhtmlæ–‡ä»¶åè½¬ç§»åˆ°æ¡Œé¢\n        f.write(str(soup))\n    shutil.move(ex_filename, os.path.expanduser('~/Desktop/ex-{}'.format(html_filename)))\n    return \"è½¬åŒ–äº†%då¼ å›¾åƒ\"%(len(imgs))\n```\n\nå¯ä»¥çœ‹åˆ°è¿™ä¸ªå‡½æ•°åšå‡ºäº†è®¸å¤šä¿®æ”¹ï¼Œå‰åè·¨åº¦å°†è¿‘ä¸€å¹´ï¼Œå¯ä»¥çœ‹åˆ°ä¸€ä¸ªè½¯ä»¶è¦çœŸçš„å¥½ç”¨ï¼Œè¿˜æ˜¯æœ‰å¾ˆå¤šç»†èŠ‚çš„ã€‚è°ƒç”¨åˆ™éå¸¸ç®€å•ï¼Œä»£ç å¦‚ä¸‹ï¼š\n\n\n```python\nif __name__ == \"__main__\":\n    app_name = \"img_base64\"\n    func_dict = {\"base64\":img_base64}\n    worker = app(app_name,func_dict)\n    worker.run()\n```\n\nå¦‚æœå¸Œæœ›ä¸æ‰“å¼€ IDE æ‰§è¡Œè¿™æ®µä»£ç ï¼Œå¯ä»¥è‡ªè¡Œç¼–å†™ bat æˆ–è€… sh è„šæœ¬æ¥è¿è¡Œã€‚","tags":["HTML","BeautifulSoup","base64","urllib"],"categories":["python"]},{"title":"å¦‚ä½•ç”¨originLabå®Œæˆpeakåˆ†æ","url":"/2021/03/31/originLab-peakAnalysis/","content":"å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå¾—åˆ°ä¸€ä¸ªå³°å½¢å›¾ï¼Œè‚‰çœ¼å¯è§ï¼Œæœ‰5ä¸ªå³°ï¼Œä¸”æ¯ä¸ªå³°éƒ½æ¯”è¾ƒæ¥è¿‘é«˜æ–¯åˆ†å¸ƒï¼š\n\n![image-20210331183703282](https://sheldon-notes.oss-cn-shanghai.aliyuncs.com/img/image-20210331183703282.png)\n\næ‰“å¼€OriginLabè½¯ä»¶ï¼Œ`Data>Import From File`ï¼ŒæŠŠcsvæ–‡ä»¶ä¸­çš„æ•°æ®å¯¼å…¥OriginLabï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\n\n![image-20210331183834108](https://sheldon-notes.oss-cn-shanghai.aliyuncs.com/img/image-20210331183834108.png)\n\næŸ¥çœ‹æ•°æ®è¡¨ï¼Œé€‰ä¸­`Distance`å’Œ`Count`ä¸¤åˆ—ï¼Œæ³¨æ„ä¸€ä¸ªæ˜¯ X åˆ—ï¼Œ ä¸€ä¸ªæ˜¯ Y åˆ—æ•°æ®ã€‚ç„¶å`Analysis > Peaks & Baseline > Peak Analyzer`å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\n\n![image-20210331184146716](https://sheldon-notes.oss-cn-shanghai.aliyuncs.com/img/image-20210331184146716.png)\n\nå¼¹å‡ºä¸€ä¸ª`Peak Analyzer`çš„å¯¹è¯æ¡†ï¼Œä¸€è·¯ç‚¹`Next`ï¼Œåˆ°`Find Peaks`è¿™ä¸€æ­¥çš„æ—¶å€™ï¼Œæ³¨æ„è®¾ç½®`Peak Filtering`é€‰é¡¹ï¼Œå¦‚ä¸‹å›¾ï¼Œç„¶åç»§ç»­Nextï¼Œç›´è‡³è¾“å‡ºç»“æœï¼š\n\n![image-20210331184544554](https://sheldon-notes.oss-cn-shanghai.aliyuncs.com/img/image-20210331184544554.png)\n\nåœ¨`Integration_Result`çš„è¡¨æ ¼ä¸­å¯ä»¥æŸ¥çœ‹æ±‡æ€»çš„ä¿¡æ¯ï¼š\n\n![image-20210331185031798](https://sheldon-notes.oss-cn-shanghai.aliyuncs.com/img/image-20210331185031798.png)\n\nå¯ä»¥çœ‹åˆ°åŠå³°å®½ï¼Œæœ€å¥½èƒ½åˆ°27.8 nmï¼Œè¯´æ˜ç›®å‰æˆåƒçš„åˆ†è¾¨ç‡ï¼Œåªèƒ½æ˜¯è¿™æ ·äº†ã€‚\n\n","tags":["peakåˆ†æ"],"categories":["OriginLab"]},{"title":"jupyterNotebookå¼€å¯æ’ä»¶","url":"/2021/01/17/jupyterNotebook-extension/","content":"\nå‚è€ƒ[çŸ¥ä¹ä¸Šçš„æ•™ç¨‹](https://zhuanlan.zhihu.com/p/258976438?utm_oi=803714813804044288)ï¼Œä¸»è¦ç”¨pipå‘½ä»¤ï¼Œç»“åˆæ¸…åé•œåƒæºè¿›è¡Œå®‰è£…ï¼š\n\n```bash\npip install jupyter_contrib_nbextensions -i https://pypi.tuna.tsinghua.edu.cn/simple\njupyter contrib nbextension install --user\npip install jupyter_nbextensions_configurator -i https://pypi.tuna.tsinghua.edu.cn/simple\n```\n\nç„¶åæ‰“å¼€jupyter notebookï¼Œåœ¨Nbextensionsé‡Œè¾¹è¿›è¡Œè®¾ç½®ï¼Œå¼€å¯ä¸‹é¢çš„æ’ä»¶ï¼š\n\n1. Code prettify: ä»£ç ç¾åŒ–\n2. Collapsible Headings: æ ‡é¢˜æŠ˜å \n3. Table of Contents: ç›®å½•\n4. Codefolding: ä»£ç æŠ˜å \n5. ExecuteTime: æ˜¾ç¤ºæ‰§è¡Œæ—¶é—´\n6. Snippets Menu: å¸¸ç”¨ä»£ç å—æŠ½å±‰\n7. Hinterland: ä»£ç è¡¥å…¨\n\n### é…ç½®Snippets Menuæ’ä»¶\n\nå…¶å®å°±æ˜¯å†™å…¥ä¸€ä¸ªjsonï¼Œè¿™ä¸ªæ’ä»¶çš„é…ç½®é¡µæä¾›äº†æ ·æœ¬ï¼š\n\n```json\n{\n    \"name\" : \"My favorites\",\n    \"sub-menu\" : [\n        {\n            \"name\" : \"Menu item text\",\n            \"snippet\" : [\"import something\",\n                         \"\",\n                         \"new_command(3.14)\",\n                         \"other_new_code_on_new_line('with a string!')\",\n                         \"stringy(\\\"if you need them, escape double quotes with a single backslash\\\")\",\n                         \"backslashy('This \\\\ appears as just one backslash in the output')\",\n                         \"backslashy2('Here \\\\\\\\ are two backslashes')\"]\n        },\n        {\n            \"name\" : \"TeX can be written in menu labels $\\\\alpha_W e\\\\int_0 \\\\mu \\\\epsilon$\",\n            \"snippet\" : [\"another_new_command(2.78)\"]\n        }\n    ]\n}\n\n```\n\nä¿®æ”¹å¦‚ä¸‹ï¼š\n\n```json\n{\n    \"name\" : \"å¸¸ç”¨æ¨¡å—\",\n    \"sub-menu\" : [\n        {\n            \"name\" : \"å›¾è¡¨ç»˜åˆ¶\",\n            \"snippet\" : [\"import numpy as np\",\n                         \"import pandas as pd\",\n                         \"%matplotlib inline\",\n                         \"%config InlineBackend.figure_format = 'svg'\",\n                         \"import matplotlib.pyplot as plt\",\n                         \"import seaborn as sns\",\n                         \"import os, glob\"]\n        },\n        {\n            \"name\" : \"æ•°æ®å¤„ç†\",\n            \"snippet\" : [\"import pickle\",\n                         \"from skimage import io\",\n                         \"from scipy.signal import savgol_filter\"]\n        }\n    ]\n}\n\n```\n","tags":["jupyter"],"categories":["python"]},{"title":"createDraftè„šæœ¬çš„ä½¿ç”¨","url":"/2021/01/17/createDraft/","content":"\n### createDraftçš„ä½œç”¨å’Œæºä»£ç \n\nä¸ºæ–¹ä¾¿åæœŸæ‰¹é‡è‡ªåŠ¨åŒ–åˆ†ç±»æ±‡æ€»æ—¥å¿—ï¼Œå†™äº†ä¸€ä¸ªbatè„šæœ¬ï¼Œç»™markdownæ–‡ä»¶æ·»åŠ `Front Matter`ã€‚å…·ä½“ä»£ç å¦‚ä¸‹ï¼š\n\n```bash\n:: 2021-01-12 10:31:58\n:: ç”Ÿæˆå…·æœ‰FrontMatterçš„markdownæ–‡ä»¶\n:: å…·æœ‰titleã€excerptã€dateã€tagsã€categoriesç­‰\n\necho off\nset /p t=Please input the filename (no space):\n:: titleå¯åœ¨FrontMatterä¸­è‡ªè¡Œå®šä¹‰\n\nset d=%date:~0,4%-%date:~5,2%-%date:~8,2% %time:~0,8%\n:: %date%å¯ä»¥å–å½“å‰æ—¥æœŸï¼Œå¦‚2021/01/12 å‘¨äºŒ\n:: xæ˜¯å¼€å§‹ä½ç½®ï¼Œyæ˜¯å–å¾—å­—ç¬¦æ•°\n:: %time%å–å½“å‰æ—¶é—´ï¼Œå¦‚10:21:21.68\n:: ç­‰äºå·å³è¾¹æ‰€æœ‰çš„ä¸œè¥¿éƒ½ä¼šè¢«èµ‹å€¼ç»™å˜é‡ï¼ŒåŒ…æ‹¬ç©ºæ ¼\n\n:: ä¸‹é¢å¼€å§‹å†™å…¥FrontMatteråˆ°markdownæ–‡ä»¶\necho --->>%t%.md\necho title: %t%>>%t%.md\necho excerpt: This is a summary of this draft>>%t%.md\necho date: %d%>>%t%.md\necho tags: >>%t%.md\necho categories: >>%t%.md\necho - draft >>%t%.md\necho --->>%t%.md\n```\n\n### å·¥å…·çš„ä½¿ç”¨\n\nåŒå‡»`createDraft.bat`æ‰¹å¤„ç†è„šæœ¬ï¼Œå¯åœ¨åŒç›®å½•ä¸‹è‡ªåŠ¨ç”Ÿæˆå…·æœ‰`Front Matter`çš„markdownæ–‡ä»¶ç”¨äºè®°å½•æ—¥å¿—ã€‚\n\n![image-20210115080404837](https://sheldon-notes.oss-cn-shanghai.aliyuncs.com/img/image-20210115080404837.png)\n\nå¦‚ä¸Šå›¾ï¼Œéœ€è¦è¾“å…¥markdownçš„æ–‡ä»¶åï¼Œæ³¨æ„ä¸è¦æœ‰ç©ºæ ¼ï¼Œä¹Ÿä¸è¦æœ‰ä¸­æ–‡å­—ç¬¦ï¼Œå»ºè®®ä½¿ç”¨è‹±æ–‡å’Œæ•°å­—ç»„åˆã€‚\n\n### Front Matterè¯´æ˜\n\n![image-20210115080929540](https://sheldon-notes.oss-cn-shanghai.aliyuncs.com/img/image-20210115080929540.png)\n\nå½“ä¸€ç¯‡æ—¥å¿—ç»“æŸåï¼Œéœ€è¦æ‹Ÿå®šä¸€ä¸ªåˆé€‚çš„æ ‡é¢˜ï¼Œå†™ä¸€å°æ®µæ‘˜è¦ï¼Œå¹¶è®¾ç½®ä¸è¶…è¿‡5ä¸ªæ ‡ç­¾ï¼Œä»¥åŠæ‰€å±åˆ†ç±»ã€‚å…³äº[Front Matterå…·ä½“å‚è€ƒæ­¤è¯´æ˜](https://hexo.io/zh-cn/docs/front-matter)ã€‚\n\n### æ—¥å¿—å¯¼å‡º\n\nä½¿ç”¨typoraç¼–è¾‘markdownï¼Œå¦‚æœè¦æŠŠå†…å®¹å‘é€ç»™åˆ«äººï¼Œå»ºè®®å¯¼å‡ºpdfã€‚å¦‚æœæ˜¯è¦æ‰“å°å‡ºæ¥ï¼Œå»ºè®®å¯¼å‡ºä¸ºdocxï¼š\n\n![image-20210115081505065](https://sheldon-notes.oss-cn-shanghai.aliyuncs.com/img/image-20210115081505065.png)\n\nè¿™æ ·èƒ½å¤Ÿæ˜¾ç¤ºéƒ¨åˆ†Front Matterçš„ä¿¡æ¯ï¼Œæ¯”å¦‚æ ‡é¢˜å’Œæ—¥æœŸã€‚å› ä¸ºå¦‚æœæ˜¯å®éªŒè®°å½•ï¼Œå°±éœ€è¦æ‰“å°å‡ºæ¥ï¼Œè¿™ä¸¤ä¸ªä¸œè¥¿å°±å¿…é¡»æ˜¾ç¤ºã€‚\n\n![image-20210115081655563](https://sheldon-notes.oss-cn-shanghai.aliyuncs.com/img/image-20210115081655563.png)\n\nè€Œä¸”åœ¨wordä¸­è¿˜å¯ä»¥å†æ¬¡å¯¹å›¾ç‰‡å¤§å°ä¹‹ç±»çš„è¿›è¡ŒäºŒæ¬¡ç¼–è¾‘è°ƒæ•´ä¹‹åå†æ‰“å°å‡ºæ¥ã€‚\n\n","tags":["typora","bat"],"categories":["blog"]},{"title":"DNA-PAGE-Analysis","url":"/2021/01/17/DNA-PAGE-Analysis/","content":"\næœ‰æ—¶å€™éœ€è¦å¯¹ç”µæ³³çš„æ¡å¸¦è¿›è¡ŒåŠå®šé‡åˆ†æï¼Œè¿™ç§ä¸€èˆ¬æ˜¯åŸºäºå›¾åƒä½¿ç”¨ImageJçš„æ’ä»¶è¿›è¡Œåˆ†æå¤„ç†çš„ã€‚ä¸è¿‡æˆ‘è‡ªå·±å†™äº†ä¸€ä¸ªé€»è¾‘ç®€å•ï¼Œæ“ä½œä¸Šæ›´åŠ å®ç”¨çš„å°å·¥å…·ã€‚\n\n![image-20210117192630917](https://sheldon-notes.oss-cn-shanghai.aliyuncs.com/img/image-20210117192630917.png)\n\nèƒ¶å›¾æ¡å¸¦çš„ç´¯ç§¯äº®åº¦ï¼Œç†è®ºä¸Šè·Ÿç¢±åŸºæ•°ç›®æˆæ­£æ¯”ï¼Œæ‰€ä»¥éœ€è¦å¯¹äº®éƒ¨çš„ç°åº¦å€¼æ‰£èƒŒæ™¯å†æ±‚å’Œï¼Œå¾—åˆ°ä¸€ä¸ªç›¸å¯¹æ‘©å°”æ•°ã€‚\n\n```javascript\n/**\n * åŸºäºèƒ¶å›¾å¯¹DNAè¿›è¡ŒåŠå®šé‡\n * è·å–æ¡å¸¦çš„ç´¯ç§¯äº®åº¦Count\n * Count = A*N\n * Aæ˜¯ä¸€ä¸ªå¸¸æ•°ï¼ŒNæ˜¯æ ¸è‹·é…¸ç‰©è´¨çš„é‡ï¼ˆç­‰äºDNAé“¾çš„nä¹˜ä»¥å…¶é•¿åº¦ï¼‰\n * ç”¨Rectangleå·¥å…·é€‰æ‹©å•ä¸ªæ¡å¸¦\n * è¿è¡Œæ­¤è„šæœ¬ï¼Œå¾—åˆ°Countæ•°å€¼ï¼Œæ‰“å°åˆ°Logçª—å£\n * å¤åˆ¶åˆ°ç”µå­è¡¨æ ¼è¿›è¡Œåç»­è®¡ç®—\n */\n run(\"8-bit\"); \n run(\"Duplicate...\", \" \");\n // å…ˆå¯¹çŸ©å½¢å±€éƒ¨å–èƒŒæ™¯\n getStatistics(area, mean, min, max, std, histogram);\n setAutoThreshold(\"Default dark\");\n run(\"Create Selection\");\n run(\"Measure\");\n area = getResult(\"Area\", 0);\n mean = getResult(\"Mean\", 0);\n count = (mean-min)*area;\n print(count);\n selectWindow(\"Results\");\n run(\"Close\");\n```\n","categories":["ImageJ"]},{"title":"ç®€åŒ–ç‰ˆFRETåˆ†æ","url":"/2021/01/12/simpleFRETanalysis/","content":"\nè„šæœ¬ä½¿ç”¨æ–¹æ³•è¯¦è§ä»£ç å†…æ³¨é‡Šï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¦æ ¹æ®å®éªŒå®¤å…·ä½“ä»ªå™¨å‚æ•°è®¾ç½®å¥½å…‰å­æ•°è½¬æ¢çš„ç›¸å…³å‚æ•°ã€‚\n\n- EM_Gain = 500;  // æ‹æ‘„æ—¶è®¾ç½®çš„å‚æ•°\n- Offset = 204;  // ç›¸æœºå†…ç½®\n- Sensitivity = 16.9;  // ç›¸æœºå†…ç½®\n- QE = 0.9;  //ç›¸æœºå†…ç½®ï¼Œä¹Ÿä¸è§å…‰æŸ“æ–™ç›¸å…³\n\n```javascript\n/**\n * Author: Xiaodong Xie\n * Date: 2021/1/12\n * Email: sheldon_sinap@163.com\n * Functionï¼šæ­¤ImageJè„šæœ¬ä¸“ç”¨äºç®€æ˜“çš„è§å…‰FRETåˆ†æ\n * \n * ## ä½¿ç”¨æ­¥éª¤  \n * 1. åˆ†åˆ«å°†ç›¸åŒè§†é‡é‡‡é›†çš„donorå’Œreceptorä¸¤ä¸ªé€šé“çš„åŸå§‹16-bitå›¾åƒç”¨ImageJæ‰“å¼€\n * 2. å³é”®ç‚¹å‡»å›¾åƒè¿›è¡Œrenameï¼Œä¿®æ”¹å›¾åƒåç§°ä¸ºdonoræˆ–è€…receptorå¹¶ä¸”ä¿å­˜ä¸ºtif\n * 3. ä½¿ç”¨\"Process > Find Maxima...\"åŠŸèƒ½åˆ†åˆ«å¯¹donorå’Œrecoptorè¿›è¡Œé¢„è§ˆï¼Œè·å–åˆé€‚çš„ prominence å‚æ•°ï¼ˆhï¼‰\n * 4. åœ¨æ­¤è„šæœ¬ä¸­ä¿®æ”¹å¯¹åº”çš„ prominence å‚æ•°\n * 5. ç‚¹å‡»runè¿è¡Œæ­¤è„šæœ¬\n * 6. æ‰‹åŠ¨ä¿å­˜ç¨‹åºè®¡ç®—Resultsåˆ°csvæ–‡ä»¶\n * \n */\nrequires(\"1.53c\");\n\n// photon conversionå‚æ•°\nEM_Gain = 500;  // æ‹æ‘„æ—¶è®¾ç½®çš„å‚æ•°\nOffset = 204;  // ç›¸æœºå†…ç½®\nSensitivity = 16.9;  // ç›¸æœºå†…ç½®\nQE = 0.9;  //ç›¸æœºå†…ç½®ï¼Œä¹Ÿä¸è§å…‰æŸ“æ–™ç›¸å…³\n\n // åœ¨æ­¤ä¿®æ”¹donorå’Œreceptorçš„prominenceå‚æ•°\n h_donor = 250;\n h_receptor = 250;\n\n // è¿è¡Œä¸»ä½“è¿‡ç¨‹ ===\n donor = \"donor.tif\";\n receptor = \"receptor.tif\";\n selectWindow(receptor);\n selectWindow(donor);  \n// é€‰æ‹©çª—å£ï¼Œå¦‚æœæ²¡æœ‰renameä¼šæŠ¥é”™æç¤ºå¹¶ç»ˆæ­¢ç¨‹åº\n image_format = bitDepth();\n if image_format!=16{\n     showMessage(\"16-bit image required!\");\n }\n\n\n// ä¸‹é¢çš„æ–¹å¼æ›´åŠ æ–¹ä¾¿æ— éœ€å†é¢å¤–è‡ªå®šä¹‰å‡½æ•°\nselectWindow(donor);\nrun(\"Find Maxima...\", \"prominence=\"+h_donor+\" output=[Single Points]\");\nselectWindow(receptor);\nrun(\"Find Maxima...\", \"prominence=\"+h_receptor+\" output=[Single Points]\");\nrun(\"Merge Channels...\", \"c1=[\"+receptor+\" Maxima] c2=[\"+donor+\" Maxima] create\");\nrun(\"RGB Color\");\nrun(\"8-bit\");\n// å¯¹mergeä¹‹åçš„locationså†è¿›è¡Œfind maxima\nlocations = pFinder(10);  \nselectWindow(\"Composite\");\nclose();\nselectWindow(\"Composite (RGB)\");\nclose();\n\n\n N = lengthOf(locations)/2;\n for(i=0;i<N;i++){\n     x = locations[2*i];\n     y = locations[2*i+1];\n     selectWindow(donor);\n     value_donor = getPixel(x,y);\n     selectWindow(receptor);\n     value_receptor = getPixel(x,y);\n     ratio = (value_receptor)/(value_donor+value_receptor);  // è‡ªå®šä¹‰æ¯”å€¼è®¡ç®—å…¬å¼\n     n_donor = getPhotonNumber(value_donor, EM_Gain, Offset, Sensitivity, QE);\n     n_receptor = getPhotonNumber(value_receptor, EM_Gain, Offset, Sensitivity, QE);\n     n_ratio = n_receptor/(n_donor+n_receptor);  // è‡ªå®šä¹‰æ¯”å€¼è®¡ç®—å…¬å¼\n     setResult(\"X\", i, x);\n     setResult(\"Y\", i, y);\n     setResult(\"value_donor\", i, value_donor);\n     setResult(\"value_receptor\", i, value_receptor);\n     setResult(\"value_ratio\", i, ratio);\n     setResult(\"photon_num_donor\", i, n_donor);\n     setResult(\"photon_num_receptor\", i, n_receptor);\n     setResult(\"photon_num_ratio\", i, n_ratio);\n }\n updateResults();  //åˆ·æ–°Resultsçª—å£æ˜¾ç¤ºæ”¶é›†åˆ°çš„æ•°æ®\n selectWindow(\"Results\");   //è¯·è‡ªè¡Œä¿å­˜æ•°æ®è¡¨æ ¼\n\n// è‡ªå®šä¹‰å‡½æ•° ===\nfunction pFinder(h){\n    // find all particles by bultin ImageJ function and return their locations\n    run(\"Find Maxima...\", \"prominence=\"+h+\" strict output=[List]\");\n    selectWindow(\"Results\");\n    locs = newArray(2*nResults);\n    for(i=0;i<nResults;i++){\n        locs[2*i]=getResult(\"X\",i);\n        locs[2*i+1]=getResult(\"Y\",i);\n    }\n    run(\"Close\");\n    return locs;\n}\n\nfunction getPhotonNumber(value, EM_Gain, Offset, Sensitivity, QE){\n    // æ ¹æ®EMCCDçš„ç°åº¦å€¼è®¡ç®—å®é™…å…‰å­æ•°\n    p_number = (value-Offset)*Sensitivity/EM_Gain/QE;\n    return p_number;\n}\n```\n\n","categories":["ImageJ"]},{"title":"é›†æˆtyporaå’Œhexo","url":"/2021/01/10/GUIforLog/","content":"\næƒ³æ‰“é€ ä¸€ä¸ªå¼€æœºè‡ªå¯åŠ¨çš„å°å·¥å…·ï¼Œç„¶åæƒ³å†™ä¸€ç¯‡markdownç¬”è®°ï¼Œç›´æ¥createï¼Œå°±è‡ªåŠ¨åœ¨ç½‘ç«™çš„`_posts`ç›®å½•ä¸‹åˆ›å»ºå¥½æ–‡ä»¶ï¼Œå¹¶ä¸”è°ƒç”¨typoraæ‰“å¼€ã€‚\n\n### æŠŠtyporaåŠ å…¥åˆ°ç³»ç»Ÿç¯å¢ƒå˜é‡\n\n![image-20210109154449024](https://sheldon-notes.oss-cn-shanghai.aliyuncs.com/img/image-20210109154449024.png)\n\nå…ˆç”¨`Everything`æœç´¢ä¸€ä¸‹`typora.exe`æ‰€åœ¨çš„ä½ç½®\n\n![image-20210109154604826](https://sheldon-notes.oss-cn-shanghai.aliyuncs.com/img/image-20210109154604826.png)\n\nè®¾ç½®å¥½ä¹‹åï¼Œç›´æ¥åœ¨å‘½ä»¤è¡Œä¸­å°±è¾“å…¥`typora`å°±å¯ä»¥æ‰“å¼€è¿™ä¸ªç¨‹åºã€‚å¦‚æœtyporaåé¢è·Ÿäº†markdownæ–‡ä»¶è·¯å¾„ï¼Œå°±å¯ä»¥ç›´æ¥æ‰“å¼€è¿™ä¸ªæ–‡ä»¶ã€‚\n\n![image-20210109154824658](https://sheldon-notes.oss-cn-shanghai.aliyuncs.com/img/image-20210109154824658.png)\n\n### ä½¿ç”¨pythoné›†æˆè¿‡ç¨‹\n\né›†æˆè¿™ä¸€ç³»åˆ—è¿‡ç¨‹ï¼Œå°±æ˜¯æŠŠå„ç§å‘½ä»¤è¡Œæ“ä½œç®€åŒ–ä¸ºä¸€ä¸¤ä¸ªæŒ‰é’®ã€‚å…·ä½“ä»£ç å¦‚ä¸‹ï¼š\n\n```python\nimport os\nimport webbrowser\nimport PySimpleGUI as sg\nimport subprocess\n\nclass xxd:\n    '''\n    é›†æˆtyporaå’Œhexoçš„ä¸€ä¸ªå°å·¥å…·\n    å¯ä»¥å®ç°æœ¬åœ°è½»æ¾åˆ›å»ºmarkdown \n    ç„¶åè‡ªåŠ¨éƒ¨ç½²hexoç½‘ç«™\n    '''\n    def __init__(self, root_dir):\n        '''\n        root_dir: hexoç«™ç‚¹æ‰€åœ¨æ ¹ç›®å½•è·¯å¾„ \n        å¦‚ï¼š \"D:\\hexo\\blog\"\n        '''\n        self.dir = root_dir\n        # self.disk = self.dir[:2]  # å–ç›˜ç¬¦\n        self._posts = self.dir+'/source/_posts/'\n        self.p = []  # å­˜æ”¾å­è¿›ç¨‹\n        os.chdir(self.dir)\n    \n    def newPost(self, filename):\n        '''\n        filename: markdownæ–‡ä»¶åï¼Œ\n        è‹±æ–‡æˆ–æ•°å­—ç»„åˆ\n        '''\n        os.system(f'hexo new {filename}')\n        self.filepath = os.path.join(self._posts, filename+'.md')\n    \n    def typora(self):\n        '''\n        ç”¨typoraæ‰“å¼€æ–°å»ºçš„markdownæ–‡ä»¶\n        typora.exeéœ€è¦è¢«æ·»åŠ è¿›å…¥ç¯å¢ƒå˜é‡\n        '''\n        command = ['typora', self.filepath]\n        self.p.append(subprocess.Popen(command))\n    \n    def depoly(self):\n        os.system(f'hexo g && hexo d')\n\n\ndef the_gui(root_dir, site_url):\n    # åˆå§‹åŒ–wikiå¯¹è±¡\n    job = xxd(root_dir)\n\n    sg.theme('LightGrey3')\n    font = ('Arial', '11')\n\n    layout = [[sg.InputText(key='filename', size=(22, 1), font=('Arial', 16)),],\n              [sg.Button('Create', font=font), \n               sg.Button('Website', font=font), \n               sg.Button('Folder', font=font), \n               sg.Button('Depoly', font=font)],\n              ]\n    window = sg.Window('Log Tool', layout)\n\n    while True: \n        event, values = window.read()\n        if event is sg.WIN_CLOSED:\n            if len(job.p)>0:\n                for p in job.p:\n                    p.kill()\n            break\n        elif event == 'Create':\n            filename = values['filename']\n            if len(filename)>3:\n                job.newPost(filename)\n                job.typora()\n        elif event == 'Website':\n            webbrowser.open(site_url)\n        elif event == 'Folder':\n            os.startfile(job._posts)\n        elif event == 'Depoly':\n            job.depoly()\n    window.close()\n\nif __name__ == \"__main__\":\n    root_dir = r\"D:\\hexo\\blog\"\n    site_url = 'https://sheldonxxd.github.io/'\n    the_gui(root_dir, site_url)\n```\n\néœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæœ‰äº›å‘½ä»¤æˆ‘è°ƒç”¨çš„`os.system`ï¼Œæœ‰ä¸€äº›åˆ™ä½¿ç”¨çš„`subprocess.Popen`ï¼Œä¸»è¦æ˜¯é˜²æ­¢é˜»å¡ã€‚\n\nç„¶åç”¨æˆ·è¦è‡ªå·±å®šä¹‰å¥½ç½‘ç«™çš„root_dirï¼Œä»¥åŠsite_urlã€‚\n\n### ç”¨æˆ·ç•Œé¢æ•ˆæœ\n\néå¸¸ç®€å•çš„ç”šè‡³å¯ä»¥è¯´ä¸‘é™‹çš„ç”¨æˆ·ç•Œé¢ï¼š\n\n![image-20210110060145381](https://sheldon-notes.oss-cn-shanghai.aliyuncs.com/img/image-20210110060145381.png)\n\nä½¿ç”¨æ–¹æ³•éå¸¸ç®€å•ï¼š\n\n1. æ–‡æœ¬æ¡†ä¸­è¾“å…¥markdownçš„æ–‡ä»¶åfilenameï¼Œä¸ç”¨å¸¦åç¼€ï¼Œç„¶åç‚¹å‡»`Create`ï¼Œåå°å°±ä¼šæ‰§è¡Œ`hexo new filename`å‘½ä»¤ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„markdownï¼Œå¹¶è‡ªåŠ¨è°ƒç”¨typoraæ‰“å¼€è¿™ä¸ªæ–°å»ºçš„æ–‡æ¡£\n2. ç‚¹å‡»`Website`å¯ä»¥ç›´è¾¾ä½ çš„github pages\n3. ç‚¹å‡»`Folder`å¯ä»¥ç›´æ¥æ‰“å¼€`_posts`æ–‡ä»¶å¤¹ï¼Œæ–¹ä¾¿å¯¹ä¹‹å‰çš„markdownåšä¿®æ”¹\n4. ç‚¹å‡»`Depoly`ç›¸å½“äº`hexo g && hexo d`ï¼Œç”Ÿæˆæ–°çš„å†…å®¹å¹¶éƒ¨ç½²åˆ°github pages","tags":["gui","typora"],"categories":["python","blog"]},{"title":"äºŒå€¼åŒ–åºåˆ—é—´éš”é•¿åº¦ç»Ÿè®¡","url":"/2021/01/07/BinarySequenceIntervalCount/","content":"\nå‡å¦‚æœ‰ä¸€ä¸ªå¯¹è±¡ï¼Œèƒ½å¤Ÿéšæœºé—ªçƒå‘å…‰ï¼Œäº§ç”Ÿä¸€æ®µè„‰å†²ä¿¡å·è¢«æ£€æµ‹å™¨æ”¶é›†åˆ°ã€‚ç°åœ¨æŠŠä¿¡å·å¼ºåº¦åˆ†æˆhighå’Œlowä¸¤ç±»ï¼Œåˆ†åˆ«ç”¨1ï¼ˆONï¼‰å’Œ0ï¼ˆOFFï¼‰è¡¨ç¤ºã€‚æ¥ä¸‹æ¥éœ€è¦ç»Ÿè®¡åœ¨è¿™æ®µä¿¡å·åºåˆ—ä¸­ï¼Œ1å’Œ0æŒç»­ç‰‡æ®µçš„é•¿åº¦ã€‚è€Œä¸”è€ƒè™‘ä»ªå™¨å™ªå£°æ³¢åŠ¨ï¼Œéœ€è¦è®¾ç½®gapå‚æ•°ã€‚\n\n### æ ·æœ¬è¯´æ˜\n\næ¯”å¦‚å¯¹äºåºåˆ—`a`ï¼Œä¿¡å·ä½œå›¾æ˜¾ç¤ºå¦‚ä¸‹ï¼š\n\n![image-20210107121859054](https://sheldon-notes.oss-cn-shanghai.aliyuncs.com/img/image-20210107121859054.png)\n\nå…¶ä¿¡å·å€¼å¦‚ä¸‹ï¼š\n\n```\n0 0 0 0 0 1 0 1 1 1 0 0 0 0 1 1 0 0 0 0 0 0 1 1 1 0 0 1 1 1\n```\n\nå½“gap=0æ—¶ï¼Œè¿”å›å€¼ä¸ºï¼š\n\nON = [1, 3, 2, 3, 3]\n\nOFF = [5, 1, 4, 6, 2]\n\nå½“gap=1æ—¶ï¼Œè¿”å›å€¼ä¸ºï¼š\n\nON = [5, 2, 3, 3]\n\nOFF = [5, 4, 6, 2]\n\nâ€¦â€¦\n\næ£€éªŒç»“æœçš„æ—¶å€™ï¼ŒONå’ŒOFFæ±‚å’Œç­‰äºåºåˆ—çš„é•¿åº¦ï¼Œè€Œä¸”gap=1æ—¶ï¼ŒOFFä¸­ä¸ä¼šå‡ºç°å°äºç­‰äºgapçš„æ•°ã€‚\n\n### xxdçš„analyzeç®—æ³•\n\næ­¤ç®—æ³•éå¸¸ç®€å•ï¼Œä½†æ˜¯åªèƒ½ç»Ÿè®¡gap=0çš„æƒ…å†µã€‚\n\n```python\ndef analyze(labels):\n    '''\n    labelsæ˜¯ndarray, é‡Œé¢å¥½å¤šTrueå’ŒFasleå€¼\n    Trueä»£è¡¨ON, Falseä»£è¡¨OFF\n    å®ç°å¯¹çŠ¶æ€æŒç»­æ—¶é—´çš„ç»Ÿè®¡\n    '''\n    darks = []\n    ons = []\n    b, d = 0, 0\n    for idx, status in enumerate(labels):\n        if status>0:\n            b += 1\n            if d>0:\n                darks.append(d)\n            d = 0            \n        else:\n            d += 1\n            if b>0:\n                ons.append(b)\n            b = 0\n    ## å¾ªç¯ç»“æŸåæœ€åä¸€æ®µè¦è¿›è¡Œæ”¶é›†    \n    if d>0:\n        darks.append(d)\n    else:\n        ons.append(b)\n    # è¿”å›onæˆ–è€…dark timeçš„å‡å€¼\n    return ons, darks\n```\n\næµ‹è¯•ç»“æœå¦‚ä¸‹ï¼š\n\n![image-20210107122525529](https://sheldon-notes.oss-cn-shanghai.aliyuncs.com/img/image-20210107122525529.png)\n\n### hwjçš„bi_countç®—æ³•\n\næ­¤ç®—æ³•é€»è¾‘ç•¥ä¸ºå¤æ‚ï¼Œä½†æ˜¯èƒ½ç»Ÿè®¡gap>0çš„æƒ…å†µã€‚\n\n```python\ndef bi_count(a, gap=1):\n    '''\n    Author: Wenjuan HU\n    Date: 2021-01-07\n    '''\n    count_0, count_1 = 0, 0\n    list_0 = []\n    list_1 = []\n    for i in range(len(a)):\n        if a[i] == 0:\n            count_0 += 1\n            if count_0 > gap and count_1 >0 :\n                list_1.append(count_1)\n                count_1 = 0\n        elif a[i] == 1:\n            count_1 += 1\n            if count_0 > gap:\n                list_0.append(count_0)\n                count_0 = 0\n            else:\n                count_1 += count_0\n                count_0 = 0\n    if count_0 > gap:\n        list_0.append(count_0)\n    else:\n        list_1[-1] = list_1[-1]+count_0\n    if count_1 > 0:\n        list_1.append(count_1)\n    return list_0, list_1\n```\n\næµ‹è¯•ç»“æœå¦‚ä¸‹ï¼š\n\n![image-20210107122606314](https://sheldon-notes.oss-cn-shanghai.aliyuncs.com/img/image-20210107122606314.png)\n\n### å°ç»“\n\nè¿™æ˜¯ä¸€ä¸ªç¼–ç¨‹èƒ½åŠ›æµ‹è¯•çš„å¥½caseï¼Œåæ­£æˆ‘æ˜¯åšä¸å‡ºæ¥çš„å¼±é¸¡ï¼ˆif...elseä¸€å¤šå°±æ‡µé€¼ï¼‰ï¼Œæ‰€ä»¥å¿…é¡»å‘å¼ºå¤§çš„hwjå¥³å£«è‡´æ•¬ï¼ï¼ï¼","tags":["algorithm"],"categories":["python"]},{"title":"å®‰è£…å’Œè®¾ç½®HPç½‘ç»œæ‰“å°æœº","url":"/2021/01/06/installPrinter/","content":"\nå®éªŒå®¤æ‰“å°æœºè¿˜æ˜¯æœ‰çš„ï¼Œä¸è¿‡å¹³æ—¶æˆ‘ä¸»è¦åœ¨ç”µè„‘ä¸Šçœ‹æ–‡çŒ®ï¼Œæ‰€ä»¥ä½¿ç”¨çš„é¢‘ç‡éå¸¸ä½ã€‚æ°å·§ä»Šå¤©è¦æäº¤ä¸€äº›çº¸è´¨ææ–™ï¼Œä¸å¾—ä¸æ‰“å°å‡ºæ¥ã€‚ä¸€é—®ï¼Œå¤§å®¶éƒ½æ˜¯æŠ±ç€è‡ªå·±çš„ç¬”è®°æœ¬ç”µè„‘ï¼Œè·Ÿæ‰“å°æœºé€šè¿‡usbè¿æ¥å†æ‰“å°æ–‡ä»¶çš„ã€‚è€Œæˆ‘çš„ç”µè„‘åŒæ—¶è¿ç€ä¸¤ä¸ªç¡¬ç›˜ï¼Œå„ç§ç¨‹åºï¼ˆå¤„ç†ç¡¬ç›˜ä¸­çš„å®éªŒæ•°æ®ï¼‰å’Œæ–‡ä»¶éƒ½è¿˜æ‰“å¼€ç€ã€‚æ‰€ä»¥**æ¬ç”µè„‘**è¿™ç§äº‹æƒ…æˆ‘å¯å¹²ä¸æ¥ã€‚\n\nä¸ºäº†æ–¹ä¾¿è‡ªå·±æ–¹ä¾¿å¤§å®¶ï¼Œæˆ‘ä¾¿æŠŠæ‰“å°æœºè¿æ¥åˆ°äº†åŸºäºè‡ªå·±çš„è·¯ç”±å™¨æ¶è®¾çš„æ— çº¿å±€åŸŸç½‘ä¸­ï¼ˆprinteræ— æ³•è¿å•ä½çš„ä¼ä¸šWiFiï¼‰ã€‚ç„¶ååœ¨è·¯ç”±å™¨ä¸­è¿˜ç»™å®ƒåˆ†é…äº†å›ºå®šIPï¼š\n\n![image-20210106100103687](https://sheldon-notes.oss-cn-shanghai.aliyuncs.com/img/image-20210106100103687.png)\n\næ¥ä¸‹æ¥å°±æ˜¯ç»™è‡ªå·±çš„ç”µè„‘å®‰è£…é©±åŠ¨ï¼Œå¹¶ä¸”è¿æ¥è¿™å°ç½‘ç»œæ‰“å°æœºã€‚ä¸ºæ­¤ï¼Œæˆ‘è¿˜å†™äº†ä¸€ä¸ªæ•™ç¨‹ã€‚\n\n### å®‰è£…æ‰“å°æœºé©±åŠ¨\n\nå»ºè®®ä½¿ç”¨windowsç³»ç»Ÿï¼ŒmacOSæˆ–linuxéœ€è¦ä¸‹è½½å¯¹åº”çš„é©±åŠ¨ç¨‹åºã€‚\n\nå…ˆå®‰è£…ç‰ˆæœ¬å‹å·åŒ¹é…çš„æ‰“å°æœºé©±åŠ¨ï¼š\n\n![image-20210106083943008](https://sheldon-notes.oss-cn-shanghai.aliyuncs.com/img/image-20210106083943008.png)\n\nåœ¨å®‰è£…ç•Œé¢ä¸­ï¼Œéœ€è¦è¿æ¥åˆ°ç½‘ç»œæ‰“å°æœºï¼Œæˆ‘å·²ç»è®¾ç½®å¥½ç½‘ç»œï¼Œå¤§å®¶åŠ¡å¿…å…ˆè¿æ¥åˆ°`_gitlab_`è¿™ä¸ªWiFiï¼Œå¯†ç æ˜¯`fan123456`ã€‚**æ³¨æ„æ­¤WiFiä¸ºå±€åŸŸç½‘ï¼Œä¸èƒ½è®¿é—®å…¬ç½‘ï¼Œ**ä½†å¯ä»¥è®¿é—®å†…éƒ¨gitlabç½‘ç«™ï¼ˆhttp://192.168.0.80ï¼‰\n\n> å¤¹å¸¦äº†ç§è´§ã€‚gitlabæ˜¯æˆ‘æ¶è®¾åœ¨ä¸€å°ubuntuä¸»æœºä¸Šçš„ä¸œä¸œï¼Œæˆ‘è§‰å¾—å¯¹äºå®éªŒå®¤å†…éƒ¨è€Œè¨€ï¼Œæœ‰è¿™ä¹ˆä¸€ä¸ªååŒå’Œç‰ˆæœ¬æ§åˆ¶çš„å·¥å…·è¿˜è›®å¥½çš„ã€‚\n\n![image-20210106084204281](https://sheldon-notes.oss-cn-shanghai.aliyuncs.com/img/image-20210106084204281.png)\n\nç„¶ååœ¨é©±åŠ¨å®‰è£…ç•Œé¢è¾“å…¥æ‰“å°æœºçš„IPåœ°å€`192.168.0.188`\n\n![image-20210106084251923](https://sheldon-notes.oss-cn-shanghai.aliyuncs.com/img/image-20210106084251923.png)\n\né©¬ä¸Šå°±èƒ½æœç´¢åˆ°è¿™å°æ‰“å°æœºçš„ä¿¡æ¯ï¼Œç‚¹å‡»ä¸‹ä¸€æ­¥ç»§ç»­å®‰è£…å’Œé…ç½®ï¼ˆéœ€è¦ä¸€ç‚¹æ—¶é—´ï¼‰ã€‚\n\n![image-20210106084320075](https://sheldon-notes.oss-cn-shanghai.aliyuncs.com/img/image-20210106084320075.png)\n\næœ€åæ˜¾ç¤ºæ‰“å°æœºå®‰è£…æˆåŠŸç•Œé¢ï¼š\n\n![image-20210106084722170](https://sheldon-notes.oss-cn-shanghai.aliyuncs.com/img/image-20210106084722170.png)\n\nç›´æ¥ç‚¹å‡»`å®Œæˆ`ï¼Œå¹¶æ‰“å°æµ‹è¯•é¡µã€‚å¦‚æœæ²¡æœ‰æˆåŠŸï¼Œè¯·æ£€æŸ¥æ‚¨çš„ç³»ç»Ÿæ˜¯å¦è‡ªåŠ¨æ–­å¼€äº†æ²¡æœ‰ç½‘ç»œè¿æ¥çš„`_gitlab_`çš„WiFiã€‚\n\n### è®¾ç½®åŒé¢æ‰“å°\n\nå…·ä½“å‚è€ƒã€Š[æƒ æ™®æ‰“å°æœºåŒé¢æ‰“å°è‡ªåŠ¨å˜æ‰‹åŠ¨çš„è§£å†³åŠæ³•](https://www.jb51.net/hardware/other/313421.html)ã€‹ï¼Œå¯¹æ‰“å°æœºçš„å±æ€§è¿›è¡Œä¿®æ”¹ï¼š\n\n![image-20210106085902856](https://sheldon-notes.oss-cn-shanghai.aliyuncs.com/img/image-20210106085902856.png)\n\nç„¶åä¿®æ”¹æ‰“å°æœºé¦–é€‰é¡¹ï¼Œä¸ºäº†ç»æµç¯ä¿ï¼Œé»˜è®¤åŒé¢æ‰“å°ï¼š\n\n![image-20210106090109404](https://sheldon-notes.oss-cn-shanghai.aliyuncs.com/img/image-20210106090109404.png)\n\n### Wordæ–‡æ¡£æ‰“å°æ•ˆæœ\n\nç„¶åéšä¾¿æ‰“å°ä¸€ä¸ªwordæ–‡æ¡£ï¼ŒæŒ‰`Ctrl+P`ï¼Œå¯ä»¥çœ‹åˆ°æ‰“å°æœºé»˜è®¤é…ç½®å°±æ˜¯åŒé¢æ‰“å°äº†ï¼š\n\n![image-20210106090248311](https://sheldon-notes.oss-cn-shanghai.aliyuncs.com/img/image-20210106090248311.png)\n\n### å°ç»“\n\nç„¶åæˆ‘æŠŠæ•™ç¨‹å‘å¸ƒåˆ°å¾®ä¿¡ç¾¤ï¼Œè®©å¤§å®¶æ‰“å°ä¸œè¥¿èƒ½å¤Ÿæ–¹ä¾¿ä¸€ç‚¹ï¼Œè·å¾—ç‚¹èµä¸è®¡å…¶æ•°ï¼Œé‚£æˆ‘ä¹Ÿæ„Ÿè§‰è›®å¼€å¿ƒçš„ã€‚\n\n![image-20210106100712376](https://sheldon-notes.oss-cn-shanghai.aliyuncs.com/img/image-20210106100712376.png)\n\nå®‰è£…é…ç½®ç½‘ç»œæ‰“å°æœºè¿™ç§äº‹æƒ…ï¼Œå…¶å®éå¸¸ç®€å•ã€‚ä½†æ˜¯å®ƒèƒ½å¤ŸæœåŠ¡åˆ°çš„äººä¹Ÿæ˜¯æœ€å¤šçš„ã€‚è€Œæˆ‘å†™çš„å¯èƒ½è‡ªé¸£å¾—æ„çš„ä»£ç ï¼Œåå€’æ˜¯æ— äººé—®æ´¥æœ€å¤šæˆ‘è€å©†å–Š666ã€‚å½“ç„¶äº†æˆ‘ä¹Ÿå¹¶ä¸è¿½æ±‚å¤šäººé—®æ´¥ï¼Œèƒ½è‡ªé¸£å¾—æ„è‡ªå¨±è‡ªä¹ä¹Ÿæ˜¯ä¸é”™çš„ã€‚å…³é”®æ˜¯è¯´ä¸€å®šè¦æŠ“ä½çœŸæ­£çš„éœ€æ±‚ï¼ˆä¸ç®¡æ˜¯è‡ªå·±çš„è¿˜æ˜¯å®¢æˆ·çš„ï¼‰ï¼Œæ‰èƒ½åšå‡ºåˆ›é€ å¤§é‡ä»·å€¼çš„äº‹æƒ…ï¼Œä»è€Œè·å¾—æ»¡è¶³æ„Ÿå’Œå¹¸ç¦æ„Ÿã€‚","tags":["æ‰“å°æœº","éœ€æ±‚"],"categories":["blog"]},{"title":"è·å–ç›´æ–¹åˆ†å¸ƒæ˜¯å¦‚æ­¤çš„ç®€å•","url":"/2021/01/05/easy-histogram/","content":"\næŸ¥çœ‹ä¸€åˆ—æ•°æ®çš„ç›´æ–¹åˆ†å¸ƒæ˜¯ç»Ÿè®¡é‡Œè¾¹æœ€åŸºæœ¬çš„æ“ä½œäº†ï¼Œè¿‡å»æˆ‘å¸¸å¸¸ä½¿ç”¨seabornä½œç›´æ–¹åˆ†å¸ƒå›¾ï¼Œå®ƒä¼šè¿›è¡Œè‡ªåŠ¨çš„æ ¸å¯†åº¦ä¼°è®¡ï¼Œä½†æ˜¯æˆ‘å½“æˆ‘æƒ³æ‹¿åˆ°ä¸€ä¸ªç®€å•çš„histogramçš„æ•°æ®çš„æ—¶å€™ï¼Œå¸¸å¸¸è¿˜éœ€è¦è‡ªå·±ä½¿ç”¨`collections.Counter`å…ˆæ¥è®¡æ•°ä¸€ä¸‹ã€‚ç›´åˆ°ä»Šå¤©ï¼Œæˆ‘ä½¿ç”¨`plt.hist`å‘½ä»¤å·æ‡’ï¼Œå‘ç°äº†ä¸€äº›ç«¯å€ªï¼š\n\n![image-20210105192718893](https://sheldon-notes.oss-cn-shanghai.aliyuncs.com/img/image-20210105192718893.png)\n\næ³¨æ„ï¼Œjupyter notebook ä¸­outputçš„å†…å®¹ï¼Œé™¤äº†æœ‰figureä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªtupleï¼Œçœ‹ä¸Šå»`plt.hist`å‘½ä»¤å¯ä»¥è¿”å›ç›´æ–¹åˆ†å¸ƒæŸ±çŠ¶å›¾çš„ä½œå›¾æ•°æ®ã€‚å¦‚æœå‹¤å¿«ç‚¹åŠ ä¸Š`plt.show`ï¼Œå°±çœ‹ä¸åˆ°äº†ï¼š\n\n![image-20210105192912328](https://sheldon-notes.oss-cn-shanghai.aliyuncs.com/img/image-20210105192912328.png)\n\n### plt.histçš„è¿”å›å€¼å°±æ˜¯ç›´æ–¹åˆ†å¸ƒç»Ÿè®¡æ•°æ®\n\nä¸è¿‡æˆ‘è¿˜æ˜¯ç”¨ä¸€ä¸ªå˜é‡æ¥æ”¶äº†`plt.hist`å‘½ä»¤çš„è¿”å›ï¼Œè½»è€Œæ˜“ä¸¾å°±æ‹¿åˆ°äº†ç›´æ–¹åˆ†å¸ƒçš„ç»Ÿè®¡æ•°æ®ï¼Œåç»­è‡ªå·±æƒ³æ€ä¹ˆä½œå›¾å°±æ€ä¹ˆä½œå›¾ï¼š\n\n![image-20210105193018138](https://sheldon-notes.oss-cn-shanghai.aliyuncs.com/img/image-20210105193018138.png)\n\n### é€šè¿‡binså’Œrangeå‚æ•°æ§åˆ¶ç›´æ–¹åˆ†å¸ƒç»Ÿè®¡\n\nä¸è¿‡ä½ å¯èƒ½æ³¨æ„åˆ°ï¼Œç›´æ–¹åˆ†å¸ƒçš„åˆ†ç»„è¾¹ç•Œæ˜¯å‡Œä¹±çš„ã€‚è¿™ä¸ªæ—¶å€™å¯ä»¥é€šè¿‡è®¾ç½®binså’Œrangeå‚æ•°æ¥æ§åˆ¶ï¼š\n\n![image-20210105193503927](https://sheldon-notes.oss-cn-shanghai.aliyuncs.com/img/image-20210105193503927.png)\n\n### ç›´æ¥æŠŠé¢‘æ¬¡æ¢ç®—æˆåˆ†å¸ƒæ¦‚ç‡å¯†åº¦\n\né€šè¿‡`?plt.hist`å¯ä»¥åœ¨jupyter notebookä¸­å¿«é€ŸæŸ¥çœ‹è¯¥å‡½æ•°çš„æ–‡æ¡£ï¼Œç«‹é©¬å¾—çŸ¥å¯ä»¥é€šè¿‡densityè¿™ä¸ªå‚æ•°ï¼Œé€‰æ‹©è¾“å‡ºåˆ†å¸ƒå¯†åº¦ï¼Œç›¸å½“äºåšäº†ä¸€ä¸ªå½’ä¸€åŒ–ï¼Œä½¿å¾—ä¸åŒæ•°é‡çš„æ ·æœ¬ä¹‹é—´å…·å¤‡æ›´å¥½çš„å¯æ¯”æ€§ã€‚\n\n![image-20210105193937326](https://sheldon-notes.oss-cn-shanghai.aliyuncs.com/img/image-20210105193937326.png)\n\n### æŸ¥çœ‹ç´¯ç§¯é¢‘ç‡\n\n![image-20210105194511640](https://sheldon-notes.oss-cn-shanghai.aliyuncs.com/img/image-20210105194511640.png)\n\nåªè¦åœ¨å‚æ•°é‡Œè¾¹ä¿®æ”¹cumulativeä¸º`True`ï¼Œå°±å¯ä»¥è¾“å‡ºä¸€ä¸ªç´¯ç§¯é¢‘ç‡åˆ†å¸ƒã€‚è¿™æ¯”æˆ‘è¿™ä¸¤å¤©ç±»ä¼¼ç´¯æ´»å¯è¦è½»æ¾å¤šäº†ã€‚\n\n### ç»˜åˆ¶å¸•ç´¯æ‰˜å›¾\n\nç„¶åæˆ‘æƒ³æŠŠç´¯ç§¯é¢‘ç‡ç»˜åˆ¶æˆæŠ˜çº¿ï¼Œä¸‹è¾¹æ”¾åˆ†å¸ƒï¼Œç»“æœå¦‚ä¸‹ï¼š\n\n![image-20210105194913469](https://sheldon-notes.oss-cn-shanghai.aliyuncs.com/img/image-20210105194913469.png)\n\néœ€è¦æ³¨æ„çš„æ˜¯ï¼Œaæ˜¯å‰è¾¹`plt.hist`å‘½ä»¤çš„è¿”å›å€¼ï¼Œç´¢å¼•ä¸º1æ‰å¯¹åº”æ¨ªåæ ‡ï¼Œè€Œä¸”`len(a[1])` æ¯”` len(a[0])` å¤§ 1ï¼Œå› ä¸º`a[1]` å­˜æ”¾çš„æ˜¯è¾¹ç•Œï¼Œæ‰€ä»¥æˆ‘å¯¹è¿™ä¸ªarrayè¿›è¡Œäº†åˆ‡ç‰‡ï¼Œè€Œä¸”è¿˜ç§»ä½ã€‚\n\n### å°ç»“\n\næˆ‘å†ä¹Ÿä¸ç”¨Counteräº†ï¼Œå†ä¹Ÿä¸ç”¨dataframeçš„`.cumsum()`äº†ï¼Œä½¿ç”¨plt.histä¸èƒ½å†æ–¹ä¾¿ã€‚æ„Ÿè§‰åƒæ˜¯æ‰“é€šäº†ä»»ç£äºŒè„‰ã€‚matplotlibè¿™ä¸ªåº“ç¡®å®æ˜¯ğŸ‚ğŸºï¼","tags":["histogram","matplotlib"],"categories":["python"]},{"title":"æˆ‘ä¸ºä½•ä»ImageJè½¬å‘python","url":"/2021/01/05/myCodingHistory/","content":"\nImageJæ˜¯å­¦æœ¯ç•Œéå¸¸å¸¸ç”¨çš„å›¾åƒå¤„ç†è½¯ä»¶ã€‚å®ƒæ’ä»¶ä¸°å¯Œï¼ŒåŠŸèƒ½å¼ºå¤§ï¼Œä½“ç§¯å°å·§ï¼Œå¼€æºè·¨å¹³å°ï¼Œæˆ‘åœ¨è¯»åšå£«åˆšå¼€å§‹çš„æ—¶å€™ï¼Œä¸»è¦å°±æ˜¯ç”¨å®ƒè§£å†³ä¸€äº›æˆåƒæ•°æ®åˆ†æçš„é—®é¢˜ã€‚å¯æ˜¯åˆ°åæ¥ï¼Œéœ€è¦å¤„ç†çš„æ•°æ®é‡è¶Šæ¥è¶Šå¤§ï¼Œå¯¹è‡ªåŠ¨åŒ–çš„éœ€æ±‚è¶Šæ¥è¶Šé«˜ï¼ŒImageJçš„å®è¯­è¨€ï¼ˆMacro Languageï¼‰å·²ç»æ— æ³•æ»¡è¶³éœ€æ±‚ï¼Œæˆ‘ä¾¿é€æ­¥è¿ˆå…¥äº†pythonçš„æ·±å‘ã€‚ä¸‹é¢ä¸¾ä¸€ä¸ªä¾‹å­ï¼Œä½œä¸ºæˆ‘è¿™ç§è½¬å‹çš„è§è¯ã€‚\n\n### éœ€æ±‚\n\næœ‰ä¸€ä¸ªè§†é¢‘æ•°æ®ï¼ˆxytï¼‰ï¼Œæ¯ä¸€å¸§éƒ½æœ‰ä¸€äº›å•åˆ†å­è§å…‰ä¿¡å·ï¼Œéœ€è¦æå–å®ƒä»¬çš„ä½ç½®ï¼ˆxp, ypï¼‰ï¼Œç„¶åå†æå–è¯¥ä½ç½®çš„å¼ºåº¦æ—¶é—´æ›²çº¿è¿›è¡Œåˆ†æã€‚\n\n### ImageJ Macroçš„ä»£ç å®ç°\n\n```javascript\n/*\n * 2021-1-4\n * # batch find maxima and export the list\n */\n\n h = 750;  // å…ˆè‡ªè¡Œç”¨Find Maximaè°ƒèŠ‚å‚æ•°é¢„è§ˆä¸€ä¸‹ï¼Œé€‰æ‹©åˆé€‚çš„æ•°å€¼\n\n // æŠŠè®°å½•æ–‡ä»¶å­˜æ”¾å­ç›®å½•ä¸‹ï¼Œ\n // å¦‚æœå­æ–‡ä»¶å¤¹ä¸å­˜åœ¨ï¼Œåˆ›å»ºä¸€ä¸ª\n image= getTitle();\n imageName = split(image, \".\");\n fpath = getDirectory(\"image\")+imageName[0]+\"_frames/\";\n if (!File.exists(fpath)){\n \tFile.makeDirectory(fpath);\n }  \n \n N = nSlices;\n setBatchMode(\"hide\");  // ä½¿ç”¨batchmodeç¨å¾®å¿«ä¸€ç‚¹\n for (i = 0; i < N; i++) {\n \t// main(fpath, i);\n \tmain2(i);\n }\n setBatchMode(\"show\");\n\n roiManager(\"save\", fpath+\"RoiSet.zip\");\n // æŠŠroiç®¡ç†å™¨ä¸­çš„è®°å½•æ‰“åŒ…ä¿å­˜\n // åç»­å¯ä»¥ä½¿ç”¨pythonä¸­çš„read_roiæ¨¡å—è¿›è¡Œå¤„ç†\n\n function main(fpath, i){\n \t// å¯¹æ¯ä¸€å¸§è¿›è¡ŒFind Maximaå¤„ç†ï¼Œ\n \t// è¾“å‡ºListåˆ°Resultsçª—å£\n \t// æŠŠResultsçª—å£å†…å®¹ä¿å­˜ä¸ºcsvï¼Œå‘½åä¸ºframe/id.csv\n \tframeID = i+1;\n \tsetSlice(frameID);\n \trun(\"Find Maxima...\", \"prominence=750 output=List\");\n \tsaveAs(\"results\", fpath+frameID+\".csv\");\n// \tselectWindow(\"Results\");\n// \trun(\"Close\");\n//  ä¸ç”¨å…³ï¼Œæ¯æ¬¡éƒ½ä¼šåˆ·æ–°Resultsçª—å£\n }\n\n function main2(i){\n \t// å¯¹æ¯ä¸€å¸§è¿›è¡ŒFind Maximaå¤„ç†ï¼Œ\n \t// è¾“å‡ºListåˆ°Resultsçª—å£\n \t// æŠŠResultsçª—å£å†…å®¹ä¿å­˜ä¸ºcsvï¼Œå‘½åä¸ºframe/id.csv\n \tframeID = i+1;\n \tsetSlice(frameID);\n \trun(\"Find Maxima...\", \"prominence=750 output=[Point Selection]\");\n \troiManager(\"Add\");\n \t// ä½¿ç”¨ROIç®¡ç†å™¨ä¿å­˜æ•°æ®ï¼Œå‡å°‘IOï¼Œé€Ÿåº¦å¿«ä¸Šå¥½å‡ å€\n \trun(\"Select None\");\n }\n```\n\nä»¥ä¸Šä»£ç ï¼Œåªæ˜¯å¾ªç¯è°ƒç”¨ImageJè‡ªå¸¦çš„`Find_Maxima`åŠŸèƒ½ï¼Œåˆšå¼€å§‹æˆ‘æ˜¯æ‰“ç®—è¾“å‡ºåˆ°Resultsçª—å£ï¼Œç„¶åä¿å­˜æ¯ä¸€å¸§çš„ç»“æœåˆ°csvæ–‡ä»¶ï¼Œç»“æœå‘ç°è¿™æ ·å¤ªæ…¢äº†ï¼ˆå¤§æ¦‚9åˆ†é’Ÿï¼‰ã€‚åæ¥å†³å®šæŠŠç»“æœä¿å­˜åˆ°ROIç®¡ç†å™¨ï¼Œèƒ½å¤Ÿç¨å¾®åŠ é€Ÿä¸€ç‚¹ï¼ˆå¤§æ¦‚4åˆ†é’Ÿï¼‰ã€‚ä½†æ˜¯å³ä¾¿è¿™ä¹ˆå¤§æ®µçš„ä»£ç ï¼Œä¹Ÿåªä¸è¿‡å®ç°äº†ä½ç½®ä¿¡æ¯çš„æ”¶é›†ï¼Œè¿˜æ²¡åŠæ³•å®ç°å¼ºåº¦æ—¶é—´æ›²çº¿çš„æå–ã€æ•´ç†æ±‡æ€»å’Œå¯è§†åŒ–ã€‚è€Œä¸”ä¿å­˜ä¸ºroiï¼Œåç»­è¿˜å¾—`pip install read_roi`ï¼Œåˆ©ç”¨pythonè„šæœ¬è¿›è¡Œåç»­çš„å¤„ç†ã€‚\n\n### pythonçš„ä»£ç å®ç°\n\nä¸»è¦ä¾èµ–`skimage.io`å®ç°è§†é¢‘æ•°æ®çš„è¯»å–ï¼Œ`skimage.morphology.h_maxima`å®ç°**Find_Maxima**çš„åŠŸèƒ½ã€‚ä¸ºäº†å­¦ä¹ å†™ç±»ï¼Œæˆ‘æŠŠå‡ ä¸ªå¤§æ­¥éª¤éƒ½å†™æˆäº†ç±»ï¼š\n\n1. é¦–å…ˆæ˜¯è¯»å–æ•°æ®ï¼ŒsmFRET\n2. ç„¶åæ˜¯Find_Maximaï¼Œfinder\n3. æ¥ç€å°±æ˜¯è¦æŠŠæ‰¾åˆ°çš„maximaå¯¹åº”ä½ç½®çš„å¼ºåº¦æ—¶é—´æ›²çº¿æå–å‡ºæ¥ï¼Œæ‰€ä»¥æœ‰ä¸€ä¸ªextractor\n\n```python\nfrom skimage import io\nfrom skimage.morphology import h_maxima\nimport numpy as np\nimport matplotlib.pyplot as plt\n\nclass smFRET():\n    def __init__(self, filepath):\n        self.filepath = filepath\n        self.movie = io.imread(filepath, plugin='pil')\n        self.frames, self.width, self.height = self.movie.shape\n\n        \nclass finder(smFRET):\n    def __init__(self, filepath):\n        super(finder, self).__init__(filepath)\n    \n    def run(self, h):\n        '''\n        hè¿™ä¸ªå‚æ•°å¯ä»¥ä½¿ç”¨ImageJé¢„è§ˆmovieï¼Œç”¨`Find_Maxima`å‘½ä»¤è·å–\n        '''\n        self.maxima = []\n        # movieæ•´ä½“å¤ªå¤§ï¼Œä¸€æ¬¡æ€§å¤„ç†ä¼šå‡ºå†…å­˜é—®é¢˜ï¼Œæ‰€ä»¥æŒ‰å¸§æ‰«æ\n        for frame in self.movie:\n            self.maxima.append(h_maxima(frame, h))\n        self.maxima = np.array(self.maxima)\n        self.mapping = self.projection()\n    \n    def projection(self):\n        '''\n        åšä¸€ä¸ªzè½´çš„projection\n        '''\n        return self.maxima.sum(axis=0)\n\n    \nclass extractor(finder):\n    def __init__(self, filepath, h):\n        '''\n        filepath: tifè§†é¢‘æ–‡ä»¶è·¯å¾„\n        h: è¿™ä¸ªå‚æ•°å¯ä»¥ä½¿ç”¨ImageJé¢„è§ˆmovieï¼Œç”¨`Find_Maxima`å‘½ä»¤è·å–\n        '''\n        super(extractor, self).__init__(filepath)\n        self.run(h)\n        \n    def preview(self, vmax=100, vmin=4):\n        plt.imshow(self.mapping, vmax=vmax, vmin=vmin, cmap=\"jet\")\n        plt.colorbar()\n        plt.show()\n        \n    def threshold(self, vmax, vmin):\n        '''\n        æ ¹æ®find.mappingçš„é¢„è§ˆç»“æœè®¾å®švmaxå’Œvminä½œä¸ºthreshold\n        '''\n        # è¦è½¬åŒ–ä¸ºfloatæ‰èƒ½åšbroadcastè®¡ç®—\n        mm = self.mapping.astype(\"float32\")  \n        rows, cols = np.where((mm-vmin)*(mm-vmax)<=0)\n        self.locs = np.vstack([rows, cols]).T\n    \n    def choose(self, pid, show=False):\n        '''\n        pid: å•åˆ†å­ä¿¡å·çš„ç´¢å¼•ï¼Œä»0å¼€å§‹ï¼Œä¸å¤§äºself.locsçš„é•¿åº¦\n        '''\n        row, col = self.locs[pid]\n        line = self.movie[:, row, col]\n        labels = self.maxima[:, row, col]*line.ptp()/10+line.mean()\n        # æŠŠmaximaçš„labelä¹Ÿæå–å‡ºæ¥ï¼Œçœ‹çœ‹å•¥æƒ…å†µ\n        if show:\n            plt.plot(line)\n            plt.plot(labels, c='r')\n            plt.show()\n        return line, self.maxima[:, row, col]\n```\n\nä¸¥æ ¼æ¥è¯´ï¼Œæˆ‘è¿™ä»£ç å†™å¾—å¹¶ä¸æ¼‚äº®ï¼Œå› ä¸ºæˆ‘å¹³æ—¶å¾ˆå¤šæ—¶å€™éƒ½æ˜¯å†™é›¶æ•£çš„é¢å‘è¿‡ç¨‹çš„ä»£ç ï¼Œé¢å‘å¯¹è±¡å¹¶ä¸æ˜¯æˆ‘ç†Ÿæ‚‰çš„é¢†åŸŸã€‚ä¸è¿‡æˆ‘å–œæ¬¢ä¸€ä¸ªå¯¹è±¡å¯ä»¥ä¿ç•™å¾ˆå¤šæ•°æ®å’Œæ–¹æ³•ï¼Œè¿˜èƒ½å¤Ÿç»§æ‰¿çš„ç‰¹ç‚¹ã€‚æ‰€ä»¥åœ¨ä¸€äº›heavyçš„åœºåˆï¼Œæˆ‘ä¹Ÿä¼šä½¿ç”¨ã€‚è€Œä½¿ç”¨èµ·æ¥ä¹Ÿéå¸¸ç®€å•ï¼š\n\n```python\next = extractor(filepath, h=1000)\next.preview(vmax=100, vmin=4)\n# å¯ä»¥å…ˆçœ‹åˆ°å®šä½çš„ç»“æœï¼Œæ‰¾åˆ°åˆé€‚çš„vmaxå’Œvminä½œä¸ºåç»­çš„threshold\n```\n\n![image-20210105182125942](https://sheldon-notes.oss-cn-shanghai.aliyuncs.com/img/image-20210105182125942.png)\n\n```python\next.threshold(vmax=100, vmin=4)\nline,labels = ext.choose(30, show=True)\n```\n\n![image-20210105182112769](https://sheldon-notes.oss-cn-shanghai.aliyuncs.com/img/image-20210105182112769.png)\n\nä½¿ç”¨pythonä»£ç ï¼Œåªéœ€è¦1åˆ†40ç§’å°±å¯ä»¥å®Œæˆä»»åŠ¡ï¼ˆäº‹å®ä¸Šæ–‡ä»¶è¯»å–å’Œfinderè¿™ä¸¤éƒ¨åˆ†é‡‡å–å¤šè¿›ç¨‹å¤šçº¿ç¨‹ç”šè‡³numbaï¼Œè¿˜èƒ½å¤§å¹…æé€Ÿï¼‰ï¼Œè€Œä¸”æ‰€æœ‰æŠ½æå‡ºæ¥çš„åæ ‡ä¿¡æ¯éƒ½åœ¨extå¯¹è±¡ä¸­ä¿å­˜ç€ï¼Œæƒ³çœ‹å“ªä¸ªï¼Œå°±å¯ä»¥ä½¿ç”¨chooseçš„æ–¹æ³•å–å€¼å¹¶æŸ¥çœ‹å¼ºåº¦æ—¶é—´æ›²çº¿å’Œå¯¹åº”çš„labelã€‚\n\n### å°ç»“\n\nImageJçš„Macro Languageæ˜¯æˆ‘ç¬¬ä¸€ä¸ªæˆåŠŸåº”ç”¨å¹¶è§£å†³äº†ç§‘ç ”ä¸Šå®é™…é—®é¢˜çš„ç¼–ç¨‹è¯­è¨€ï¼Œè®©æˆ‘å°åˆ°äº†ä½¿ç”¨ç¼–ç¨‹æ¥é«˜æ•ˆè§£å†³ä¸€äº›laboriousçš„å›¾åƒæ•°æ®åˆ†æå·¥ä½œçš„ç”œå¤´ï¼ŒåŒæ—¶ä¹Ÿè®©æˆ‘æ ‘ç«‹äº†ä¸€äº›è‡ªä¿¡å¿ƒã€‚ä½†æ˜¯å®ƒæ¯•ç«Ÿè¿‡äºç®€å•ï¼Œéš¾ä»¥èƒœä»»æ›´å¤šæ›´å¤æ‚çš„ä»»åŠ¡ã€‚è™½ç„¶æˆ‘ç°åœ¨å·²ç»å¾ˆå°‘ä½¿ç”¨ImageJäº†ï¼Œä½†æ˜¯å¯¹å®ƒä»¥åŠèƒŒåæˆåƒä¸Šä¸‡çš„å¼€å‘è€…ï¼Œæˆ‘æŠ¥ä»¥å´‡é«˜çš„æ•¬æ„ã€‚","tags":["summary"],"categories":["python","ImageJ"]},{"title":"å•é¢—ç²’ç²’å­å…‰æ–‘çš„é«˜æ–¯æ‹Ÿåˆ","url":"/2021/01/05/GaussianFit-2D/","content":"\nåƒPALMã€STORMç­‰è¶…åˆ†è¾¨è§å…‰æˆåƒï¼Œéƒ½æ˜¯åŸºäºå•åˆ†å­å®šä½ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå•åˆ†å­çš„è§å…‰æˆåƒåœ¨xyå¹³é¢ä¸Šè¿‘ä¼¼é«˜æ–¯åˆ†å¸ƒï¼ˆæœ‰å…´è¶£å¯äº†è§£ç‚¹æ‰©æ•£å‡½æ•°ï¼‰ï¼Œå¯ä»¥ç”¨é«˜æ–¯æ‹Ÿåˆå¾—åˆ°å•åˆ†å­çš„ç²¾ç¡®å®šä½ä¿¡æ¯ï¼Œä»è€Œçªç ´å…‰å­¦è¡å°„æé™ã€‚è¿™é‡Œå°±å°è¯•ä½¿ç”¨pythonå¯¹äºŒç»´ç²’å­å…‰æ–‘å®ç°é«˜æ–¯æ‹Ÿåˆã€‚\n\n### ç²’å­å…‰æ–‘å›¾åƒ\n\n![image-20210105082931680](https://sheldon-notes.oss-cn-shanghai.aliyuncs.com/img/image-20210105082931680.png)\n\nå¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œæˆ‘æ¨¡æ‹Ÿäº†ä¸¤ä¸ªåœ†å½¢ç²’å­å…‰æ–‘ï¼Œå·¦è¾¹çš„ä¸­å¿ƒåæ ‡æ˜¯`(3, 3)`ï¼Œå³è¾¹çš„æ˜¯`(3.2, 2.9)`ï¼Œç›¸å½“äºæœ‰`0.22`ä¸ªåƒç´ çš„åç§»ï¼ˆè‹¥æ¯ä¸ªåƒç´ 160 nmï¼Œå®é™…åç§»çº¦35 nmï¼‰ï¼Œåæ˜ åœ¨ç²’å­å…‰æ–‘ä¸Šï¼Œå°±æ˜¯ç®­å¤´æ‰€æŒ‡çš„åƒç´ å—ç¨å¾®äº®åº¦æé«˜äº†ä¸€äº›ã€‚æœ‰äº†è¿™æ ·ä¸€ä¸ªç›´è§‚çš„æ„Ÿå—ï¼Œæ¥ä¸‹æ¥å°±çœ‹çœ‹å¦‚ä½•æ„é€ ä¸€ä¸ªé«˜æ–¯å…‰æ–‘ã€‚\n\n### äºŒç»´é«˜æ–¯å…‰æ–‘çš„æ„é€ \n\nä»£ç æˆ‘æ˜¯ç›´æ¥ä»[stackOverflow](https://stackoverflow.com/questions/21566379/fitting-a-2d-gaussian-function-using-scipy-optimize-curve-fit-valueerror-and-m)ä¸ŠæŠ„æ¥ï¼Œç¨å¾®å¢åŠ äº†ä¸€äº›æ³¨é‡Šï¼Œå…·ä½“å¦‚ä¸‹ï¼š\n\n```python\nimport numpy as np\n\ndef twoD_Gaussian(meshgrid, amplitude, xo, yo, sigma_x, sigma_y, theta, offset):\n    '''\n    meshgrid: åŒ…å«xå’Œyï¼Œèƒ½å¤Ÿè¡¨ç¤ºç½‘æ ¼æ‰€æœ‰çš„ç´¢å¼•(i,j)\n    xo, yo: é«˜æ–¯åˆ†å¸ƒçš„ä¸­å¿ƒä½ç½® \n    amplitude: é«˜æ–¯åˆ†å¸ƒçš„æœ€å¤§å¼ºåº¦\n    sigma_x, sigma_y: å½±å“é«˜æ–¯å…‰æ–‘çš„é•¿å®½\n    theta: æ§åˆ¶è§’åº¦ï¼Œå¦‚æœæ˜¯ä¸€ä¸ªæ¤­åœ†ï¼Œæ•°å€¼èŒƒå›´0-PI\n    offset: è¡¥å¿å€¼ï¼Œå¯ä»¥ä½¿æ‰€æœ‰çš„æ•°å€¼éƒ½æ˜¯æ­£æ•°\n    '''\n    x, y = meshgrid\n    xo = float(xo)\n    yo = float(yo)    \n    a = (np.cos(theta)**2)/(2*sigma_x**2) + (np.sin(theta)**2)/(2*sigma_y**2)\n    b = -(np.sin(2*theta))/(4*sigma_x**2) + (np.sin(2*theta))/(4*sigma_y**2)\n    c = (np.sin(theta)**2)/(2*sigma_x**2) + (np.cos(theta)**2)/(2*sigma_y**2)\n    g = offset + amplitude*np.exp( - (a*((x-xo)**2) + 2*b*(x-xo)*(y-yo) \n                            + c*((y-yo)**2)))\n    # æ³¨æ„è¿”å›å€¼æœ€å¥½è¦ravelï¼Œä¸ç„¶curve_fitä¼šæŠ¥é”™\n    return g.ravel()\n```\n\næœ‰äº†è¿™æ ·ä¸€ä¸ªæ ‡å‡†çš„æ„é€ å‡½æ•°ï¼Œæ¥ä¸‹æ¥å°±å¯ä»¥ä½¿ç”¨`curve_fit`å¯¹å·²æœ‰çš„æ•°æ®è¿›è¡Œæ‹Ÿåˆï¼Œåè¿‡æ¥ä¼°è®¡è¿™ä¸ªå‡½æ•°ä¸­ä¸€äº›å‚æ•°ï¼Œå…¶ä¸­å°±åŒ…æ‹¬é«˜æ–¯åˆ†å¸ƒä¸­å¿ƒçš„ä½ç½®`(xo, yo)`ã€‚\n\n### ç²’å­å…‰æ–‘çš„é«˜æ–¯æ‹Ÿåˆ\n\n```python\nfrom scipy.optimize import curve_fit\n\n# Create x and y indices\nx = np.linspace(0, 6, 7)\ny = np.linspace(0, 6, 7)\nx, y = np.meshgrid(x, y)  # meshgridç”Ÿæˆäº†ä¸€æ•´å¼ ç´¢å¼•map\n#create data\ndata = twoD_Gaussian((x, y), 10, 3, 3, 2, 2, 0, 10)\n# add some noise to the data and try to fit the data generated beforehand\ninitial_guess = (10, 3, 3, 2, 2, 0, 10)\ndata_noisy = data + 0.2*np.random.normal(size=data.shape)\n# æ–¹ä¾¿èµ·è§ï¼Œæ„é€ ä¸€ä¸ªå¸¦å™ªå£°çš„æ•°æ®\n\npopt, pcov = curve_fit(twoD_Gaussian, (x, y), data_noisy, p0=initial_guess) \n# éœ€è¦æ‹Ÿåˆçš„å‚æ•°ç›´æ¥å…¨éƒ¨å°±æ”¾åˆ°p0å»äº†\n```\n\nç„¶åæŸ¥çœ‹poptä¸­çš„ç»“æœï¼š\n\n![image-20210105084727546](https://sheldon-notes.oss-cn-shanghai.aliyuncs.com/img/image-20210105084727546.png)\n\nå¯ä»¥çœ‹åˆ°ï¼ŒåŠ å…¥å™ªå£°ååšé«˜æ–¯æ‹Ÿåˆï¼Œä¼°è®¡çš„å‚æ•°`xo = 3.249`ï¼Œ`yo = 2.916`ï¼Œè·Ÿå‰é¢`(3.2, 2.9)`åˆæœ‰å¾®å°çš„å·®å¼‚ï¼ˆå¤§æ¦‚5-8ä¸ª nmçš„åç§»ï¼‰ï¼Œæ‰€ä»¥è¯´ï¼Œå•åˆ†å­å®šä½ç²¾åº¦ç¦»ä¸å¼€éå¸¸å¥½çš„ä¿¡å·è´¨é‡ã€‚\n\n","tags":["gauss","fit"],"categories":["python"]},{"title":"ç´¯ç§¯åˆ†å¸ƒå‡½æ•°å’ŒSå‹æ›²çº¿æ‹Ÿåˆ","url":"/2021/01/04/cdf/","content":"\næŸ¥çœ‹æ•°æ®åˆ†å¸ƒæƒ…å†µï¼Œä»¥åŠä½¿ç”¨ç‰¹å®šçš„å‡½æ•°æ¨¡å‹å¯¹å·²è§‚æµ‹çš„æ•°æ®è¿›è¡Œæ‹Ÿåˆæ˜¯éå¸¸å¸¸è§çš„æ“ä½œã€‚è¿™é‡Œä»æ­£æ€åˆ†å¸ƒå…¥æ‰‹ï¼Œåˆ°åº”ç”¨**Logistic**æ¨¡å‹å®Œæˆç´¯ç§¯åˆ†å¸ƒæ›²çº¿çš„æ‹Ÿåˆï¼Œå¹¶æ ¹æ®æ‹Ÿåˆåæ¨¡å‹å‚æ•°é‡æ–°å¾—åˆ°æ ·æœ¬çš„å‡å€¼ã€‚\n\n### å¯¼å…¥ä¾èµ–åŒ…\n\næœ¬caseåœ¨jupyter notebookä¸­è¿è¡Œï¼Œå¯å…ˆå¯¼å…¥ä»¥ä¸‹åŒ…ï¼š\n\n```python\nimport os\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nimport pandas as pd\n%matplotlib inline\n%config InlineBackend.figure_format = 'svg'\n\nfrom collections import Counter\nfrom scipy.optimize import curve_fit\n```\n\n### åˆ¶ä½œæ­£æ€åˆ†å¸ƒæ•°æ®é›†\n\nå…ˆåˆ¶ä½œä¸€ä¸ªæ•°æ®é›†ï¼Œå‡å€¼è®¾ç½®ä¸º10ï¼Œå˜å¼‚åº¦ä¸º5ã€‚\n\n```python\nmu = 10\nsigma = 5\nX = mu + sigma*np.random.randn(1000)\n```\n\nç®€å•ä½œå›¾å¯ä»¥çœ‹åˆ°å¦‚ä¸‹çš„æ•°å€¼åˆ†å¸ƒï¼š\n\n![temp](https://sheldon-notes.oss-cn-shanghai.aliyuncs.com/img/temp.svg)\n\nå¦‚æœå°±Xæ•°æ®é›†ç›´æ¥è®¡ç®—å‡å€¼ï¼Œå‘ç°ä¸10è¿˜æ˜¯æœ‰ä¸€äº›å·®è·ï¼š\n\n![image-20210104191011726](https://sheldon-notes.oss-cn-shanghai.aliyuncs.com/img/image-20210104191011726.png)\n\n### è·å–åˆ†å¸ƒè®¡æ•°\n\nä¸»è¦ä½¿ç”¨`collections.Counter`å‡½æ•°ï¼š\n\n```python\na = Counter(X)\nb = dict(a)\nX2 = []\nfor key in b:\n    X2.append([key, b[key]])\nX2 = pd.DataFrame(X2, columns=['value', 'count'])\nX3 = X2.sort_values(by='value')\nX3['cum_count'] = X3['count'].cumsum()  # è®¡ç®—ç´¯ç§¯è®¡æ•°å€¼\nsns.lineplot(x='value', y='cum_count', data=X3)\nplt.show()\n```\n\n![temp2](https://sheldon-notes.oss-cn-shanghai.aliyuncs.com/img/temp2.svg)\n\n### é€‰å–æ¨¡å‹è¿›è¡Œæ›²çº¿æ‹Ÿåˆ\n\nè¿™é‡Œä¸»è¦åˆ©ç”¨`scipy.optimize.curve_fit`æ¥å®ç°æ›²çº¿æ‹Ÿåˆï¼Œéœ€è¦é€‰æ‹©åˆé€‚çš„å‡½æ•°æ¨¡å‹ã€‚å¯¹äºSå‹æ›²çº¿ï¼Œæ¯”è¾ƒå¸¸ç”¨çš„æ˜¯**Logistic**æ¨¡å‹ï¼Œå…³äºSå‹æ›²çº¿æ‹Ÿåˆï¼Œå¯ä»¥å‚è€ƒã€Š[è½»æ¾æ„å»ºå¤šç§æ¨¡å‹æ‹ŸåˆSå‹æ›²çº¿](https://zhuanlan.zhihu.com/p/147467845)ã€‹ã€‚\n\n```python\ndef func(x, a, b, c):\n    '''\n    ä½¿ç”¨Logisticæ¨¡å‹æ¥æ‹Ÿåˆ\n    è¯¥æ¨¡å‹æœ‰3ä¸ªå‚æ•°\n    å½“x=b/cæ—¶ï¼Œæ›²çº¿å¤„äºæ‹ç‚¹ï¼Œå¯ç”¨äºä¼°è®¡æ­£æ€åˆ†å¸ƒçš„å³°å€¼\n    https://zhuanlan.zhihu.com/p/147467845\n    '''\n    return a/(1+np.exp(b-c*x))\n\nparams = curve_fit(func, X3['value'], X3['cum_count'])\npopt, pcov = params\nprint(popt[1]/popt[2])\n```\n\n![image-20210104192236878](https://sheldon-notes.oss-cn-shanghai.aliyuncs.com/img/image-20210104192236878.png)\n\nå¯ä»¥çœ‹åˆ°æ‹ç‚¹å¯¹åº”çš„valueï¼Œè·Ÿæˆ‘ä»¬æœ€åˆè®¾ç½®çš„`mu=10`éå¸¸æ¥è¿‘äº†ã€‚\n\n### æŸ¥çœ‹æ‹Ÿåˆæ•ˆæœ\n\n```python\nX4 = [func(i, popt[0],popt[1],popt[2]) for i in X3['value']]\nX3['fit'] = X4\n\nsns.lineplot(x='value', y='cum_count', data=X3)\nsns.lineplot(x='value', y='fit', color='r', data=X3)\nplt.savefig(os.path.join(os.path.expanduser('~/Desktop/'), 'temp.svg'))\n```\n\n![temp3](https://sheldon-notes.oss-cn-shanghai.aliyuncs.com/img/temp3.svg)\n\n> æ³¨æ„ä¸€ä¸‹ï¼Œåé¢å¦‚æœå‘½åä¸´æ—¶æ–‡ä»¶ï¼Œç®€æ˜“å¸¦ä¸Šæ—¶é—´æˆ³ï¼Œä¸ç„¶å›¾åºŠä¼šè¦†ç›–ä¿å­˜ã€‚\n\n### å‚è€ƒé“¾æ¥\n\n1. [è½»æ¾æ„å»ºå¤šç§æ¨¡å‹æ‹ŸåˆSå‹æ›²çº¿](https://zhuanlan.zhihu.com/p/147467845)\n\n2. [Exponential Fit with Python](https://swharden.com/blog/2020-09-24-python-exponential-fit/)\n\n3. [ç´¯ç§¯åˆ†å¸ƒå‡½æ•°](https://baike.baidu.com/item/%E7%B4%AF%E7%A7%AF%E5%88%86%E5%B8%83%E5%87%BD%E6%95%B0)\n\n4. [python æ›²çº¿æ‹Ÿåˆ](https://blog.csdn.net/Fuxiu279/article/details/88429801)\n\n","tags":["curveFit","data","cumulative","distribution"],"categories":["python"]},{"title":"ä½¿ç”¨ImageJæå–æŸç‚¹çš„å¼ºåº¦æ—¶é—´æ›²çº¿","url":"/2020/12/30/getIntensityCurve/","content":"\næœ‰æ—¶å€™æ‹¿åˆ°åŸå§‹è§†é¢‘æ•°æ®(xyt)ä¹‹åï¼Œéœ€è¦åœ¨ImageJä¸­ç¨å¾®é¢„è§ˆä¸€ä¸‹ï¼Œäº†è§£å¤§æ¦‚æƒ…å†µã€‚å…¶ä¸­ä¸€ä¸ªé‡è¦çš„viewæ˜¯å¾—çœ‹ä¸€ä¸‹æŸä¸ªä½ç½®çš„ä¿¡å·çš„é—ªçƒæƒ…å†µï¼Œæ‰€ä»¥éœ€è¦æå–è¯¥ä½ç½®(x,y)çš„å¼ºåº¦éšæ—¶é—´å˜åŒ–çš„æ›²çº¿ã€‚ä¸ºäº†æ–¹ä¾¿ï¼Œæˆ‘å†™äº†ä¸€ä¸ªç®€å•çš„ImageJ Macroè„šæœ¬æ¥å®ç°æ­¤åŠŸèƒ½ã€‚è„šæœ¬è¿è¡Œåï¼Œç”¨æˆ·åœ¨å›¾åƒä¸Šç‚¹å‡»æŸä¸ªä½ç½®ï¼Œå°±ä¼šæŠŠè¯¥ä½ç½®ä¿å­˜åˆ°ROIç®¡ç†å™¨ï¼Œç„¶åæå–è¯¥ä½ç½®çš„Intensity(t)ï¼Œå¹¶ç»˜åˆ¶å›¾åƒã€‚\n\n### ä»£ç \n\nä»£ç çš„å‡ ä¸ªè¦æ³¨æ„çš„åœ°æ–¹ï¼š\n\n1. éœ€è¦è‡ªå®šä¹‰é€‰å–æ¡†çš„å¤§å°ï¼Œå¯¹äºå•åˆ†å­è§å…‰å…‰æ–‘ï¼Œ4å°±è¶³å¤Ÿäº†\n2. å¯ä»¥è®¾ç½®æ˜¯å¦å¤šæ¬¡é€‰å–ï¼Œå¦‚æœæ˜¯å¤šæ¬¡ï¼Œå°±é»˜è®¤é€‰å–3ä¸ªç‚¹\n3. æå–çš„intensityæ˜¯é€‰å–æ¡†çš„å‡å€¼ï¼Œè¿™æ ·èƒ½æœ‰æ•ˆæŠ‘åˆ¶èƒŒæ™¯å™ªå£°æ³¢åŠ¨\n\nåœ¨å®ç°ä¸Šï¼Œè¿™ä¸ªä»£ç è¿˜è¦è§£å†³ä»¥ä¸‹é—®é¢˜ï¼š\n\n1. ç›‘å¬å¹¶è¿”å›ç”¨æˆ·ç‚¹å‡»é¼ æ ‡äº‹ä»¶\n2. è‡ªåŠ¨åˆ‡æ¢Sliceï¼Œå³é€å¸§åŒxyåæ ‡å–å€¼\n\n\n```javascript\n/*\n * è¯¥è„šæœ¬é€‚ç”¨äºæ‰‹åŠ¨åˆ†æTIRFè§†é¢‘æ•°æ®ä¸­æŸç‚¹çš„å¼ºåº¦éšæ—¶é—´å˜åŒ–æƒ…å†µ\n * Author: Xiao-Dong Xie\n * 2020å¹´12æœˆ31æ—¥\n */\n\ntime_interval = Stack.getFrameInterval();  \n// å†…ç½®å‡½æ•°ï¼Œè·å–stackçš„å¸§æ—¶é—´é—´éš”ï¼Œé€‚ç”¨äºåŸå§‹TIRFæ•°æ®\nboxWidth = 4;\n// ç‚¹é€‰å–å€¼æ¡†å¤§å°\nmultiCheck = true; \n// å¦‚éœ€å¤šæ¬¡æ£€æŸ¥ï¼Œä¿®æ”¹æ­¤å¤„ä¸ºtrueï¼Œå¯å°†mainç½®å…¥forå¾ªç¯ä¸­\nmultiCheckNum = 3;\n\n// ================================================\nif (multiCheck) {\n\tfor (i = 0; i < multiCheckNum; i++) {\n\t\tmain(boxWidth, i); \n\t}\t\n}\nelse {\n\tmain(boxWidth, 0);\n}\n\n// =================================================\n\nfunction main(boxWidth, cid){\n\t/** ç‚¹å‡»stackä¸Šä¸€ä¸ªç‚¹ï¼Œè¿”å›time profile\n\t *  boxWidth: å…¨é€‰æ¡†å¤§å°\n\t *  cidï¼šé€‰ç‚¹çš„åºå·\n\t */\n\tloc = chooseParticle();\n\tx = loc[0];\n\ty = loc[1];\n\tmakePoint(x, y, \"small yellow hybrid\");\n\troiManager(\"add\"); // æŠŠè¯¥ç‚¹åŠ å…¥roiç®¡ç†å™¨\n\twait(300);\n\tn = getSliceNumber();\n\tlong = nSlices;\n\tv = newArray(long);\n\tt = newArray(long);\n\tfor (i = 0; i < long; i++) {\n\t\tsetSlice(i+1);\n\t\t// va = getPixel(x, y);\n\t\t// ç”¨å–å°åŒºåŸŸå‡å€¼çš„æ–¹å¼æ›´å¥½\n\t\tva = getRectRegionMeanValue(x, y, boxWidth);\n\t\tv[i] = va;\n\t\tt[i] = i*time_interval;\n\t}\n\tsetSlice(n);\n\tPlot.create(\"Time Profile \"+cid, \"Time (sec)\", \"Intensity\", t, v);\n\tPlot.show();\n}\n\nfunction chooseParticle(){\n    // é¼ æ ‡å•å‡»å›¾åƒä¸ŠæŸä¸ªç‚¹ï¼Œå³è¿”å›å…¶åæ ‡\n    leftButton = 16;\n    flags = 0;\n    while(flags&leftButton == 0) getCursorLoc(x,y,z,flags);\n    return newArray(x,y);\n}\n\nfunction getRectRegionMeanValue(x, y, width){\n\t//ä»¥(x,y)åæ ‡ä¸ºä¸­å¿ƒï¼Œè·å–è¾¹é•¿ä¸ºwidthçš„æ­£æ–¹å½¢åŒºåŸŸçš„å¹³å‡å¼ºåº¦\n\t// ä¸è¿”å›æœ€å¤§çš„å¼ºåº¦ï¼Œæ˜¯å› ä¸ºæ³¢åŠ¨æ¯”è¾ƒå¤§\n\tmakeRectangle(x-width/2, y-width/2, width, width);\n\tgetStatistics(area, mean, min, max, std, histogram);\n\treturn mean;\n}\n```\n\n### ç»“æœ\n\nä½¿ç”¨çš„æ—¶å€™ï¼ŒæŠŠè§†é¢‘æ•°æ®ï¼ˆtifæ ¼å¼ï¼‰æ‰“å¼€åï¼Œå†æŠŠ`getIntensityCurves.ijm`è„šæœ¬æ–‡ä»¶æ‹–å…¥Fijiæ‰“å¼€ï¼Œç„¶ååœ¨consoleä¸­ç‚¹å‡»`run`è¿è¡Œï¼Œç„¶ååœ¨è§†é¢‘å›¾åƒä¸Šé€‰å–ä½ æƒ³æå–æ•°å€¼çš„ç‚¹ã€‚ç»“æœå¦‚ä¸‹ï¼š\n\n![image-20201231082554717](https://sheldon-notes.oss-cn-shanghai.aliyuncs.com/img/image-20201231082554717.png)","tags":["TIRF"],"categories":["ImageJ"]},{"title":"å…è´¹ä¸‹è½½ç½‘æ˜“äº‘éŸ³ä¹mp3çš„å°å·¥å…·","url":"/2020/12/30/downloadCloudMusic/","content":"\nç›´æ¥ä¸Šä»£ç å§ï¼Œé€»è¾‘éå¸¸ç®€å•ï¼Œå°±æ˜¯ä»ç½‘æ˜“äº‘åˆ†äº«é“¾æ¥ä¸­æå–musicçš„IDï¼Œç„¶åæ„é€ å¤–é“¾ï¼š`http://music.163.com/song/media/outer/url?id={musicID}.mp3`ï¼Œå†ç›´æ¥ç”¨requestsæ¨¡å—è¯·æ±‚è¿™ä¸ªå¤–é“¾ï¼Œä¸‹è½½å†…å®¹ä¿å­˜ä¸ºmp3æ ¼å¼çš„æ–‡ä»¶å³å¯ã€‚ä¸ºäº†æ–¹ä¾¿å®ç”¨ï¼Œæˆ‘è¿˜åˆ©ç”¨`pySimpleGUI`åšäº†ä¸€ä¸ªéå¸¸ç®€æ˜“çš„ç”¨æˆ·ç•Œé¢ï¼Œæ–¹ä¾¿æ“ä½œã€‚\n\n```python\nimport requests\nimport re\nimport os\nimport PySimpleGUI as sg\n\ndef extractMusiceID(url):\n    pattern = re.compile(r'id=\\d+')\n    mID,uID = pattern.findall(url)\n    mID = mID.split(\"=\")[1]\n    uID = uID.split(\"=\")[1]\n    print(\"User:{}\\nMusic:{}\".format(uID,mID))\n    return mID\n\ndef downloadMusic(mID,name):\n    url = \"http://music.163.com/song/media/outer/url?id={}.mp3\".format(mID)\n    # éœ€è¦ä½¿ç”¨headerï¼Œä¸ç„¶urlé‡å®šå‘ä¹‹åæŠ“ä¸åˆ°\n    header = {'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/55.0.2883.87 Safari/537.36'}\n    r = requests.get(url,headers=header)\n    data = r.content\n    wks = os.path.expanduser(\"~/desktop\")  # é»˜è®¤ä¸‹è½½åˆ°æ¡Œé¢\n    fpath = os.path.join(wks,\"{}.mp3\".format(name))\n    with open(fpath,\"wb\") as f:\n        f.write(data)\n\ndef main(url,name):\n    mID = extractMusiceID(url)\n    downloadMusic(mID,name)\n\nif __name__ == \"__main__\":\n    \n    layout = [\n            [sg.Text(\"æ›²å\"),sg.Input(key='-Name-')],\n            [sg.Text(\"é“¾æ¥\"),sg.Input(key='-Url-')],\n            [sg.Button('Download'),sg.Exit()]\n            ]\n\n    window = sg.Window('ç½‘æ˜“äº‘éŸ³ä¹ä¸‹è½½', layout)\n\n    while True:\n        event, values = window.Read() \n        if event == 'Download':\n            name = values['-Name-']\n            url = values['-Url-']\n            main(url,name)\n        if event in (None, 'Exit'):      \n            break\n    window.Close()\n```\n\nè¿è¡Œä¹‹åï¼Œå¼¹å‡ºä¸€ä¸ªçª—å£ï¼Œå¡«å†™ä¸¤è¡Œä¿¡æ¯ï¼ŒDownloadå°±ä¼šæŠŠmp3ä¸‹è½½åˆ°æ¡Œé¢ï¼š\n\n![image-20201230122701166](https://sheldon-notes.oss-cn-shanghai.aliyuncs.com/img/image-20201230122701166.png)\n\nç„¶åè¾“å…¥æ­Œæ›²åå­—ï¼Œä»¥åŠåˆ†äº«é“¾æ¥ã€‚é“¾æ¥å¯ä»¥ä»ç½‘æ˜“äº‘éŸ³ä¹ä¸­è·å–ï¼š\n\n![image-20201230122626573](https://sheldon-notes.oss-cn-shanghai.aliyuncs.com/img/image-20201230122626573.png)\n\næ•ˆæœå¦‚ä¸‹ï¼š\n\n![image-20201230122805612](https://sheldon-notes.oss-cn-shanghai.aliyuncs.com/img/image-20201230122805612.png)\n\n### æ¥ä¸€é¦–ã€Šæ¢¦ä¼´ã€‹\n\n\n<iframe src=\"//player.bilibili.com/player.html?aid=23415950&bvid=BV1Kp411Z7ci&cid=39036220&page=1\" scrolling=\"no\" border=\"0\" frameborder=\"no\" framespacing=\"0\" allowfullscreen=\"true\" > </iframe>\n","tags":["gui","requests"],"categories":["python"]},{"title":"pandasæ¨¡å—å¸¸ç”¨åŠŸèƒ½å¤‡å¿˜å½•","url":"/2020/12/29/pandasUsageSummary/","content":"\nä½¿ç”¨pythonè¿›è¡Œæ•°æ®åˆ†æï¼Œç¦»ä¸å¼€`numpy`ï¼Œ`pandas`ï¼Œ`matplotlib`ä¸‰ä¸ªåŒ…ã€‚ä¸ºäº†ä½œå›¾å¥½çœ‹ï¼Œæˆ‘è¿˜å¸¸ç”¨`seaborn`ã€‚ä¸è¿‡`numpy`ä½¿ç”¨èµ·æ¥è¿˜æ˜¯æ²¡æœ‰pandasé‚£ä¹ˆçˆ½ï¼Œæ‰€ä»¥æˆ‘è¿˜æ˜¯ç”¨pandaså’Œseabornæœ€å¤šã€‚æ‰€ä»¥è¶ç€è¿˜æœ‰ä¸€ç‚¹å†™åšå®¢çš„çƒ­æƒ…ï¼Œå…ˆæ•´ç†ä¸€ä¸‹pandasçš„å¸¸ç”¨åŠŸèƒ½ã€‚\n\nå½“ç„¶äº†ï¼Œ ä»‹ç»æœ€è¯¦ç»†çš„è¿˜æ˜¯å®˜ç½‘æ–‡æ¡£ï¼š\n\nhttps://pandas.pydata.org/docs/\n\n### è¯»å–æ•°æ®\n\npandaså¯ä»¥è¯»å–å„ç±»æ•°æ®æ–‡ä»¶ï¼Œæ¯”å¦‚`csv`ã€`xlsx`ã€`hdf5`ç­‰ã€‚è€Œè¯»å–çš„å‘½ä»¤ä¸€èˆ¬è¾“å…¥`pd.read`ä»£ç è‡ªåŠ¨è¡¥å…¨æç¤ºå°±ä¼šå‡ºæ¥å¾ˆå¤šã€‚æˆ‘è¿™é‡Œä¹Ÿä¸å¤šè¯´ï¼Œæƒ³æŸ¥çœ‹ï¼Œå¯ä»¥è¾“å…¥ä¸€ä¸‹å‘½ä»¤ï¼š\n\n```python\nimport pandas as pd\nfor func in dir(pd):\n\tif func.startswith('read'):\n\t\tprint(func)\n```\n\nä½¿ç”¨æ–¹æ³•åŸºæœ¬ä¸Šéƒ½æ˜¯è¦è¾“å…¥filepathï¼Œç„¶å`pd.read_hdf`è¿˜éœ€è¦è¾“å…¥hdf5çš„datasetçš„keyåã€‚æˆ‘åœ¨å¤„ç†picassoäº§å‡ºçš„ä¸­é—´æ•°æ®æ—¶ï¼Œè¿˜ç»å¸¸ç”¨åˆ°ä»¥ä¸‹å‘½ä»¤ï¼š\n\n```python\ndef hdf2dataframe(filepath):\n    '''\n    åªé€‚ç”¨äºpicassoåˆ†æè¿‡ç¨‹ä¸­ç”Ÿæˆçš„hdf5æ–‡ä»¶æ•°æ®ç»“æ„\n    è¾“å‡ºä¸€ä¸ªå­—å…¸ï¼ŒåŒ…å«äº†ä¸åŒçš„dataframe\n    '''\n    data = {}\n    dataset = h5py.File(filepath, 'r')\n    for key in dataset.keys():\n        df = pd.DataFrame(dataset[key][()],dtype=\"float64\")  # æ³¨æ„æ•°æ®ç²¾åº¦\n        data[key] = df\n    return data\n```\n\nè¿™ä¸ªè‡ªå®šä¹‰å‡½æ•°å¯ä»¥æŠŠhdf5æ•°æ®ä¸­ä¸åŒçš„datasetè½¬åŒ–ä¸ºpandasçš„DataFrameï¼Œå¹¶ä¿å­˜åˆ°å­—å…¸ä¸­ã€‚ä½†äº‹å®ä¸Šå½“ä½ çŸ¥é“datasetçš„keyåå¾ˆå›ºå®šï¼ŒåŸºæœ¬éƒ½æ˜¯`locs`çš„æ—¶å€™ï¼Œåªéœ€è¦ä¸‹é¢ä¸€è¡Œå‘½ä»¤å°±å¯ä»¥äº†ï¼š\n\n```python\ndata = pd.read_hdf('cluster_filtered.hdf5','locs')\n```\n\n### ä¿å­˜æ•°æ®\n\nå¯¹äº`pd.DataFrame`å¯¹è±¡ï¼Œå¯ä»¥æŠŠæ•°æ®è¡¨ä¿å­˜åˆ°å„ç§æ ¼å¼çš„æ–‡ä»¶ä¸­ã€‚ä¸‹é¢ç®€å•ä¸¾å‡ ä¸ªä¾‹å­ï¼š\n\n```python\n# å‡è®¾dataæ˜¯ä¸€ä¸ªdataFrame\ndata.to_csv(filepath, index=None)  # ä¿å­˜ä¸ºcsvæ–‡ä»¶\ndata.to_excel(filepath, index=None)  # ä¿å­˜ä¸ºxlsxæ–‡ä»¶\ndata.to_pickle(filepath)  # ä¿å­˜ä¸ºpklæ–‡ä»¶\ndata.to_hdf(filepath, 'locs')  # ä¿å­˜ä¸ºhdf5æ–‡ä»¶\n```\n\nå…¶ä¸­csvå’Œxlsxæ–‡ä»¶éƒ½å¯ä»¥ä½¿ç”¨excelæ‰“å¼€ï¼Œæˆ‘ç»å¸¸ä½¿ç”¨ï¼Œä½†ä¸ºäº†é¿å…å¤šä½™çš„indexåˆ—ï¼Œæˆ‘é€šå¸¸ä¼šæŒ‡å®š`index=None`ã€‚å¤„ç†çš„ä¸­é—´æ•°æ®è‹¥éœ€è¦ä¿å­˜ï¼Œä½¿ç”¨pklæ–‡ä»¶æ˜¯æœ€æ–¹ä¾¿çš„ï¼Œæ²¡æœ‰å…¶ä»–å‚æ•°éœ€è¦å£°æ˜ã€‚ä¿å­˜ä¸ºhdf5æ–‡ä»¶è·Ÿæ‰“å¼€çš„æ—¶å€™ç±»ä¼¼ï¼Œè¿˜è¦å†™keyåã€‚\n\n### pd.DataFrameå¯¹è±¡\n\næ•°æ®å¸§æ˜¯pandasæœ€é‡è¦çš„æ¦‚å¿µï¼Œä¹Ÿæ˜¯æœ€å¸¸ç”¨çš„ä¸€ç§æ•°æ®ç»“æ„ã€‚ç®€å•æ¥è¯´ï¼Œå°±è·Ÿä½ åœ¨excelä¸­çœ‹åˆ°çš„è¡¨æ ¼ä¸€æ ·çš„ã€‚ä»å½¢çŠ¶ä¸Šè®²ï¼Œå°±æ˜¯ä¸€ä¸ªäºŒç»´çŸ©å½¢ã€‚\n\nä½¿ç”¨`pd.read_??`æ–¹æ³•è¯»å–æ•°æ®æ–‡ä»¶ï¼Œè¿”å›çš„åŸºæœ¬ä¸Šéƒ½æ˜¯æ•°æ®å¸§ï¼Œç„¶åä½ å°±å¯ä»¥è¿›è¡Œå„ç§æ„‰å¿«çš„æ“ä½œã€‚å½“ç„¶ä½ ä¹Ÿå¯ä»¥æŠŠç¨‹åºè¿è¡Œä¸­å…¶ä»–ç±»å‹çš„æ•°æ®è½¬åŒ–ä¸ºä¸€ä¸ªDataFrameï¼Œä¸‹é¢ä»‹ç»å‡ ç§æ–¹å¼ï¼š\n\n```python\nimport numpy as np\na = np.random.randint(10, size=(5,3))  # äº§ç”Ÿä¸€ä¸ª3x5çš„éšæœºæ•°çŸ©é˜µ\nb = pd.DataFrame(a, columns=list('abc'))  \n# æ•°æ®æœ‰5åˆ—ï¼Œå¿…é¡»ç»™columnåï¼Œ\n# indexåä¹Ÿå¯ä»¥æŒ‡å®šï¼Œè‹¥æ— åˆ™ä¼šé»˜è®¤ä»0å¼€å§‹\n```\n\nä»¥ä¸Šå°±æ˜¯ä»numpyäºŒç»´æ•°ç»„ç›´æ¥è½¬æˆæ•°æ®å¸§çš„æ“ä½œï¼Œå°±æ˜¯è¦æ³¨æ„columnsçš„å‘½åã€‚æ•ˆæœå¦‚ä¸‹ï¼š\n\n<img src=\"https://sheldon-notes.oss-cn-shanghai.aliyuncs.com/img/image-20201229201642898.png\" alt=\"image-20201229201642898\"  />\n\nå¦å¤–ä¹Ÿæœ‰ä¸€äº›æ›´å‚»ç“œçš„æ–¹æ³•ï¼š\n\n```python\na = pd.DataFrame()   # å¯ä»¥å…ˆåˆ›å»ºä¸€ä¸ªç©ºçš„æ•°æ®å¸§\na['a'] = [x for x in range(3)]\na['b'] = np.random.randint(10, size=(3,))\n```\n\nå…ˆåˆ›å»ºä¸€ä¸ªç©ºçš„æ•°æ®å¸§å¯¹è±¡ï¼Œç„¶åèµ‹å€¼ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œä½†æ˜¯è¦æ³¨æ„æ¯ä¸€ä¸ªcolumnçš„æ•°æ®é•¿åº¦è¦ä¸€è‡´ã€‚è¿™ä¸ªæ“ä½œæœ‰ç‚¹åƒå­—å…¸ã€‚æ²¡é”™ï¼Œä½ ä¹Ÿå¯ä»¥ç›´æ¥æŠŠå­—å…¸è½¬åŒ–ä¸ºæ•°æ®å¸§ï¼š\n\n```python\na = {'a':[1,2,3], 'b':[4,5,6]}\nb = pd.DataFrame(a)\n```\n\n### æ•°æ®å¸§çš„å–å€¼\n\n```python\na = np.random.randint(10, size=(3,5))  # äº§ç”Ÿä¸€ä¸ª5x3çš„éšæœºæ•°çŸ©é˜µ\nb = pd.DataFrame(a, columns=list('abcde'))  # æ•°æ®æœ‰ä¸‰åˆ—ï¼Œç»™columnå\nb.loc[0,'c']  # æ³¨æ„æ˜¯æ–¹æ‹¬å·ï¼Œç¬¬ä¸€ä¸ªæ˜¯index nameï¼Œ ç¬¬äºŒä¸ªæ˜¯columnåï¼Œè¿”å›å•ä¸ªå€¼\nb.iloc[0] # æ³¨æ„æ–¹æ‹¬å·ï¼Œè¿™é‡Œåªèƒ½è¾“å…¥indexåï¼Œè¿”å›ä¸€è¡Œæ•°æ®ï¼ˆpd.Seriesï¼‰\n```\n\nå¦‚ä¸Šæ‰€ç¤ºï¼Œæ•°æ®å¸§å°±æ˜¯ä¸€ä¸ªçŸ©é˜µï¼Œå–å€¼ç»™ç´¢å¼•å°±å¥½ï¼Œä¸è¿‡åœ¨æˆ‘çš„å®è·µè¿‡ç¨‹ä¸­ï¼Œå¾ˆå°‘ç›´æ¥å–æŸä¸ªç‰¹å®šä½ç½®çš„æ•°å€¼ã€‚éå†å€’æ˜¯å¸¸ç”¨ï¼Œä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸ºäº†åŠ å¿«é€Ÿåº¦ï¼Œå»ºè®®ä½¿ç”¨å¦‚ä¸‹çš„éå†æ–¹å¼ï¼š\n\n```python\nfor idx,row in df.iterrows():\n    # rowæ˜¯æ•°æ®å¸§çš„æŸä¸€è¡Œ\n    doSomeThingWith(row)\n```\n\n### æ•°æ®å¸§åˆ†ç»„\n\n```python\ngp =data.groupby(by=['column_name_1', 'column_name_2'])\n```\n\nä¸€èˆ¬åˆ†ç»„å®Œäº†ï¼Œè¿˜å¯ä»¥éå†åˆ†ç»„ï¼Œåšä¸€äº›æ“ä½œï¼š\n\n```python\nfor key, df in gp:\n    # key æ˜¯åˆ†ç»„æ•°æ®å¯¹åº” column_name_1', 'column_name_2' è¿™ä¸¤åˆ—çš„å€¼\n    # df æ˜¯åˆ†ç»„çš„å­æ•°æ®å¸§\n    doSomeThingWith(df)\n```\n\n### æ•°æ®ç­›é€‰\n\n```python\ndata2 = data.filter(items=['column_1', 'column_2'])\n# ç±»ä¼¼çš„è¿˜æœ‰ä¸€ä¸ªdropæ–¹æ³•\n```\n\nä¸Šè¿°ä»£ç å¯ä»¥ä»dataåŸæ•°æ®å¸§ä¸­å–å‡ºä¸¤åˆ—å€¼ã€‚\n\n```python\nlabel = [0,2,3]\nregion_new = region[region['Cluster'].isin(labels)]  \n```\n\nä¸Šè¿°ä»£ç å¯ä»¥æŒ‰`Cluster`è¿™ä¸€åˆ—çš„å€¼è¿›è¡Œç­›é€‰ï¼Œå¦‚æœå€¼å­˜åœ¨äºlabelåˆ—è¡¨ä¸­ï¼Œåˆ™è¢«æå–å‡ºæ¥ã€‚\n\n```python\ndf = localization[(localization['x']>(x-radii))&\\\n                 (localization['x']<(x+radii))&\\\n                 (localization['y']>(y-radii))&\\\n                 (localization['y']<(y+radii))]\n```\n\nä¸Šè¿°ä»£ç æ ¹æ®æ•°æ®å¸§ä¸­çš„æ•°å€¼æŒ‡å®šèŒƒå›´è¿›è¡Œç­›é€‰ï¼Œæ³¨æ„æ–¹æ‹¬å·ï¼Œç„¶åå¤šä¸ªåˆ¤æ–­æ¡ä»¶çš„å¸ƒå°”è¿ç®—è¦ç”¨å°æ‹¬å·ã€‚\n\n### æ•°æ®æ’åº\n\n`data.sort_values(by=??)`ï¼Œå¶å°”ä¼šç”¨ã€‚\n\n### æ•°æ®ç¿»è½¬\n\n`data.T`\n\næŠŠrowå’Œcolumnç¿»è½¬ä¸€ä¸‹ï¼Œå¶å°”ä¼šç”¨ã€‚\n\n### æ•°æ®åˆå¹¶\n\n`pd.concat([df1, df2])`\n\næŠŠä¸€äº›ç¬¦åˆæ¡ä»¶çš„DataFrameåˆå¹¶ï¼Œæ³¨æ„å‰ææ˜¯å®ƒä»¬å…·æœ‰ç›¸åŒçš„columnï¼Œç„¶åå¯ä»¥æ”¾åˆ°ä¸€ä¸ªåˆ—è¡¨é‡Œé¢ã€‚\n\nä¸‹é¢è¿˜æä¾›ä¸€ä¸ªä¾‹å­ï¼Œæ€ä¹ˆæŠŠserieså åŠ åšæˆæ•°æ®å¸§ã€‚\n\n```python\na = pd.Series([1,2,3], index=list('abc'))  # åºåˆ—\nb = pd.Series([4,5,6], index=list('abc')) \nc = pd.concat([a,b]) # çºµå‘å åŠ series\nd = pd.concat([a,b], axis=1) # æ¨ªå‘å åŠ \ne = d.T # ç¿»è½¬\n```\n\n### æ•°æ®èåŒ–\n\n`pd.melt`\n\nå¯ä»¥æŠŠæ–°å»ºä¸€ä¸ªcolumnï¼ŒæŠŠå…¶ä¸­æŸäº›columnè½¬æˆæ–°çš„columnçš„valueï¼Œä¹Ÿéå¸¸å®ç”¨ï¼Œåœ¨seabornä½œå›¾çš„æ—¶å€™ï¼Œç”¨åˆ°è¿‡ä¸€äº›ã€‚\n\n### éšæœºé‡‡æ ·\n\n`data.sample([n, frac, ...])`\n\nå¯ä»¥æŒ‡å®šéšæœºè¿”å›çš„æ•°é‡ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šæ¯”ä¾‹ã€‚åŠ å…¥dataçš„é•¿åº¦æ˜¯1000ï¼Œn<1000, fracåœ¨0-1ä¹‹é—´å–å°æ•°ã€‚\n\n### åè®°\n\nå†™åˆ°è¿™é‡Œï¼Œæƒ³å†™ç‚¹ä»€ä¹ˆçš„å†²åŠ¨æ¶ˆé€€ï¼Œæƒ³æƒ³æˆ‘åˆå¹²äº†ä¸€ä»¶è ¢äº‹ã€‚ä»€ä¹ˆæ¨¡å—ä»€ä¹ˆåŠŸèƒ½ç‰¹åˆ«æ˜¯å…·ä½“åˆ°å“ªä¸ªå‡½æ•°çš„ç”¨æ³•ï¼ŒçœŸçš„ä¸è¦å»è¯•å›¾è®°å¿†ç”šè‡³æ±‡æ€»å®ƒä»¬ã€‚å¦‚æœä½ ç”¨çš„åˆ«äººçš„ï¼Œè¯·æŸ¥çœ‹ä»–ä»¬çš„æ–‡æ¡£ã€‚å¦‚æœæ˜¯ä½ è‡ªå·±å†™çš„ï¼Œè¯·è‡ªå·±å†™å¥½æ–‡æ¡£ã€‚è®©è¿™äº›ç”µå­è®°å½•æˆä¸ºä½ çš„â€œç¬¬äºŒå¤§è„‘â€ï¼Œè¿™ä¸å°±æ˜¯æˆ‘çš„åˆå¿ƒä¹ˆï¼Ÿæ‰€ä»¥åƒè¿™ç§äº‹æƒ…ï¼Œåªæœ‰è¿™ä¸€æ¬¡ï¼Œä»¥åçš„æ¯ä¸€ç¯‡åšæ–‡ï¼Œéƒ½è¦å¯¹åº”æˆ‘è‡ªå·±åœ¨æ•°æ®åˆ†ææˆ–è€…æ—¥å¸¸ç”Ÿæ´»ä¸­é‡åˆ°çš„å…·ä½“çš„å¯ä»¥ç”¨ç¼–ç¨‹çš„æ–¹å¼è§£å†³çš„é—®é¢˜ã€‚","tags":["pandas"],"categories":["python"]},{"title":"åŸºäºpythonçš„DNAå®šé‡æµ“åº¦è®¡ç®—å™¨","url":"/2020/12/29/oligoCalculator/","content":"\n### èµ·å› \n\nä½¿ç”¨ç¦»çº¿çš„OligoCalculatoråªèƒ½ä¸€ä¸ªä¸ªåºåˆ—æ‹·è´è¿›å»ç„¶åè¾“å…¥A260çš„å€¼ï¼Œå†è®¡ç®—ã€‚è¿™æ ·åšå¤ªç¹çäº†ï¼Œå¦‚æœæ•°é‡æ¯”è¾ƒå°‘è¿˜å¥½ã€‚ä½†å¦‚æœä¸€æ¬¡æ€§æµ‹å®šæ¯”è¾ƒå¤šçš„é“¾ï¼Œå¾ˆå®¹æ˜“å¤åˆ¶å‡ºé”™ã€‚æ‰€ä»¥æˆ‘åœ¨ã€Š[åŸºäºç´«å¤–å¯è§å…‰å¸æ”¶å…‰è°±çš„DNAåˆ†å­å®šé‡](https://sheldonxxd.github.io/2020/12/28/basicUVspectrumAnalysis/index.html)ã€‹æ–‡ç« çš„åŸºç¡€ä¹‹ä¸Šï¼Œè¿›ä¸€æ­¥å‚ç…§[Thermoçš„è¯´æ˜](https://www.sigmaaldrich.com/china-mainland/technical-documents/articles/biology/quantitation-of-oligos.html)å†™äº†ä¸€ä¸ªèƒ½å¤Ÿæ‰¹é‡è‡ªåŠ¨æ ¹æ®å¸å…‰åº¦è®¡ç®—æ ·å“æµ“åº¦çš„pythonç‰ˆæœ¬çš„oligo calculatorã€‚\n\n> è¦æ’å…¥è‡ªå·±ä¹‹å‰çš„æ–‡ç« çš„urlï¼Œè®°å¾—åŠ ä¸Šindex.htmlï¼Œä¸ç„¶æ— æ³•è·³è½¬è¶…é“¾æ¥ã€‚\n\n### è¾“å…¥\n\n![image-20201229100558994](https://sheldon-notes.oss-cn-shanghai.aliyuncs.com/img/image-20201229100558994.png)\n\næ³¨æ„è¿™ä¸ªè¡¨æ ¼æ–‡ä»¶å‰é¢ä¸‰åˆ—éƒ½æ˜¯ã€ŠåŸºäºç´«å¤–å¯è§å…‰å¸æ”¶å…‰è°±çš„DNAåˆ†å­å®šé‡ã€‹æ–‡ç« ä¸­ä»£ç å¤„ç†åç”Ÿæˆçš„ï¼Œè€ŒLabelã€Sequenceã€Moduficationä»¥åŠDiluteRatioéœ€è¦è‡ªå·±è¡¥å……ã€‚æ‹¿åˆ°äº†è¿™æ ·ä¸€å¼ è¡¨ä¹‹åï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„è¡¨è¿›è¡Œè®¡ç®—ã€‚\n\n### ä»£ç \n\n```python\nimport pandas as pd\n\ndef getNearestBaseCombination(seq):\n    n = len(seq)\n    data = []\n    for i in range(n-1):\n        data.append(seq[i:i+2])\n    return data\n\ndef getRepeatSingleBase(seq):\n    return list(seq[1:-1])\n\ndef getMolarConc(Abs, Seq, Length=1):\n    '''\n    === è¾“å…¥å‚æ•° ===\n    Abs: Floatï¼Œæµ‹å®šUV-Viså¸æ”¶å…‰è°±çš„å³°å€¼ï¼Œä¸€èˆ¬ä¸ºA260\n    Seq: Stringï¼Œå¯¡æ ¸è‹·é…¸æ ·å“çš„åºåˆ— \n    Length: Floatï¼Œå…‰ç¨‹ï¼Œä¸€èˆ¬ä¸º1 cm\n    === è¿”å›å€¼ ===\n    E_seq: å•çº¯è®¡ç®—åºåˆ—è·å¾—çš„æ¶ˆå…‰ç³»æ•°ï¼Œå¦‚æœ‰ä¿®é¥°åŸºå›¢ï¼Œè¯·åˆ°IDTä¸ŠæŸ¥è¯¢å…¶æ¶ˆå…‰ç³»æ•°ååšæµ“åº¦æ ¡æ­£\n    Conc: Float, æµ‹å®šæ ·å“çš„æ‘©å°”æµ“åº¦ï¼Œä»¥uMï¼ˆumol/Lï¼‰ä¸ºå•ä½\n    å¦‚è¦è·å–åŸæ¶²æ ·å“ï¼Œå¯è‡ªè¡Œä¹˜ä»¥ç¨€é‡Šå€æ•°\n    '''\n    e = {'A':15400, 'C':7400, 'G':11500, 'T':8700, \n        'AA':27400, 'AC':21200, 'AG':25000, 'AT':22800,\n        'CA':21200, 'CC':14600, 'CG':18000, 'CT':15200,\n        'GA':25200, 'GC':17600, 'GG':21600, 'GT':20000,\n        'TA':23400, 'TC':16200, 'TG':19000, 'TT':16800}\n    \n    # æ¶ˆå…‰ç³»æ•°è¡¨æ ¼ï¼Œ å‚è€ƒé“¾æ¥å¦‚ä¸‹\n    # https://www.sigmaaldrich.com/china-mainland/technical-documents/articles/biology/quantitation-of-oligos.html\n    cut = getNearestBaseCombination(Seq)\n    repeat = getRepeatSingleBase(Seq)\n    E_seq = 0\n    for c in cut:\n        E_seq += e[c]\n    for r in repeat:\n        E_seq -= e[r]\n    # Eçš„å•ä½æ˜¯L â‹… mol-1 â‹… cm-1\n    Conc = Abs/(E_seq*Length)*1e6\n    # Concçš„å•ä½æ˜¯ uM\n    return E_seq,Conc\n\ndef main(filepath):\n    '''\n    filepathï¼šè¾“å…¥æ±‡æ€»è¡¨æ ¼æ–‡ä»¶è·¯å¾„\n    è¡¨æ ¼ä¸­å¿…é¡»åŒ…å«æ ·å“çš„å¸å…‰å€¼ï¼ˆPeakValueï¼‰,åºåˆ—ï¼ˆSequenceï¼‰å’Œç¨€é‡Šå€æ•°(DiluteRatio)ä¸‰åˆ—ä¿¡æ¯\n    å»ºè®®åœ¨`extractUVspectrum.py`ç”Ÿæˆçš„excelæ–‡ä»¶ä¸­è¡¥å……åºåˆ—å’Œç¨€é‡Šå€æ•°å³å¯\n    è®¡ç®—å®Œæˆåï¼Œåœ¨è¡¨æ ¼ä¸­æ–°å¢æ¶ˆå…‰ç³»æ•°å’ŒåŸæ¶²æµ“åº¦ä¸¤åˆ—ä¿¡æ¯\n    '''\n    data = pd.read_excel(filepath)\n    concs = []\n    Es = []\n    for idx, row in data.iterrows():\n        e,c = getMolarConc(row['PeakValue'], row['Sequence'])\n        c = c*row['DiluteRatio']\n        concs.append(c)\n        Es.append(e)\n    data['E(Lâ‹…mol-1â‹…cm-1)'] = Es\n    data['Conc(uM)'] = concs\n    data.to_excel(filepath, index=None)\n    print('æµ“åº¦è®¡ç®—å®Œæˆï¼Œå·²åˆ·æ–°è¡¨æ ¼æ•°æ®ï¼')\n\nif __name__ == \"__main__\":\n    filepath = \"/path/to/ssDNAå®šé‡ç»“æœ.xlsx\"\n    main(filepath)\n```\n\n### ç»“æœ\n\n![image-20201229100438254](https://sheldon-notes.oss-cn-shanghai.aliyuncs.com/img/image-20201229100438254.png)\n\nè®¡ç®—å®Œæˆåï¼Œæ–°å‡ºç°äº†ä¸¤åˆ—æ•°æ®ï¼Œåˆ†åˆ«æ˜¯ä¸åŒæ ·æœ¬æ‰€å¯¹åº”çš„æ¶ˆå…‰ç³»æ•°å’Œç¨€é‡Šå‰åŸæ¶²çš„æµ“åº¦ã€‚éœ€è¦æ³¨æ„ï¼Œ**å¦‚æœæœ‰ä¿®é¥°ï¼Œè‡ªè¡Œåˆ°[IDTæŸ¥è¯¢ä¿®é¥°åŸºå›¢çš„æ¶ˆå…‰ç³»æ•°](https://sg.idtdna.com/site/Catalog/Modifications)ï¼Œè·Ÿæ­¤è¡¨ä¸­çš„æ¶ˆå…‰ç³»æ•°ç›¸åŠ ï¼Œç„¶åæ ¹æ®ç…å‹ƒæ¯”å°”å®šå¾‹å¯¹æµ“åº¦è¿›è¡Œæ ¡æ­£**ã€‚\n\n![image-20201229103945287](https://sheldon-notes.oss-cn-shanghai.aliyuncs.com/img/image-20201229103945287.png)\n\nå¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œåœ¨excelè¡¨æ ¼ä¸­è¿›è¡Œæ“ä½œå³å¯ï¼Œæœ€åå¾—åˆ°æœ€ç»ˆçš„å‡†ç¡®çš„å®šé‡æµ“åº¦ç»“æœã€‚","tags":["DNA","calculator"],"categories":["python"]},{"title":"åŸºäºç´«å¤–å¯è§å…‰å¸æ”¶å…‰è°±çš„DNAåˆ†å­å®šé‡","url":"/2020/12/28/basicUVspectrumAnalysis/","content":"\næˆ‘ä»¬å®éªŒå®¤é‡‡é›†UV-Viså¸æ”¶å…‰è°±ï¼Œåªèƒ½ä¸€ä¸ªä¸€ä¸ªæ ·å“åœ°æ¥ã€‚æœ‰æ—¶å€™æˆ‘è¦å¯¹å‡ åæ¡DNAå•é“¾åšå®šé‡çš„æ—¶å€™ï¼Œä¸€ä¸ªä¸ªå»è®°å½• A_260nm çš„æ•°å€¼æ¯”è¾ƒçƒ¦ï¼ˆè€Œä¸”æœ‰æ—¶å€™å³°å€¼ä¼šæœ‰å¾®å¼±æ¼‚ç§»ï¼‰ï¼Œæ‰€ä»¥æ‰“ç®—ç”¨pythonå†™ä¸ªå°å·¥å…·æ¥å®ç°å³°å€¼çš„æå–ã€‚\n\n### æ•°æ®æ–‡ä»¶åˆ†æ\n\né€šè¿‡ä»ªå™¨é…å¥—è½¯ä»¶å¯ä»¥å¯¼å‡ºcsvæ–‡ä»¶ï¼Œå‘½åæ ¼å¼æ˜¯`Sample??.æ ·å“.csv`ã€‚\n\n![image-20201228134634805](https://sheldon-notes.oss-cn-shanghai.aliyuncs.com/img/image-20201228134634805.png)\n\nä½†æ˜¯csvæ–‡ä»¶å†…æ•°æ®æ¯”è¾ƒè„ï¼Œå…·ä½“å¦‚ä¸‹ï¼š\n\n![image-20201228134427947](https://sheldon-notes.oss-cn-shanghai.aliyuncs.com/img/image-20201228134427947.png)\n\nç¬¬ä¸€è¡Œå’Œæœ€åä¸€è¡Œéƒ½ä¸æ˜¯æ­£ç»çš„å†…å®¹ï¼Œè€Œç¬¬äºŒè¡Œçš„column nameä¹Ÿå¾ˆéšæ„ï¼Œæ‰€ä»¥åé¢åœ¨ä½¿ç”¨pandasæ¨¡å—è¯»å–csvæ–‡ä»¶çš„æ—¶å€™è¦åšä¸€äº›å¤„ç†ã€‚\n\n### å®Œæ•´ä»£ç \n\nè¦å®ç°åŠŸèƒ½é™¤äº†å¾—æ­£ç¡®è¯»å–æ•°æ®ä¹‹å¤–ï¼Œè¿˜æœ‰ä»¥ä¸‹å‡ ä¸ªè¦ç‚¹ï¼š\n\n1. ä½¿ç”¨globæ”¶é›†csvæ–‡ä»¶ï¼ˆåˆ—è¡¨é¡ºåºæœªå¿…ç­‰åŒäºä¸Šæ ·é¡ºåºï¼‰\n2. æå–sampleçš„IDï¼ˆå¯¹åº”ç€ä½ æµ‹å®šæ ·å“çš„é¡ºåºï¼‰\n3. ä½¿ç”¨`np.argmax`è·å–å³°å€¼æ‰€åœ¨åºåˆ—çš„ç´¢å¼•ï¼Œç„¶åå–å³°å€¼\n4. æ ¹æ®sampleIDå¯¹æ•°æ®è¿›è¡Œæ’åº\n\nå…·ä½“ä»£ç å¦‚ä¸‹ï¼š\n\n```python\nimport os, glob\nimport numpy as np\nimport pandas as pd\nimport re\n\ndef exportMaxPeak(wks):\n    '''\n    è¾“å…¥åŒ…å«UVå¸æ”¶å…‰è°±å¯¼å‡ºcsvæ–‡ä»¶çš„è·¯å¾„\n    è¾“å‡ºA260nmçš„å³°å€¼æ•°æ®è¡¨excelåˆ°ç›®å½•ä¸‹\n    æ³¨æ„ä¸è¦å¯¼å‡ºblankçš„å…‰è°±\n    '''\n    files = glob.glob(os.path.join(wks,'*.csv'))\n    data = []\n    pattern = 'Sample(\\d+).æ ·å“.csv'\n    for f in files:\n        # å¤„ç†æ–‡ä»¶åæå–ID\n        _, fname = os.path.split(f)\n        # è¯»å–å…‰è°±æ•°æ®\n        label = re.search(pattern, fname)\n        sid = label.group(1) # ç›´æ¥æå–æ•°å­—\n        sid = float(sid)\n        df = pd.read_csv(f, header=1)\n        mid = np.argmax(df[\"A\"])\n        max_wav = df[\"nm\"][mid]\n        max_OD = df[\"A\"][mid]\n        # æ”¶é›†æ•°æ®åˆ°åˆ—è¡¨\n        data.append([int(sid), max_wav, max_OD])\n    # å¤„ç†æ•°æ®è¡¨æ ¼\n    data = pd.DataFrame(data, columns=[\"Sample\",\"Wavelength\", \"PeakValue\"])\n    data.sort_values(by='Sample', inplace=True)  # æ’åº\n    data_path = os.path.join(wks,\"A260-Max.xlsx\")\n    data.to_excel(data_path, index=False)\n    print(\"æ•°æ®å·²ä¿å­˜åˆ°{}!\".format(data_path))\n\nif __name__=='__main__':\n    # ä¿®æ”¹å˜é‡wksçš„å€¼ä¸ºä½ å­˜æ”¾æ•°æ®çš„ç›®å½•\n    wks = r'D:\\Lab\\Data\\UV-Vis\\20201228'\n    exportMaxPeak(wks)\n```\n\n### å¤„ç†æ•ˆæœ\n\n![image-20201228135130971](https://sheldon-notes.oss-cn-shanghai.aliyuncs.com/img/image-20201228135130971.png)\n\nç„¶åå†åŸºäºç”Ÿæˆçš„è¿™ä¸ªæ±‡æ€»è¡¨ï¼ŒæŠŠå®é™…sampleçš„lableä»¥åŠåºåˆ—å¡«å†™ä¸Šå»ï¼Œå†ä½¿ç”¨`Oligo Calculator`å³å¯è®¡ç®—å‡ºæ¥æ ·å“çš„æµ“åº¦äº†ã€‚\n\n![image-20201228135309897](https://sheldon-notes.oss-cn-shanghai.aliyuncs.com/img/image-20201228135309897.png)\n\n### ä½¿ç”¨OligoCalculatorå·¥å…·\n\n![image-20201228131109199](https://sheldon-notes.oss-cn-shanghai.aliyuncs.com/img/image-20201228131109199.png)\n\nOligoCalculatorå·¥å…·[ç‚¹æ­¤é“¾æ¥](https://sheldon-notes.oss-cn-shanghai.aliyuncs.com/img/Oligo%20caculator.exe)ä¸‹è½½ã€‚\n\næŠŠåºåˆ—è¾“å…¥è¿›å»ï¼ˆæ³¨æ„å»é™¤ä¸€äº›ä¿®é¥°ï¼‰ï¼Œç„¶åè¾“å…¥ç´«å¤–æµ‹å¾—çš„A260å³°å€¼ï¼Œç‚¹å‡»`Caculate`å³å¯è®¡ç®—ã€‚","tags":["spectrum","DNA"],"categories":["python"]},{"title":"æ­å»ºé˜¿é‡Œäº‘OSSå›¾åºŠ","url":"/2020/12/27/mergeAllNotes/","content":"\næˆ‘çš„ç¬”è®°å¾ˆå¤šä¸œè¥¿éƒ½æ¯”è¾ƒé›¶ç¢ï¼Œè¿™æ ·ä¸é€‚åˆæ„å»ºä¸€ä¸ªæ¯”è¾ƒå®Œæ•´æœ‰åºçš„ç¬”è®°ç³»ç»Ÿï¼ˆç¬¬äºŒå¤§è„‘ï¼‰ã€‚è‡ªä»ä¸Šæ‰‹äº†github-pagesä¹‹åï¼Œå†³å®šå…¨é¢è½¬å‘markdown+githubï¼Œè¿™æ ·å¯ä»¥åˆ°å¤„è®¿é—®æŸ¥çœ‹ï¼Œä¸ºäº†è§£å†³æ’å›¾æ–‡ä»¶å¤§å°é—®é¢˜ï¼Œè¿˜ç‰¹åœ°è´­ä¹°äº†é˜¿é‡Œäº‘çš„å¯¹è±¡å­˜å‚¨æœåŠ¡ã€‚ä¸€ç³»åˆ—çš„æ“ä½œä¸»è¦å‚è€ƒã€Š[ã€Typoraã€‘typora+picgo+é˜¿é‡Œäº‘ossæ­å»ºå›¾åºŠ](https://www.cnblogs.com/myworld7/p/13132549.html)ã€‹ã€‚\n\n### è´­ä¹°é˜¿é‡Œäº‘OSSå¹¶é…ç½®å›¾åºŠ\n\nå¯ä»¥ç›´æ¥æœç´¢[åŒ…æœˆçš„å¥—é¤](https://common-buy.aliyun.com/?spm=5176.7933691.1309819..68b22a66FQKm7f&commodityCode=ossbag&request=%7B%22region%22%3A%22china-common%22%7D#/buy)ï¼š\n\n![image-20201227162121971](https://sheldon-notes.oss-cn-shanghai.aliyuncs.com/img/image-20201227162121971.png)\n\næˆ‘é€‰æ‹©çš„æ˜¯40GBï¼Œå¤§é™†é€šç”¨ï¼Œä¸¤å¹´ã€‚è´­ä¹°ä¹‹åè¿›å…¥æ§åˆ¶å°æ–°å»ºä¸€ä¸ªbucketï¼ˆæ°´æ¡¶ï¼‰ã€‚\n\n![image-20201227161929457](https://sheldon-notes.oss-cn-shanghai.aliyuncs.com/img/image-20201227161929457.png)\n\næ³¨æ„æƒé™è®¾ç½®ä¸ºå…¬å…±å¯è¯»ï¼Œä¸ç„¶ä¸Šä¼ å‘å¸ƒåˆ°github-pagesä¸Šå°±çœ‹ä¸åˆ°äº†ã€‚\n\n### ä¸‹è½½å’Œé…ç½®picgo\n\ntyporaæ”¯æŒpicgoå›¾åºŠä¸Šä¼ å·¥å…·ï¼Œç›´æ¥åˆ°githubä¸Šä¸‹è½½æœ€æ–°ç‰ˆæœ¬\n\nhttps://github.com/Molunerfinn/PicGo/releases\n\næŠŠé˜¿é‡Œäº‘çš„Access Keyä»¥åŠå…¶ä»–ä¿¡æ¯å¤åˆ¶å¡«å…¥é…ç½®é€‰é¡¹å³å¯ï¼š\n\n![image-20201227161730671](https://sheldon-notes.oss-cn-shanghai.aliyuncs.com/img/image-20201227161730671.png)\n\n### é…ç½®typora\n\n![image-20201227161535243](https://sheldon-notes.oss-cn-shanghai.aliyuncs.com/img/image-20201227161535243.png)\n\nåˆ°è¿™ä¸€æ­¥ï¼Œå°±å¯ä»¥å¼€å¿ƒçš„åœ¨æœ¬åœ°ä½¿ç”¨typoraå†™markdownï¼Œæˆªå›¾ä½¿ç”¨`snipaste`ï¼Œç›´æ¥å¤åˆ¶ç²˜è´´è¿‡æ¥å°±å¼€å§‹ä¸Šä¼ åˆ°è‡ªå·±çš„å›¾åºŠã€‚ä¸è¿‡ç¬¬ä¸€å¼ å›¾ç‰‡ä¼šå…ˆæ‰“å¼€picgoç¨‹åºï¼Œæ‰€ä»¥ç¨å¾®æ…¢ä¸€ç‚¹ã€‚\n\n> æƒ³æƒ³æˆ‘ä¹‹å‰è¿˜å†™äº†ä¸€ä¸ªpythonè„šæœ¬ç¼©å°å›¾ç‰‡å¤§å°ï¼Œç°åœ¨å®Œå…¨æ²¡æœ‰è¿™ä¸ªå¿…è¦äº†ï¼Œå•Šå“ˆå“ˆå“ˆå“ˆï¼","tags":["å›¾åºŠ"],"categories":["blog"]},{"title":"ä½¿ç”¨pythonæå–txtæ–‡æœ¬ä¸­å…³é”®ä¿¡æ¯å¹¶æ±‡æ€»åˆ°è¡¨æ ¼","url":"/2020/12/26/collectFilesUsingPython/","content":"\nä½¿ç”¨pythonå¤„ç†æ–‡ä»¶ã€æ–‡ä»¶å¤¹å’Œè·¯å¾„ä¹‹ç±»çš„äº‹æƒ…ï¼Œä¸»è¦æ˜¯ç”¨åˆ°`os`ã€`glob`ã€`re`å’Œ`shutil`ç­‰æ¨¡å—ã€‚\n\n### æ‰¹é‡åˆ›å»ºå­ç›®å½•\n\nåœ¨å¤„ç†æ•°æ®çš„æ—¶å€™ï¼Œä¸å¯é¿å…åœ°ä¼šæ¶‰åŠåˆ°å„ç§æ–‡ä»¶çš„æ‰¹é‡å¤„ç†ã€‚æ¯”å¦‚æˆ‘åœ¨å¤„ç†å’Œåˆ†ææ•°æ®çš„æ—¶å€™ï¼Œéœ€è¦æ ¹æ®å•ä¸ªåŸå§‹æ•°æ®åˆ›å»ºå­ç›®å½•ç”¨äºå­˜æ”¾åç»­åˆ†æäº§ç”Ÿçš„å„ç§ä¸­é—´æ•°æ®ã€‚æ‰€ä»¥æˆ‘å†™äº†ä¸‹é¢è¿™æ®µä»£ç ï¼š\n\n```python\nimport os\nfrom glob import glob\n\ndef makeSubdirectory(wks):\n    '''\n    wks: æŸæ¬¡DNA-PAINTå®éªŒå­˜æ”¾lifæ–‡ä»¶çš„ç›®å½•\n    æ­¤ç¨‹åºä¼šå¯¹lifæ–‡ä»¶è‡ªåŠ¨æ–°å»ºåŒåå­ç›®å½•\n    '''\n    lifs = glob(os.path.join(wks, \"*.lif\"))\n    for lif in lifs:\n        filepath, ext = os.path.splitext(lif)  \n        # åˆ†ç¦»æ–‡ä»¶çš„æ‹“å±•åå’Œå…¶ä»–è·¯å¾„ï¼Œæ¯”å­—ç¬¦ä¸²split('.')æ›´å®‰å…¨\n        try:\n            os.mkdir(filepath+'/')\n        except:\n            print('Subdirectory Existed! -- %s'%(filepath))\n    print('Job Finished!')\n\nif __name__ == \"__main__\":\n    wks = r\"E:\\xxd\\TIRF-LeicaDMi8\\20201221\" \n    makeSubdirectory(wks)\n```\n\néœ€è¦æ³¨æ„çš„æ˜¯ï¼š\n\n1. `os.mkdir`å‘½ä»¤å¦‚æœæ˜¯è·¯å¾„å·²ç»å­˜åœ¨å°±ä¼šæŠ¥é”™\n2. globä¸­å¯ä»¥ä½¿ç”¨`*`ä½œä¸ºé€šé…ç¬¦åŒ¹é…æ‰€æœ‰åç¼€ä¸º`lif`çš„åŸå§‹æ•°æ®æ–‡ä»¶ï¼Œè¿”å›ä¸€ä¸ªlist\n3. `os.path.splitext`å¯ä»¥æŠŠæ–‡ä»¶è·¯å¾„çš„åç¼€è·Ÿåå­—åˆ†å¼€\n4. `try ... except ...` å¯ä»¥æœ‰æ•ˆå¤„ç†ç¨‹åºè¿è¡Œä¸­çš„å¼‚å¸¸æƒ…å†µ\n\n### ä»txtæ–‡ä»¶ä¸­æ”¶é›†å›¾åƒå‚æ•°\n\nlifæ–‡ä»¶æ˜¯leicaæ˜¾å¾®é•œäº§ç”Ÿçš„æ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨ImageJæ‰“å¼€ï¼Œç„¶åä¿å­˜ä¸ºtifï¼Œæ–¹ä¾¿åé¢çš„å¤„ç†ã€‚æ­¤æ—¶ï¼Œå›¾åƒçš„ä¸€äº›ç›¸å…³ä¿¡æ¯å¯ä»¥åœ¨ImageJä¸­æŸ¥çœ‹ï¼Œæ¯”å¦‚æ¿€å…‰å¼ºåº¦ã€æ¯å¸§é—´éš”æ—¶é—´ç­‰ã€‚ç„¶åInfoè¿˜å¯ä»¥ä¿å­˜ä¸ºtxtæ–‡ä»¶ã€‚ä¸ºäº†æ–¹ä¾¿ï¼Œæˆ‘å†™äº†ä¸€ä¸ªè‡ªåŠ¨åŒ–è„šæœ¬ï¼Œæ”¶é›†Infoæ–‡ä»¶ä¸­çš„é‡è¦å‚æ•°å¹¶æ±‡æ€»åˆ°ä¸€ä¸ªexcelè¡¨æ ¼ä¸­ã€‚ä»£ç å¦‚ä¸‹ï¼š\n\n```python\nimport os\nfrom glob import glob\nimport pandas as pd \nimport re \n\ndef findTxt(wks):\n    infos = []\n    for d in os.walk(wks):\n        path, dirs, files = d\n        for f in files:\n            if f.startswith('Info') and f.endswith('txt'):\n                # æ ¹æ®æ–‡ä»¶å‘½åç‰¹å¾è¿›è¡Œç­›é€‰\n                txt = os.path.join(path,f)\n                infos.append(txt)\n    return infos\n\ndef extractInfo(txt):\n    '''\n    txt: Info for **.txtçš„æ–‡ä»¶è·¯å¾„\n    ==============================\n    ä»txtä¸­æå–ä»¥ä¸‹å…³é”®ä¿¡æ¯ï¼š\n    1. **æ¿€å…‰å¼ºåº¦**ï¼šWFLaserChannelInfo_CurrentValue = 100\n    2. ç©¿é€æ·±åº¦ï¼šTIRF_PenetrationDepth = 171.008186233857\n    3. æ¿€å…‰æ³¢é•¿ï¼šWFLaserChannelInfo_Wavelength = 638\n    4. ç›¸æœºæ¸©åº¦ï¼šATLCameraSettingDefinition|TargetTemperature = -75\n    5. **æ¯å¸§é—´éš”æ—¶é—´**ï¼šFrame interval: 0.02046 sec\n    '''\n    recs = {'WFLaserChannelInfo_CurrentValue = ':0, \n           'TIRF_PenetrationDepth = ':0, \n           'WFLaserChannelInfo_Wavelength = ':0,\n           'TargetTemperature = ':0,\n           'Frame interval:':0}\n    # é¿å…æ„é€ å¤æ‚çš„patternæ­£åˆ™è¡¨è¾¾å¼ï¼ŒæŠŠå¤æ‚çš„å†™å…¥key\n    with open(txt) as f:\n        data = f.read()\n    \n    for key in recs:\n        pattern = '{}(.+)'.format(key)\n#         print(pattern)\n        a = re.search(pattern, data)\n        r = a.group(1)\n        if r.endswith('sec'):\n            r = r.split(' ')[1]\n        recs[key] = float(r)\n    return recs\n\ndef main(wks):\n    infos = findTxt(wks)\n    newkeys = ['ExIntensity', 'PenetrationDepth','ExWavelength','ccdTemperature','frameInterval']\n    data = {x:[] for x in newkeys}\n    for txt in infos:\n        recs = extractInfo(txt)\n        # å­—å…¸çš„é”®åä¿®æ”¹ï¼Œä½¿ç”¨popæ–¹æ³•\n        keys = list(recs.keys())\n    #     print(keys)\n        for newkey, oldkey in zip(newkeys, keys):\n            data[newkey].append(recs[oldkey])\n    data = pd.DataFrame(data)\n    data['filepath'] = infos\n    data.to_excel(os.path.join(wks, 'infos.xlsx'), index=None)\n\nif __name__ == \"__main__\":\n    wks = r\"E:\\xxd\\TIRF-LeicaDMi8\\20201223\" \n    main(wks)\n```\n\nä»£ç ç¨å¾®é•¿äº†ä¸€ç‚¹ï¼Œè¿˜å¼„å‡ºæ¥ä¸¤ä¸ªå‡½æ•°ã€‚å¯»æ‰¾Infoæ–‡ä»¶è¿˜å¥½è¯´ï¼Œå› ä¸ºæ–‡ä»¶å‘½åéƒ½å¸¦æœ‰Infoå‰ç¼€ï¼Œç„¶åæ–‡ä»¶åˆæ˜¯txtç±»å‹ï¼Œç›´æ¥åˆ©ç”¨`os.walk`è·å–æ€»çš„å·¥ä½œç›®å½•ä¸‹æ‰€æœ‰çš„æ–‡ä»¶ï¼Œç„¶åéå†ï¼Œæ ¹æ®æ–‡ä»¶åè¿›è¡Œç­›é€‰å³å¯ã€‚æ³¨æ„`os.walk`è¿”å›çš„æ˜¯ä¸€ä¸ªè¿­ä»£å™¨ï¼Œæ¯æ¬¡åå‡ºæ¥ä¸€ä¸ªæ ¹ç›®å½•è·¯å¾„ï¼Œæ ¹ç›®å½•ä¸‹æ–‡ä»¶å¤¹åˆ—è¡¨ä»¥åŠæ–‡ä»¶åˆ—è¡¨ç»„æˆçš„ä¸‰å…ƒå…ƒç»„ã€‚\n\nä»`Info.txt`ä¸­æå–ä¿¡æ¯è¿˜é¢‡ä¸ºè´¹äº‹ï¼Œå› ä¸ºInfoä¸­ä¿¡æ¯é‡éå¸¸å¤§ï¼Œæˆ‘ä¸å¯èƒ½ç”¨`f.readlines()`çš„æ–¹æ³•å»è¯»å–æŒ‡å®šçš„è¡Œï¼Œæ‰€ä»¥é€‰æ‹©äº†ç”¨æ­£åˆ™åŒ¹é…çš„æ–¹å¼ã€‚ä½†æ˜¯æ­£åˆ™æˆ‘ç”¨å¾—å¾ˆå°‘ï¼Œè€Œä¸”ä¸ºäº†å‡è½»æ­£åˆ™patternçš„è®¾è®¡éš¾åº¦ï¼Œæˆ‘æŠŠpatternä¸­å˜åŒ–çš„éƒ¨åˆ†å°½å¯èƒ½åœ°å®šä¹‰åˆ°å­—å…¸çš„keyä¸­ã€‚æˆ‘è§‰å¾—è¿™ä¸ªæ€è·¯ï¼ˆæ‹¿é€šç”¨æ€§æ¢æ•ˆç‡ï¼‰è¿˜æŒºä¸é”™çš„â€”â€”èƒ½æŠŠäº‹æƒ…è§£å†³å°±å¥½ã€‚reæ¨¡å—ä¸­æˆ‘å¸¸ç”¨searchå’Œfindallä¸¤ä¸ªåŠŸèƒ½ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼š\n\n1. re.searchåªè¿”å›æ‰¾åˆ°çš„ç¬¬ä¸€ä¸ªåŒ¹é…çš„å­—ç¬¦ä¸²\n2. re.findallè¿”å›æ‰€æœ‰åŒ¹é…çš„å­—ç¬¦ä¸²æ‰€ç»„æˆçš„list\n3. å¦‚æœpatternä¸­æ”¾æ‹¬å·ï¼Œæ‹¬å·å¯ä»¥ä½œä¸ºgroupæå–ä¿¡æ¯ï¼Œä½†æ˜¯æ³¨æ„groupçš„ç´¢å¼•id\n4. ä¿®æ”¹å­—å…¸çš„é”®åçš„æ–¹æ³•\n5. ä½¿ç”¨pandasæ¨¡å—ï¼Œæ„å»ºdataframeï¼Œç„¶åæ–¹ä¾¿ä¿å­˜ä¸ºexcelå¯ä»¥æ‰“å¼€çš„xlsxæ–‡ä»¶\n\nå®ç°æ•ˆæœå¦‚ä¸‹ï¼š\n\n![image-20201227120627018](https://sheldon-notes.oss-cn-shanghai.aliyuncs.com/img/image-20201227120627018.png)\n\n\n\n","tags":["filepath"],"categories":["python"]},{"title":"æ‰¹é‡ç¼©å°åšå®¢ä¸­çš„å›¾ç‰‡","url":"/2020/12/24/resizeImages/","content":"\nç›®å‰æˆ‘æœ€ç†Ÿæ‚‰[python](https://www.liaoxuefeng.com/wiki/1016959663602400)ï¼Œå¦å¤–ä¹Ÿä¼šå†™ä¸€ç‚¹[ImageJçš„è„šæœ¬å¤„ç†](https://zhuanlan.zhihu.com/p/60999196)å’Œåˆ†æå›¾åƒã€‚å¯æ˜¯ç¼–ç¨‹æŠ€èƒ½â€œç”¨è¿›åºŸé€€â€ï¼Œç‰¹åˆ«æ˜¯äººå¹´çºªè¶Šå¤§ï¼Œå¯¹äºå„ç§ç¹å¤çš„ä»£ç ç»†èŠ‚å°±è¶Šéš¾è®°å¿†ã€‚æ‰€ä»¥å¾ˆå¤šç å†œéƒ½ä¼šå†™åšå®¢ï¼Œå¹¶ä¸”æŠŠåšå®¢å½“ä½œâ€œç¬¬äºŒå¤§è„‘â€ã€‚æˆ‘å½“ç„¶ä¹Ÿä¸ä¾‹å¤–ï¼Œä»¥åä¹Ÿæ—¶ä¸æ—¶ä¼šæŠŠè‡ªå·±å†™è¿‡çš„ä»£ç æ•´ç†åˆ°åšå®¢ä¸Šã€‚\n\n### éœ€æ±‚\n\næˆ‘å–œæ¬¢åœ¨æ–‡ç« ä¸­æ’å…¥æˆªå›¾ï¼Œå®ç°å›¾æ–‡å¹¶èŒ‚çš„æ•ˆæœã€‚ä½†æ˜¯githubçš„ä»“åº“å®¹é‡æœ‰é™ï¼Œè€Œä¸”å›¾ç‰‡å¤§å°å°ºå¯¸ä¸ä¸€é€ æˆä¸ç¾è§‚ã€‚è™½ç„¶å¯ä»¥å®šä¹‰`css`æ–‡ä»¶æ¥æ§åˆ¶æ˜¾ç¤ºï¼Œä½†å®ƒåªèƒ½è§£å†³ç¾è§‚é—®é¢˜ã€‚è€Œä½¿ç”¨å›¾åºŠèƒ½å¤Ÿé¿å…å›¾ç‰‡å¤ªå¤šè¶…å‡ºä»“åº“å®¹é‡é™åˆ¶ï¼Œä½†æŠŠå„ç§å›¾ç‰‡æ”¾åˆ°å…¬å…±å›¾åºŠä¸Šæ—¢ä¸èƒ½è®©æˆ‘æ”¾å¿ƒï¼Œä¹Ÿè·Ÿæˆ‘ç›®å‰çš„workflowä¸å…¼å®¹ã€‚æ‰€ä»¥æˆ‘å†³å®šå†™ä¸€ä¸ªå°çš„å·¥å…·ä»£ç ï¼Œå®ç°å¯¹æ’å›¾æ–‡ä»¶çš„resizeã€‚å…·ä½“æœ‰ä»¥ä¸‹éœ€æ±‚ï¼š\n\n1. æ”¯æŒå¯¹png, jpg, jpegç­‰å¸¸è§å›¾åƒçš„resize\n2. å·²ç»resizeçš„ä¸è¦è¿›è¡Œé‡å¤çš„æ“ä½œ\n3. åŸå§‹å¤§å›¾è¦ä¿ç•™è€Œä¸”æ–¹ä¾¿æŸ¥æ‰¾\n4. ä¸ç ´åmarkdownä¸­å¯¹å›¾ç‰‡çš„å¼•ç”¨\n\n### ä»£ç \n\nä»£ç è¦ç‚¹å¦‚ä¸‹ï¼š\n\n1. ä½¿ç”¨globæ‰¹é‡è¯»å–å¤šç§æ ¼å¼çš„å›¾ç‰‡åœ°å€åˆ°åˆ—è¡¨\n2. è¿‡æ»¤å·²ç»è¢«resizeå¤„ç†çš„å›¾ç‰‡\n3. pillowåº“ä¸­çš„resizeæ–¹æ³•çš„è°ƒç”¨\n\nåºŸè¯ä¸å¤šè¯´ï¼Œç›´æ¥ä¸Šä»£ç ï¼š\n\n```python\nfrom PIL import Image \nimport os \nfrom glob import glob\n\ndef resizeImages(wks):\n    '''\n    è¾“å…¥makrdowné™„ä»¶ç›®å½•åœ°å€ï¼Œ\n    å¯¹å…¶ä¸­æ‰€æœ‰png\\jpg\\jpegç­‰æ ¼å¼çš„å›¾åƒè¿›è¡Œç¼©å°ï¼Œ\n    å›ºå®šå®½åº¦åˆ°600ï¼Œ\n    åŸå›¾è¢«é‡å‘½åå¸¦`_large.*`åç¼€\n    å¦‚æœæœ‰å¸¦æ­¤åç¼€çš„ï¼Œåˆ™ä¸¤å¼ å›¾åƒéƒ½ä¸è¿›è¡Œå¤„ç†\n    '''\n    files = []\n    formats = ['png','jpg','jpeg']\n    # å¦‚æœæƒ³å‹ç¼©gifï¼Œè¯·å‚è€ƒ\n    # https://blog.csdn.net/huanyue6660/article/details/79423326\n    for ext in formats:\n        files.extend(glob(os.path.join(wks, '*.{}'.format(ext))))  # ä½¿ç”¨extendçš„æ–¹å¼åˆå¹¶æ–°å¢çš„list\n    \n    jobs = []\n    for f in files:\n        ext = os.path.splitext(f)[-1]\n        if (f+'_large%s'%(ext) in files) or (f.endswith('large%s'%(ext))):\n            continue\n        else:\n            jobs.append(f)\n\n    for job in jobs:\n        ext = os.path.splitext(job)[-1]  # è·å–æ–‡ä»¶åç¼€åï¼Œæ³¨æ„è¿™ä¸ªå¸¦ç‚¹\n        a = Image.open(job)\n        a.save(job+'_large{}'.format(ext))\n        w, h = a.size\n        if w>600:\n            # åªç¼©å°å¤§å›¾\n            b = a.resize(size=(600, int(h*600/w))) # æ³¨æ„sizeå¾—æ˜¯æ•´æ•°\n        else:\n            b = a\n        b.save(job)\n        print('{} resized to width = 600 px!'.format(job))\n\nif __name__ == \"__main__\":\n    wks = r\"D:\\hexo\\blog\\source\\_posts\"  # windowsç³»ç»Ÿæ–‡ä»¶è·¯å¾„ï¼Œæ³¨æ„ä¸è¦å»æ‰r\n    subdirs = glob(os.path.join(wks,\"*/\"))\n    # print(subdirs)\n    # å¯¹_postsç›®å½•ä¸‹æ‰€æœ‰å›¾ç‰‡è¿›è¡Œå¤„ç†\n    for subdir in subdirs:\n        resizeImages(subdir)\n```\n\n### ä½¿ç”¨\n\næˆ‘å–œæ¬¢æŠŠè¿™ç§é«˜å¤ç”¨çš„å°å·¥å…·ä»£ç åšå¥½æ¥å£ï¼Œå†™åˆ°pythonè„šæœ¬ä¸­ï¼Œç„¶åç”¨é…ç½®å¥½çš„vscodeæ‰“å¼€ï¼Œæ ¹æ®éœ€æ±‚ä¿®æ”¹å‚æ•°ï¼ˆè¿™é‡Œæ˜¯`_posts`ç›®å½•çš„åœ°å€ï¼‰ï¼Œç„¶åæŒ‰`Ctrl+F5`è¿è¡Œã€‚\n\n### ç»“æœ\n\n![image-20201224114927774](https://sheldon-notes.oss-cn-shanghai.aliyuncs.com/img/image-20201224114927774.png)\n\nåŸå§‹å›¾åƒè¢«é‡åä¸ºå¸¦`_large`åç¼€çš„æ–‡ä»¶ã€‚","tags":["pillow"],"categories":["python"]},{"title":"åœ¨gitub-pagesæ­å»ºHexoåšå®¢","url":"/2020/12/20/setupHexoWebsite/","content":"\n\næˆ‘æ‰“ç®—ç”¨**hexo**ç»“åˆ**github pages**æ„å»ºä¸€ä¸ªè½»åšå®¢ç½‘ç«™ï¼Œæ¯å‘¨å‘è¡¨è‡³å°‘ä¸€ç¯‡åšæ–‡ã€‚\n\n<!-- more -->\n\n### Hexoå»ºç«™å‚è€ƒæ•™ç¨‹\n\nä½¿ç”¨hexoå»ºç«™åˆ°**github pages**çš„å®Œæ•´æ•™ç¨‹æ¨èå¦‚ä¸‹ï¼š\n\nhttps://zhuanlan.zhihu.com/p/78467553\n\nhttps://segmentfault.com/a/1190000017986794\n\nhttps://theme-stun.github.io/docs/zh-CN/\n\nhttps://hexo.io/zh-cn/index.html\n\nhttps://blog.csdn.net/hhgggggg/article/details/77853665\n\n### ä½¿ç”¨**Stun**ä¸»é¢˜\n\n[stunä¸»é¢˜](https://theme-stun.github.io/docs/zh-CN/guide/quick-start.html#%E5%AE%89%E8%A3%85)æ¯”è¾ƒå¥½çœ‹ï¼Œæˆ‘è¿˜ç¨å¾®é…ç½®äº†ä¸€ä¸‹å¯ä»¥[è·Ÿtyporaè¿ç”¨](https://www.cnblogs.com/caoayu/articles/13855081.html)ï¼ˆä¸»è¦æ˜¯ä¸ºäº†èƒ½å¤Ÿæ­£å¸¸æ˜¾ç¤ºæ’å›¾å’Œé™„ä»¶ï¼‰ã€‚æ•ˆæœå¦‚ä¸‹å›¾ï¼š\n\n![image-20201222100030247](https://sheldon-notes.oss-cn-shanghai.aliyuncs.com/img/image-20201222100030247.png)\n\n### éœ€è¦å®‰è£…çš„æ’ä»¶åˆ—è¡¨\n\n1. gitç›¸å…³æ’ä»¶ï¼Œç”¨äºdeployåˆ°github pagesä¸Š\n2. searchç›¸å…³æ’ä»¶ï¼Œæ–¹ä¾¿å¯¹ç«™å†…å†…å®¹è¿›è¡Œæœç´¢\n3. asset-imagerç›¸å…³æ’ä»¶ï¼Œæ–¹ä¾¿æ’å›¾é™„ä»¶ä¹‹ç±»çš„\n\n### å¼€å¯è¯„è®ºç³»ç»Ÿ\n\ngitalkæ’ä»¶æ˜¯åˆ©ç”¨githubä»“åº“çš„issueåŠŸèƒ½ï¼Œä¸ºäº†èŠ‚çº¦ç©ºé—´ï¼Œæˆ‘å¦å¤–å¼€äº†ä¸€ä¸ª**sea-comments**çš„ä»“åº“ä½œä¸ºå­˜å‚¨ã€‚ç„¶åç…§ç€ä»¥ä¸‹æ•™ç¨‹è¿›è¡Œæ“ä½œï¼š\n\nhttps://www.jianshu.com/p/4242bb065550\n\nhttps://theme-stun.github.io/docs/zh-CN/advanced/third-part.html#gitalk\n\nhttps://github.com/gitalk/gitalk\n\néœ€è¦æ³¨æ„çš„æ˜¯ï¼Œstunä¸»é¢˜å·²ç»åµŒå…¥äº†gitalkï¼Œåªè¦åˆ°stunä¸»é¢˜ä¸‹çš„`_config.yaml`ä¸‹æ·»åŠ è‡ªå·±è¯„è®ºä»“åº“çš„ä¸€äº›ä¿¡æ¯å³å¯ã€‚\n\n> gitalkä¼šå‡ºç°Error NetworkæŠ¥é”™ï¼Œå¼ƒç”¨~ï¼Œä¹‹åä½¿ç”¨`valine`ï¼Œè¯„è®ºæ•°æ®å­˜å‚¨åœ¨`LeanCloud`ä¸­ï¼Œå¦‚æœ‰å¿…è¦ï¼ŒåŠæ—¶å¤‡ä»½ã€‚\n>\n> https://theme-stun.github.io/docs/zh-CN/advanced/third-part.html#valine\n\n### å¸¸ç”¨å‘½ä»¤\n\néœ€è¦è¿›å…¥åˆ°hexoç½‘ç«™çš„æœ¬åœ°æ ¹ç›®å½•ä¸‹æ‰§è¡Œå‘½ä»¤ï¼Œä»¥windowsç³»ç»Ÿä¸ºä¾‹ï¼š\n\n1. `hexo clean && hexo g && hexo s`: è‹¥ä¿®æ”¹äº†**_config.yaml**é…ç½®æ–‡ä»¶ï¼Œéœ€è¦æ¸…é™¤ publicç›®å½•ä¸‹æ‰€æœ‰å†…å®¹ï¼Œç„¶åæ ¹æ®æ–°çš„é…ç½®æ–‡ä»¶é‡æ–°ç”Ÿæˆé™æ€ç½‘é¡µï¼Œå¹¶ä¸”å¯åŠ¨æœ¬åœ°æœåŠ¡å™¨\n2. `hexo clean && hexo d`ï¼šä¿®æ”¹é…ç½®åï¼Œé‡æ–°å‘å¸ƒåˆ°gitee pagesä¸Šã€‚\n\n### æ³¨æ„äº‹é¡¹\n\n1. å°½é‡ä½¿ç”¨`hexo new`å‘½ä»¤ç”Ÿæˆ pagesæˆ–è€…æ–°çš„markdownæ–‡ä»¶ï¼Œç„¶ååˆ°`_posts`ç›®å½•ä¸‹å¯¹markdownæ–‡ä»¶è¿›è¡Œç¼–è¾‘ä¿®æ”¹ï¼ˆä½¿ç”¨typoraï¼‰ã€‚\n2. markdownæ–‡ä»¶å‘½ååªèƒ½ä¸ºè‹±æ–‡æˆ–è€…æ•°å­—ï¼Œè€Œæ ‡é¢˜å¯ä»¥åœ¨markdownæ–‡ä»¶é‡Œè¾¹çš„**Front Matter YAML**ä¸­è¿›è¡Œè®¾å®šï¼ˆ**Front Matter YAMLè®¾å®šéå¸¸é‡è¦**ï¼Œå‚è€ƒ[é“¾æ¥](https://hexo.io/zh-cn/docs/front-matter)ï¼‰ã€‚\n3. githubä»“åº“å®¹é‡æœ‰é™ï¼ˆ< 1 GBï¼‰ï¼Œé•¿æœŸä½¿ç”¨ä¸ªäººåšå®¢ï¼Œæ³¨æ„ä¸è¦æ’å…¥å¤ªå¤šå¤ªå¤§çš„å›¾ç‰‡ï¼Œå»ºè®®æ˜¯ä¸€ç¯‡åšæ–‡å›¾ç‰‡ä¸è¶…è¿‡10å¼ ã€‚\n4. åšå®¢å†…å®¹å®Œå…¨å…¬å¼€ï¼Œæ³¨æ„ä¸è¦å‘å¸ƒè¿æ³•æˆ–è€…å¼•å‘èˆ†è®ºçš„å†…å®¹ï¼Œå¹¶æ³¨æ„ä¿æŠ¤ä¸ªäººéšç§ã€‚","tags":["hexo"],"categories":["blog"]}]